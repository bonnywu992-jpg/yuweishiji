<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>渝味食記 - 四川濃香型辣椒醬</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: 'Microsoft JhengHei', Arial, sans-serif; background: linear-gradient(135deg, #d32f2f 0%, #f44336 100%); min-height: 100vh; padding: 20px; }
.container { max-width: 800px; margin: 0 auto; background: white; border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); overflow: hidden; }
.header { background: linear-gradient(135deg, #b71c1c 0%, #d32f2f 100%); color: white; padding: 40px 30px; text-align: center; }
.header h1 { font-size: 2.5em; margin-bottom: 10px; text-shadow: 2px 2px 4px rgba(0,0,0,0.2); }
.header p { font-size: 1.1em; opacity: 0.95; }
.ig-link { display: inline-block; margin-top: 10px; padding: 8px 20px; background: rgba(255,255,255,0.2); border-radius: 20px; color: white; text-decoration: none; transition: background 0.3s; }
.ig-link:hover { background: rgba(255,255,255,0.3); }
.product-section { padding: 40px 30px; }
.product-card { background: linear-gradient(135deg, #fff5f5 0%, #ffebee 100%); border-radius: 15px; padding: 30px; border: 3px solid #f44336; }
.product-header { display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; margin-bottom: 20px; }
.product-name { font-size: 1.8em; color: #b71c1c; font-weight: bold; }
.product-price { font-size: 1.6em; color: #d32f2f; font-weight: bold; }
.special-badge { display: inline-block; background: #ff6b6b; color: white; padding: 5px 15px; border-radius: 20px; font-size: 0.9em; margin-left: 10px; }
.highlight { background: #fff3bf; padding: 15px; border-radius: 10px; margin: 15px 0; border-left: 4px solid #f44336; }
.highlight strong { color: #b71c1c; }
.product-intro { background: linear-gradient(135deg, #fff8f0 0%, #ffe8e8 100%); border-radius: 15px; padding: 25px; margin: 20px 0; border: 2px solid #ff6b6b; line-height: 1.8; }
.product-intro h3 { color: #b71c1c; margin-bottom: 15px; font-size: 1.3em; }
.product-intro p { color: #333; margin-bottom: 12px; font-size: 1.05em; }
.product-intro strong { color: #d32f2f; }
.features-box { background: white; border-radius: 10px; padding: 15px; margin: 15px 0; }
.feature-item { color: #d32f2f; margin-bottom: 8px; font-weight: bold; }
.feature-item:last-child { margin-bottom: 0; }
.slogan { color: #b71c1c; font-weight: bold; font-size: 1.15em; margin: 15px 0; }
.specs-box { background: #fff3bf; border-radius: 8px; padding: 12px; margin-top: 15px; border-left: 4px solid #ff6b6b; }
.specs-box div { color: #333; margin-bottom: 5px; }
.specs-box div:last-child { margin-bottom: 0; }
.form-group { margin: 20px 0; }
.form-group label { display: block; margin-bottom: 8px; color: #333; font-weight: bold; }
.form-group input, .form-group select, .form-group textarea { width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 1em; transition: border-color 0.3s; }
.form-group input:focus, .form-group select:focus, .form-group textarea:focus { outline: none; border-color: #f44336; }
.quantity-control { display: flex; align-items: center; gap: 15px; }
.quantity-control button { width: 40px; height: 40px; border: none; background: #f44336; color: white; font-size: 1.5em; border-radius: 8px; cursor: pointer; transition: background 0.3s; user-select: none; }
.quantity-control button:hover { background: #d32f2f; }
.quantity-control button:active { transform: scale(0.95); }
.quantity-control input { width: 80px; text-align: center; font-size: 1.2em; font-weight: bold; }
.total-section { background: #f8f9fa; padding: 20px; border-radius: 10px; margin: 20px 0; }
.total-row { display: flex; justify-content: space-between; margin: 10px 0; font-size: 1.1em; }
.total-row.final { font-size: 1.5em; font-weight: bold; color: #b71c1c; border-top: 2px solid #ddd; padding-top: 10px; margin-top: 15px; }
.notice { background: #fff3bf; padding: 15px; border-radius: 10px; margin: 20px 0; text-align: center; font-weight: bold; color: #b71c1c; border: 2px dashed #ffa94d; }
.submit-btn { width: 100%; padding: 18px; background: linear-gradient(135deg, #b71c1c 0%, #d32f2f 100%); color: white; border: none; border-radius: 12px; font-size: 1.3em; font-weight: bold; cursor: pointer; transition: transform 0.2s, box-shadow 0.2s; margin-bottom: 10px; }
.submit-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(183, 28, 28, 0.4); }
.submit-btn:disabled { background: #ccc; cursor: not-allowed; transform: none; }
.success-message { background: #d3f9d8; padding: 20px; border-radius: 10px; margin: 20px 0; text-align: center; color: #2b8a3e; font-weight: bold; border: 2px solid #51cf66; }
.error-message { background: #ffe3e3; padding: 20px; border-radius: 10px; margin: 20px 0; text-align: center; color: #b71c1c; font-weight: bold; border: 2px solid #f44336; }
.store-section { background: #f8f9fa; padding: 15px; border-radius: 10px; margin-top: 10px; border: 2px solid #e9ecef; }
.store-region { margin-bottom: 15px; }
.store-region:last-child { margin-bottom: 0; }
.store-region label { font-size: 0.95em; color: #495057; margin-bottom: 5px; display: block; }
.store-region select { width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 1em; }
#addressGroup { display: none; }
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <h1>🌶️ 渝味食記 🌶️</h1>
    <p>四川濃香型辣椒醬</p>
    <a href="https://www.instagram.com/yuweishiji" target="_blank" class="ig-link">📷 追蹤我們的 Instagram</a>
  </div>

  <div class="product-section">
    <div class="product-card">
      <div class="product-header">
        <div>
          <span class="product-name">四川濃香型辣椒醬</span>
          <span class="special-badge">🔥 麻辣鮮香</span>
        </div>
        <div class="product-price">NT$ 250 / 罐</div>
      </div>

      <div class="highlight">
        <strong>手工製作、無添加防腐劑,開封後需冷藏保存 ⚠️</strong>
      </div>

      <div class="product-intro">
        <h3>🌶️ 渝味食記-濃香型四川辣椒醬</h3>
        <p><strong>四川的靈魂,不只在麵裡,也在這一瓢辣油裡!</strong></p>
        <p style="color: #555;">
          我們的手工辣椒,是每天親炒現做,從挑椒、炸香料到熬油,每一步都用心。<br>
          辣得過癮卻不嗆喉,麻得香氣層層堆疊——拌麵、炒菜、沾水餃都超搭!
        </p>
        <div class="features-box">
          <div class="feature-item">💥 無添加防腐劑</div>
          <div class="feature-item">💥 純手工熬煮</div>
          <div class="feature-item">💥 香、麻、辣三味俱全</div>
          <div class="feature-item">💥 添加30多種香料</div>
        </div>
        <p class="slogan">一匙下去,整碗都活了🔥</p>
        <div class="specs-box">
          <div><strong>容量:</strong> 150g/瓶</div>
          <div><strong>保存期限:</strong> 冷藏保存半年 / 常溫保存3個月</div>
        </div>
      </div>

      <form id="orderForm">
        <div class="form-group">
          <label>購買數量</label>
          <div class="quantity-control">
            <button type="button" id="btnMinus">−</button>
            <input type="number" id="qty" value="1" min="1" readonly>
            <button type="button" id="btnPlus">+</button>
          </div>
        </div>

        <div class="notice" id="freeShipNotice">🎉 購買10罐(含)以上免運費!</div>

        <div class="form-group"><label>姓名 *</label><input type="text" id="name" required></div>
        <div class="form-group"><label>電話 *</label><input type="tel" id="phone" required placeholder="例:0912345678"></div>
        <div class="form-group"><label>Email *</label><input type="email" id="email" required></div>
        
        <div class="form-group">
          <label>取貨方式 *</label>
          <select id="pickup" required>
            <option value="">請選擇取貨方式</option>
            <option value="7-11">7-11 超商取貨</option>
            <option value="全家">全家超商取貨</option>
            <option value="宅配">宅配</option>
            <option value="面交">面交</option>
          </select>
        </div>

        <div class="form-group" id="storeSelectGroup" style="display:none;">
          <label>選擇門市 *</label>
          <div class="store-section" id="storeSection"></div>
        </div>

        <div class="form-group" id="addressGroup">
          <label id="addressLabel">收貨地址 *</label>
          <textarea id="address" rows="3" placeholder="請填寫完整地址"></textarea>
        </div>

        <div class="form-group">
          <label>匯款帳號後5碼 *</label>
          <input type="text" id="accountLast5" maxlength="5" pattern="[0-9]{5}" required placeholder="請填寫5位數字">
        </div>
        <div class="form-group">
          <label>備註</label>
          <textarea id="note" rows="2" placeholder="其他需求或備註"></textarea>
        </div>

        <div class="total-section">
          <div class="total-row"><span>小計:</span><span id="subtotalDisplay">NT$ 250</span></div>
          <div class="total-row"><span>運費:</span><span id="shippingDisplay">NT$ 130</span></div>
          <div class="total-row final"><span>總計:</span><span id="totalDisplay">NT$ 380</span></div>
        </div>

        <button type="submit" class="submit-btn" id="submitBtn">確認訂購</button>
        <div id="message"></div>
      </form>
    </div>
  </div>
</div>

<script>
(function() {
'use strict';

const CFG = {
  KEY: '63c8b2d8-bddb-46cb-b683-e3c0becf31bf',
  EMAIL: 'bonnywu992@gmail.com',
  PRICE: 250,
  SHIP_D: 160,
  SHIP_S: 130,
  FREE: 10
};

const STORES = {
'7-11': {
  '台北市': {
    '中正區': ['台北車站門市', '西門町門市'],
    '大同區': ['大同門市'],
    '中山區': ['中山門市', '南京門市'],
    '松山區': ['松山門市'],
    '大安區': ['大安門市', '東區門市'],
    '萬華區': ['萬華門市'],
    '信義區': ['信義門市', '101門市'],
    '士林區': ['士林門市'],
    '北投區': ['北投門市'],
    '內湖區': ['內湖門市'],
    '南港區': ['南港門市'],
    '文山區': ['文山門市']
  },
  '新北市': {
    '板橋區': ['板橋門市'],
    '三重區': ['三重門市'],
    '中和區': ['中和門市'],
    '永和區': ['永和門市'],
    '新莊區': ['新莊門市'],
    '新店區': ['新店門市'],
    '樹林區': ['樹林門市'],
    '淡水區': ['淡水門市'],
    '汐止區': ['汐止門市'],
    '土城區': ['土城門市'],
    '蘆洲區': ['蘆洲門市']
  },
  '桃園市': {
    '桃園區': ['桃園門市'],
    '中壢區': ['中壢門市', '中原門市'],
    '平鎮區': ['平鎮門市'],
    '八德區': ['八德門市'],
    '楊梅區': ['楊梅門市']
  },
  '台中市': {
    '中區': ['台中門市'],
    '東區': ['東區門市'],
    '南區': ['南區門市'],
    '西區': ['西區門市'],
    '北區': ['北區門市'],
    '西屯區': ['西屯門市', '逢甲門市'],
    '南屯區': ['南屯門市'],
    '北屯區': ['北屯門市'],
    '豐原區': ['豐原門市'],
    '大里區': ['大里門市']
  },
  '台南市': {
    '中西區': ['台南門市'],
    '東區': ['東區門市'],
    '南區': ['南區門市'],
    '北區': ['北區門市'],
    '安平區': ['安平門市'],
    '永康區': ['永康門市']
  },
  '高雄市': {
    '新興區': ['新興店', '六合店'],
    '前金區': ['前金店'],
    '苓雅區': ['苓雅店', '三多店', '武廟店'],
    '鹽埕區': ['鹽埕店'],
    '鼓山區': ['鼓山店', '美術館店'],
    '前鎮區': ['前鎮店', '夢時代店'],
    '三民區': ['三民店', '建國店'],
    '左營區': ['左營店', '高鐵左營店'],
    '楠梓區': ['楠梓店'],
    '鳳山區': ['鳳山店', '大東店'],
    '小港區': ['小港店'],
    '岡山區': ['岡山店']
  },
  '基隆市': {
    '仁愛區': ['仁愛門市'],
    '中正區': ['中正門市']
  },
  '新竹市': {
    '東區': ['新竹門市'],
    '北區': ['北區門市']
  },
  '嘉義市': {
    '東區': ['嘉義門市'],
    '西區': ['西區門市']
  },
  '宜蘭縣': {
    '宜蘭市': ['宜蘭店'],
    '羅東鎮': ['羅東店']
  },
  '新竹縣': {
    '竹北市': ['竹北店'],
    '竹東鎮': ['竹東店']
  },
  '苗栗縣': {
    '苗栗市': ['苗栗店'],
    '頭份市': ['頭份店']
  },
  '彰化縣': {
    '彰化市': ['彰化店'],
    '員林市': ['員林店']
  },
  '南投縣': {
    '南投市': ['南投店'],
    '埔里鎮': ['埔里店']
  },
  '雲林縣': {
    '斗六市': ['斗六店'],
    '虎尾鎮': ['虎尾店']
  },
  '嘉義縣': {
    '太保市': ['太保店'],
    '朴子市': ['朴子店']
  },
  '屏東縣': {
    '屏東市': ['屏東店'],
    '潮州鎮': ['潮州店']
  },
  '花蓮縣': {
    '花蓮市': ['花蓮店']
  },
  '台東縣': {
    '台東市': ['台東店']
  }
},
'全家': {
  '台北市': {
    '中正區': ['台北車站店', '西門町店'],
    '大同區': ['大同店'],
    '中山區': ['中山店', '南京店'],
    '松山區': ['松山店'],
    '大安區': ['大安店', '東區店', '忠孝店'],
    '萬華區': ['萬華店'],
    '信義區': ['信義店', '101店', '市政府店'],
    '士林區': ['士林店', '天母店'],
    '北投區': ['北投店', '石牌店'],
    '內湖區': ['內湖店', '西湖店'],
    '南港區': ['南港店', '南港軟體店'],
    '文山區': ['文山店', '景美店']
  },
  '新北市': {
    '板橋區': ['板橋店', '板橋府中店', '新埔店'],
    '三重區': ['三重店', '三和店'],
    '中和區': ['中和店', '中和環球店'],
    '永和區': ['永和店', '永和中正店'],
    '新莊區': ['新莊店', '新莊中正店', '輔大店'],
    '新店區': ['新店店', '新店中正店'],
    '樹林區': ['樹林店', '樹林中山店'],
    '淡水區': ['淡水店', '淡水中正店'],
    '汐止區': ['汐止店', '汐止中興店'],
    '土城區': ['土城店', '土城中央店'],
    '蘆洲區': ['蘆洲店', '蘆洲中正店'],
    '五股區': ['五股店'],
    '林口區': ['林口店']
  },
  '桃園市': {
    '桃園區': ['桃園店', '桃園中正店', '桃園藝文店'],
    '中壢區': ['中壢店', '中壢中山店', '中原店', '內壢店'],
    '平鎮區': ['平鎮店', '平鎮中豐店'],
    '八德區': ['八德店', '八德介壽店'],
    '楊梅區': ['楊梅店', '楊梅中山店'],
    '蘆竹區': ['蘆竹店', '南崁店'],
    '龜山區': ['龜山店', '長庚店']
  },
  '台中市': {
    '中區': ['台中店', '中華店'],
    '東區': ['東區店', '台中站前店'],
    '南區': ['南區店', '台中高工店'],
    '西區': ['西區店', '台中美村店', '公益店'],
    '北區': ['北區店', '台中一中店', '健行店'],
    '西屯區': ['逢甲店', '西屯店', '東海店', '中科店'],
    '南屯區': ['南屯店', '文心店'],
    '北屯區': ['北屯店', '崇德店'],
    '豐原區': ['豐原店', '豐原中正店'],
    '大里區': ['大里店', '大里中興店'],
    '太平區': ['太平店', '太平中山店'],
    '沙鹿區': ['沙鹿店', '沙鹿中山店']
  },
  '台南市': {
    '中西區': ['台南店', '台南成功店', '赤崁店'],
    '東區': ['東區店', '台南東門店', '台南長榮店'],
    '南區': ['南區店', '台南金華店'],
    '北區': ['北區店', '台南小北店', '台南公園店'],
    '安平區': ['安平店', '安平中華店'],
    '安南區': ['安南店', '台南海佃店'],
    '永康區': ['永康店', '永康中華店', '永康大灣店'],
    '歸仁區': ['歸仁店'],
    '新營區': ['新營店', '新營中山店']
  },
  '高雄市': {
    '新興區': ['新興店', '六合店', '新興中山店'],
    '前金區': ['前金店', '高雄市中店'],
    '苓雅區': ['苓雅店', '三多店', '武廟店', '高雄四維店'],
    '鹽埕區': ['鹽埕店', '高雄五福店'],
    '鼓山區': ['鼓山店', '美術館店', '高雄博愛店'],
    '旗津區': ['旗津店'],
    '前鎮區': ['前鎮店', '夢時代店', '高雄瑞隆店'],
    '三民區': ['三民店', '建國店', '高雄九如店', '高雄博愛店'],
    '左營區': ['左營店', '高鐵左營店', '博愛店'],
    '楠梓區': ['楠梓店', '楠梓德民店'],
    '小港區': ['小港店', '高雄小港店'],
    '鳳山區': ['鳳山店', '大東店', '鳳山青年店'],
    '岡山區': ['岡山店', '岡山中山店'],
    '仁武區': ['仁武店'],
    '大寮區': ['大寮店']
  },
  '基隆市': {
    '仁愛區': ['仁愛店', '基隆孝二店'],
    '中正區': ['中正店', '基隆中正店'],
    '信義區': ['基隆信義店'],
    '安樂區': ['安樂店']
  },
  '新竹市': {
    '東區': ['新竹店', '新竹東門店', '新竹光復店'],
    '北區': ['北區店', '新竹中正店'],
    '香山區': ['香山店']
  },
  '嘉義市': {
    '東區': ['嘉義店', '嘉義中山店'],
    '西區': ['西區店', '嘉義垂楊店']
  },
  '宜蘭縣': {
    '宜蘭市': ['宜蘭店', '宜蘭中山店'],
    '羅東鎮': ['羅東店', '羅東中正店'],
    '礁溪鄉': ['礁溪店']
  },
  '新竹縣': {
    '竹北市': ['竹北店', '竹北光明店'],
    '竹東鎮': ['竹東店', '竹東中興店'],
    '湖口鄉': ['湖口店']
  },
  '苗栗縣': {
    '苗栗市': ['苗栗店', '苗栗中正店'],
    '頭份市': ['頭份店', '頭份中華店'],
    '竹南鎮': ['竹南店']
  },
  '彰化縣': {
    '彰化市': ['彰化店', '彰化中正店', '彰化民族店'],
    '員林市': ['員林店', '員林中山店'],
    '鹿港鎮': ['鹿港店'],
    '和美鎮': ['和美店']
  },
  '南投縣': {
    '南投市': ['南投店', '南投中興店'],
    '埔里鎮': ['埔里店', '埔里中正店'],
    '草屯鎮': ['草屯店']
  },
  '雲林縣': {
    '斗六市': ['斗六店', '斗六雲林店'],
    '虎尾鎮': ['虎尾店', '虎尾中正店'],
    '斗南鎮': ['斗南店']
  },
  '嘉義縣': {
    '太保市': ['太保店', '嘉義高鐵店'],
    '朴子市': ['朴子店', '朴子開元店'],
    '民雄鄉': ['民雄店']
  },
  '屏東縣': {
    '屏東市': ['屏東店', '屏東民生店', '屏東中山店'],
    '潮州鎮': ['潮州店', '潮州中山店'],
    '東港鎮': ['東港店'],
    '恆春鎮': ['恆春店', '墾丁店']
  },
  '花蓮縣': {
    '花蓮市': ['花蓮店', '花蓮中正店', '花蓮中山店'],
    '吉安鄉': ['吉安店']
  },
  '台東縣': {
    '台東市': ['台東店', '台東中華店'],
    '成功鎮': ['成功店']
  },
  '澎湖縣': {
    '馬公市': ['馬公店', '澎湖中正店']
  },
  '金門縣': {
    '金城鎮': ['金城店', '金門店']
  }
}
};

let selectedStore = '';
let citySelect, distSelect, storeSelect;

function generateOrderId() {
  const now = new Date();
  const year = now.getFullYear();
  const month = String(now.getMonth() + 1).padStart(2, '0');
  const day = String(now.getDate()).padStart(2, '0');
  const random = Math.floor(Math.random() * 10000).toString().padStart(4, '0');
  return 'YW' + year + month + day + random;
}

const elements = {
  qty: document.getElementById('qty'),
  btnPlus: document.getElementById('btnPlus'),
  btnMinus: document.getElementById('btnMinus'),
  subtotal: document.getElementById('subtotalDisplay'),
  shipping: document.getElementById('shippingDisplay'),
  total: document.getElementById('totalDisplay'),
  notice: document.getElementById('freeShipNotice'),
  pickup: document.getElementById('pickup'),
  storeGroup: document.getElementById('storeSelectGroup'),
  addressGroup: document.getElementById('addressGroup'),
  storeSection: document.getElementById('storeSection'),
  form: document.getElementById('orderForm'),
  submitBtn: document.getElementById('submitBtn'),
  message: document.getElementById('message')
};

function updatePrice() {
  const quantity = parseInt(elements.qty.value) || 1;
  const subtotal = CFG.PRICE * quantity;
  const method = elements.pickup.value;
  let shipping = 0;
  
  if (method === '宅配') {
    shipping = quantity >= CFG.FREE ? 0 : CFG.SHIP_D;
  } else if (method === '7-11' || method === '全家') {
    shipping = quantity >= CFG.FREE ? 0 : CFG.SHIP_S;
  }
  
  const total = subtotal + shipping;
  
  elements.subtotal.textContent = 'NT$ ' + subtotal;
  elements.shipping.textContent = shipping === 0 ? (method === '面交' ? '免運費 (面交) ✓' : '免運費 ✓') : 'NT$ ' + shipping;
  elements.total.textContent = 'NT$ ' + total;
  
  if (method === '面交') {
    elements.notice.textContent = '🎉 面交免運費!';
    elements.notice.style.background = '#d3f9d8';
  } else if (quantity < CFG.FREE) {
    elements.notice.textContent = '再買 ' + (CFG.FREE - quantity) + ' 罐即可免運 🎁';
    elements.notice.style.background = '#fff3bf';
  } else {
    const saved = method === '宅配' ? CFG.SHIP_D : CFG.SHIP_S;
    elements.notice.textContent = '🎉 已達免運門檻!恭喜省下 NT$ ' + saved + ' 運費!';
    elements.notice.style.background = '#d3f9d8';
  }
}

function createStoreSelects(method) {
  elements.storeSection.innerHTML = '';
  selectedStore = '';
  
  if (!STORES[method]) return;
  
  const stores = STORES[method];
  
  const cityDiv = document.createElement('div');
  cityDiv.className = 'store-region';
  const cityLabel = document.createElement('label');
  cityLabel.textContent = '選擇城市';
  cityDiv.appendChild(cityLabel);
  citySelect = document.createElement('select');
  citySelect.innerHTML = '<option value="">請選擇城市</option>';
  Object.keys(stores).forEach(function(city) {
    const option = document.createElement('option');
    option.value = city;
    option.textContent = city;
    citySelect.appendChild(option);
  });
  cityDiv.appendChild(citySelect);
  elements.storeSection.appendChild(cityDiv);
  
  const distDiv = document.createElement('div');
  distDiv.className = 'store-region';
  const distLabel = document.createElement('label');
  distLabel.textContent = '選擇區域';
  distDiv.appendChild(distLabel);
  distSelect = document.createElement('select');
  distSelect.disabled = true;
  distSelect.innerHTML = '<option value="">請先選擇城市</option>';
  distDiv.appendChild(distSelect);
  elements.storeSection.appendChild(distDiv);
  
  const storeDiv = document.createElement('div');
  storeDiv.className = 'store-region';
  const storeLabel = document.createElement('label');
  storeLabel.textContent = '選擇門市';
  storeDiv.appendChild(storeLabel);
  storeSelect = document.createElement('select');
  storeSelect.disabled = true;
  storeSelect.innerHTML = '<option value="">請先選擇區域</option>';
  storeDiv.appendChild(storeSelect);
  elements.storeSection.appendChild(storeDiv);
  
  const otherDiv = document.createElement('div');
  otherDiv.id = 'otherStoreDiv';
  otherDiv.style.display = 'none';
  otherDiv.style.marginTop = '15px';
  otherDiv.style.padding = '15px';
  otherDiv.style.background = '#fff3bf';
  otherDiv.style.borderRadius = '8px';
  otherDiv.style.border = '2px dashed #ffa94d';
  otherDiv.innerHTML = '<div style="margin-bottom:10px;color:#b71c1c;font-weight:bold;">📝 請填寫其他門市資訊</div><div style="margin-bottom:10px;"><label style="display:block;margin-bottom:5px;font-size:0.9em;color:#495057;">縣市 + 區域 *</label><input type="text" id="otherStoreCity" placeholder="例: 高雄市苓雅區" style="width:100%;padding:10px;border:2px solid #ddd;border-radius:6px;font-size:0.95em;"></div><div><label style="display:block;margin-bottom:5px;font-size:0.9em;color:#495057;">門市名稱 *</label><input type="text" id="otherStoreName" placeholder="例: 武廟門市" style="width:100%;padding:10px;border:2px solid #ddd;border-radius:6px;font-size:0.95em;"></div>';
  elements.storeSection.appendChild(otherDiv);
  
  citySelect.addEventListener('change', function() {
    const selectedCity = this.value;
    distSelect.innerHTML = '<option value="">請選擇區域</option>';
    storeSelect.innerHTML = '<option value="">請先選擇區域</option>';
    storeSelect.disabled = true;
    selectedStore = '';
    document.getElementById('otherStoreDiv').style.display = 'none';
    
    if (selectedCity && stores[selectedCity]) {
      distSelect.disabled = false;
      Object.keys(stores[selectedCity]).forEach(function(district) {
        const option = document.createElement('option');
        option.value = district;
        option.textContent = district;
        distSelect.appendChild(option);
      });
    } else {
      distSelect.disabled = true;
    }
  });
  
  distSelect.addEventListener('change', function() {
    const selectedCity = citySelect.value;
    const selectedDist = this.value;
    storeSelect.innerHTML = '<option value="">請選擇門市</option>';
    selectedStore = '';
    document.getElementById('otherStoreDiv').style.display = 'none';
    
    if (selectedCity && selectedDist && stores[selectedCity][selectedDist]) {
      storeSelect.disabled = false;
      stores[selectedCity][selectedDist].forEach(function(store) {
        const option = document.createElement('option');
        option.value = selectedCity + '-' + selectedDist + '-' + store;
        option.textContent = store;
        storeSelect.appendChild(option);
      });
      
      const otherOption = document.createElement('option');
      otherOption.value = 'OTHER';
      otherOption.textContent = '🔍 附近沒有這些門市,選擇其他門市';
      storeSelect.appendChild(otherOption);
    } else {
      storeSelect.disabled = true;
    }
  });
  
  storeSelect.addEventListener('change', function() {
    if (this.value === 'OTHER') {
      document.getElementById('otherStoreDiv').style.display = 'block';
      selectedStore = 'OTHER';
    } else {
      document.getElementById('otherStoreDiv').style.display = 'none';
      selectedStore = this.value;
    }
  });
}

elements.pickup.addEventListener('change', function() {
  const method = this.value;
  const address = document.getElementById('address');
  const addressLabel = document.getElementById('addressLabel');
  
  if (method === '7-11' || method === '全家') {
    elements.storeGroup.style.display = 'block';
    elements.addressGroup.style.display = 'none';
    address.value = '';
    createStoreSelects(method);
  } else if (method === '宅配') {
    elements.storeGroup.style.display = 'none';
    elements.addressGroup.style.display = 'block';
    addressLabel.textContent = '收貨地址 *';
    address.placeholder = '請填寫完整地址';
    address.value = '';
    address.readOnly = false;
    address.style.backgroundColor = '';
  } else if (method === '面交') {
    elements.storeGroup.style.display = 'none';
    elements.addressGroup.style.display = 'block';
    addressLabel.textContent = '面交地點';
    address.value = '802高雄市苓雅區武廟路206號';
    address.readOnly = true;
    address.style.backgroundColor = '#f0f0f0';
  } else {
    elements.storeGroup.style.display = 'none';
    elements.addressGroup.style.display = 'none';
  }
  updatePrice();
});

elements.btnPlus.addEventListener('click', function(e) {
  e.preventDefault();
  const currentQty = parseInt(elements.qty.value);
  elements.qty.value = currentQty + 1;
  updatePrice();
});

elements.btnMinus.addEventListener('click', function(e) {
  e.preventDefault();
  const currentQty = parseInt(elements.qty.value);
  if (currentQty > 1) {
    elements.qty.value = currentQty - 1;
    updatePrice();
  }
});

elements.form.addEventListener('submit', function(e) {
  e.preventDefault();
  
  const phone = document.getElementById('phone').value.trim();
  const account = document.getElementById('accountLast5').value.trim();
  const method = elements.pickup.value;
  const address = document.getElementById('address').value.trim();
  
  if (!/^09\d{8}$/.test(phone)) {
    elements.message.innerHTML = '<div class="error-message">❌ 請輸入正確手機號碼(例:0912345678)</div>';
    return;
  }
  
  if (!/^\d{5}$/.test(account)) {
    elements.message.innerHTML = '<div class="error-message">❌ 帳號後5碼必須是5位數字</div>';
    return;
  }
  
  let finalAddress = '';
  if (method === '7-11' || method === '全家') {
    if (!selectedStore) {
      elements.message.innerHTML = '<div class="error-message">❌ 請選擇門市</div>';
      return;
    }
    if (selectedStore === 'OTHER') {
      const otherCity = document.getElementById('otherStoreCity').value.trim();
      const otherName = document.getElementById('otherStoreName').value.trim();
      if (!otherCity || !otherName) {
        elements.message.innerHTML = '<div class="error-message">❌ 請填寫完整的門市資訊(縣市區域 + 門市名稱)</div>';
        return;
      }
      finalAddress = method + '-其他門市-' + otherCity + '-' + otherName;
    } else {
      finalAddress = selectedStore;
    }
  } else if (method === '宅配' || method === '面交') {
    if (address.length < 5) {
      elements.message.innerHTML = '<div class="error-message">❌ 請填寫完整地址</div>';
      return;
    }
    finalAddress = address;
  } else {
    elements.message.innerHTML = '<div class="error-message">❌ 請選擇取貨方式</div>';
    return;
  }
  
  elements.submitBtn.disabled = true;
  elements.submitBtn.textContent = '處理中...';
  elements.message.innerHTML = '';
  
  const quantity = parseInt(elements.qty.value);
  const subtotal = CFG.PRICE * quantity;
  let shipping = 0;
  if (method === '宅配') {
    shipping = quantity >= CFG.FREE ? 0 : CFG.SHIP_D;
  } else if (method === '7-11' || method === '全家') {
    shipping = quantity >= CFG.FREE ? 0 : CFG.SHIP_S;
  }
  
  const total = subtotal + shipping;
  const orderId = generateOrderId();
  const name = document.getElementById('name').value;
  const email = document.getElementById('email').value;
  const note = document.getElementById('note').value || '無';
  
  const formData1 = {
    access_key: CFG.KEY,
    subject: '🛒 新訂單 ' + orderId + ' - 渝味食記',
    from_name: '渝味食記訂購系統',
    email: CFG.EMAIL,
    message: '訂單編號:' + orderId + '\n姓名:' + name + '\n電話:' + phone + '\nEmail:' + email + '\n取貨方式:' + method + '\n地址/門市:' + finalAddress + '\n帳號後5碼:' + account + '\n數量:' + quantity + '罐\n小計:NT$ ' + subtotal + '\n運費:NT$ ' + shipping + '\n總計:NT$ ' + total + '\n備註:' + note
  };
  
  const formData2 = {
    access_key: CFG.KEY,
    from_name: '渝味食記訂購系統',
    email: email,
    message: '親愛的 ' + name + ' 您好,訂單編號:' + orderId + '\n商品:四川辣椒醬 x ' + quantity + '罐\n總計:NT$ ' + total + '\n取貨方式:' + method + '\n地址/門市:' + finalAddress
  };
  
  fetch('https://api.web3forms.com/submit', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(formData1)
  })
  .then(function(response) {
    return fetch('https://api.web3forms.com/submit', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(formData2)
    });
  })
  .then(function(response) {
    elements.message.innerHTML = '<div class="success-message">✅ 訂單已成功送出!<br><strong>訂單編號:' + orderId + '</strong><br><br>我們已收到您的訂單,會盡快與您聯繫。</div>';
    elements.form.reset();
    elements.qty.value = 1;
    selectedStore = '';
    elements.storeGroup.style.display = 'none';
    elements.addressGroup.style.display = 'none';
    updatePrice();
  })
  .catch(function(error) {
    console.error(error);
    elements.message.innerHTML = '<div class="error-message">❌ 訂單送出失敗,請稍後再試</div>';
  })
  .finally(function() {
    elements.submitBtn.disabled = false;
    elements.submitBtn.textContent = '確認訂購';
  });
});

updatePrice();
})();
</script>
</body>
</html>
