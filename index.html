
<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>渝味食記 - 四川濃香型辣椒醬</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: 'Microsoft JhengHei', Arial, sans-serif; background: linear-gradient(135deg, #d32f2f 0%, #f44336 100%); min-height: 100vh; padding: 20px; }
.container { max-width: 800px; margin: 0 auto; background: white; border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); overflow: hidden; }
.header { background: linear-gradient(135deg, #b71c1c 0%, #d32f2f 100%); color: white; padding: 40px 30px; text-align: center; }
.header h1 { font-size: 2.5em; margin-bottom: 10px; text-shadow: 2px 2px 4px rgba(0,0,0,0.2); }
.header p { font-size: 1.1em; opacity: 0.95; }
.ig-link { display: inline-block; margin-top: 10px; padding: 8px 20px; background: rgba(255,255,255,0.2); border-radius: 20px; color: white; text-decoration: none; transition: background 0.3s; }
.ig-link:hover { background: rgba(255,255,255,0.3); }
.product-section { padding: 40px 30px; }
.product-card { background: linear-gradient(135deg, #fff5f5 0%, #ffebee 100%); border-radius: 15px; padding: 30px; border: 3px solid #f44336; }
.product-header { display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; margin-bottom: 20px; }
.product-name { font-size: 1.8em; color: #b71c1c; font-weight: bold; }
.product-price { font-size: 1.6em; color: #d32f2f; font-weight: bold; }
.special-badge { display: inline-block; background: #ff6b6b; color: white; padding: 5px 15px; border-radius: 20px; font-size: 0.9em; margin-left: 10px; }
.highlight { background: #fff3bf; padding: 15px; border-radius: 10px; margin: 15px 0; border-left: 4px solid #f44336; }
.highlight strong { color: #b71c1c; }
.product-intro { background: linear-gradient(135deg, #fff8f0 0%, #ffe8e8 100%); border-radius: 15px; padding: 25px; margin: 20px 0; border: 2px solid #ff6b6b; line-height: 1.8; }
.product-intro h3 { color: #b71c1c; margin-bottom: 15px; font-size: 1.3em; }
.product-intro p { color: #333; margin-bottom: 12px; font-size: 1.05em; }
.product-intro strong { color: #d32f2f; }
.features-box { background: white; border-radius: 10px; padding: 15px; margin: 15px 0; }
.feature-item { color: #d32f2f; margin-bottom: 8px; font-weight: bold; }
.feature-item:last-child { margin-bottom: 0; }
.slogan { color: #b71c1c; font-weight: bold; font-size: 1.15em; margin: 15px 0; }
.specs-box { background: #fff3bf; border-radius: 8px; padding: 12px; margin-top: 15px; border-left: 4px solid #ff6b6b; }
.specs-box div { color: #333; margin-bottom: 5px; }
.specs-box div:last-child { margin-bottom: 0; }
.form-group { margin: 20px 0; }
.form-group label { display: block; margin-bottom: 8px; color: #333; font-weight: bold; }
.form-group input, .form-group select, .form-group textarea { width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 1em; transition: border-color 0.3s; }
.form-group input:focus, .form-group select:focus, .form-group textarea:focus { outline: none; border-color: #f44336; }
.quantity-control { display: flex; align-items: center; gap: 15px; }
.quantity-control button { width: 40px; height: 40px; border: none; background: #f44336; color: white; font-size: 1.5em; border-radius: 8px; cursor: pointer; transition: background 0.3s; user-select: none; }
.quantity-control button:hover { background: #d32f2f; }
.quantity-control button:active { transform: scale(0.95); }
.quantity-control input { width: 80px; text-align: center; font-size: 1.2em; font-weight: bold; pointer-events: none; }
.total-section { background: #f8f9fa; padding: 20px; border-radius: 10px; margin: 20px 0; transition: all 0.3s ease; }
.total-row { display: flex; justify-content: space-between; margin: 10px 0; font-size: 1.1em; }
.total-row.final { font-size: 1.5em; font-weight: bold; color: #b71c1c; border-top: 2px solid #ddd; padding-top: 10px; margin-top: 15px; }
.notice { background: #fff3bf; padding: 15px; border-radius: 10px; margin: 20px 0; text-align: center; font-weight: bold; color: #b71c1c; border: 2px dashed #ffa94d; transition: all 0.3s ease; }
.submit-btn { width: 100%; padding: 18px; background: linear-gradient(135deg, #b71c1c 0%, #d32f2f 100%); color: white; border: none; border-radius: 12px; font-size: 1.3em; font-weight: bold; cursor: pointer; transition: transform 0.2s, box-shadow 0.2s; margin-bottom: 10px; }
.submit-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(183, 28, 28, 0.4); }
.submit-btn:disabled { background: #ccc; cursor: not-allowed; transform: none; }
.success-message { background: #d3f9d8; padding: 20px; border-radius: 10px; margin: 20px 0; text-align: center; color: #2b8a3e; font-weight: bold; border: 2px solid #51cf66; }
.error-message { background: #ffe3e3; padding: 20px; border-radius: 10px; margin: 20px 0; text-align: center; color: #b71c1c; font-weight: bold; border: 2px solid #f44336; }
.store-section { background: #f8f9fa; padding: 15px; border-radius: 10px; margin-top: 10px; border: 2px solid #e9ecef; }
.store-region { margin-bottom: 15px; }
.store-region:last-child { margin-bottom: 0; }
.store-region label { font-size: 0.95em; color: #495057; margin-bottom: 5px; display: block; }
#addressGroup { display: none; }
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <h1>🌶️ 渝味食記 🌶️</h1>
    <p>四川濃香型辣椒醬</p>
    <a href="https://www.instagram.com/yuweishiji" target="_blank" class="ig-link">📷 追蹤我們的 Instagram</a>
  </div>

  <div class="product-section">
    <div class="product-card">
      <div class="product-header">
        <div>
          <span class="product-name">四川濃香型辣椒醬</span>
          <span class="special-badge">🔥 麻辣鮮香</span>
        </div>
        <div class="product-price">NT$ 250 / 罐</div>
      </div>

      <div class="highlight">
        <strong>手工製作、無添加防腐劑,開封後需冷藏保存 ⚠️</strong>
      </div>

      <div class="product-intro">
        <h3>🌶️ 渝味食記-濃香型四川辣椒醬</h3>
        <p><strong>四川的靈魂,不只在麵裡,也在這一瓢辣油裡!</strong></p>
        <p style="color: #555;">
          我們的手工辣椒,是每天親炒現做,從挑椒、炸香料到熬油,每一步都用心。<br>
          辣得過癮卻不嗆喉,麻得香氣層層堆疊——拌麵、炒菜、沾水餃都超搭!
        </p>
        <div class="features-box">
          <div class="feature-item">💥 無添加防腐劑</div>
          <div class="feature-item">💥 純手工熬煮</div>
          <div class="feature-item">💥 香、麻、辣三味俱全</div>
          <div class="feature-item">💥 添加30多種香料</div>
        </div>
        <p class="slogan">一匙下去,整碗都活了🔥</p>
        <div class="specs-box">
          <div><strong>容量:</strong> 150g/瓶</div>
          <div><strong>保存期限:</strong> 冷藏保存半年 / 常溫保存3個月</div>
        </div>
      </div>

      <form id="orderForm">
        <div class="form-group">
          <label>購買數量</label>
          <div class="quantity-control">
            <button type="button" id="btnMinus">−</button>
            <input type="number" id="qty" value="1" min="1" readonly>
            <button type="button" id="btnPlus">+</button>
          </div>
        </div>

        <div class="notice" id="freeShipNotice">🎉 購買10罐(含)以上免運費!</div>

        <div class="form-group"><label>姓名 *</label><input type="text" id="name" required></div>
        <div class="form-group"><label>電話 *</label><input type="tel" id="phone" required placeholder="例:0912345678"></div>
        <div class="form-group"><label>Email *</label><input type="email" id="email" required></div>
        
        <div class="form-group">
          <label>取貨方式 *</label>
          <select id="pickup" required>
            <option value="">請選擇取貨方式</option>
            <option value="7-11">7-11 超商取貨</option>
            <option value="全家">全家超商取貨</option>
            <option value="宅配">宅配</option>
            <option value="面交">面交</option>
          </select>
        </div>

        <div class="form-group" id="storeSelectGroup" style="display:none;">
          <label>選擇門市 *</label>
          <div class="store-section" id="storeSection"></div>
        </div>

        <div class="form-group" id="addressGroup">
          <label id="addressLabel">收貨地址 *</label>
          <textarea id="address" rows="3" placeholder="請填寫完整地址"></textarea>
        </div>

        <div class="form-group">
          <label>匯款帳號後5碼 *</label>
          <input type="text" id="accountLast5" maxlength="5" pattern="[0-9]{5}" required placeholder="請填寫5位數字">
        </div>
        <div class="form-group">
          <label>備註</label>
          <textarea id="note" rows="2" placeholder="其他需求或備註"></textarea>
        </div>

        <div class="total-section">
          <div class="total-row"><span>小計:</span><span id="subtotalDisplay">NT$ 250</span></div>
          <div class="total-row"><span>運費:</span><span id="shippingDisplay">NT$ 130</span></div>
          <div class="total-row final"><span>總計:</span><span id="totalDisplay">NT$ 380</span></div>
        </div>

        <button type="submit" class="submit-btn" id="submitBtn">確認訂購</button>
        <div id="message"></div>
      </form>
    </div>
  </div>
</div>
<script>
const WEB3FORMS_ACCESS_KEY='63c8b2d8-bddb-46cb-b683-e3c0becf31bf';
const MERCHANT_EMAIL='bonnywu992@gmail.com';
var PRICE=250, SHIPPING_DELIVERY=160, SHIPPING_STORE=130, FREE_SHIPPING_QTY=10;

// 簡化的門市資料 - 每個區域只有一個門市
const storeData = {
  '7-11': {
    '台北市': {
      '中正區': ['中正門市'], '大同區': ['大同門市'], '中山區': ['中山門市'], 
      '松山區': ['松山門市'], '大安區': ['大安門市'], '萬華區': ['萬華門市'],
      '信義區': ['信義門市'], '士林區': ['士林門市'], '北投區': ['北投門市'],
      '內湖區': ['內湖門市'], '南港區': ['南港門市'], '文山區': ['文山門市']
    },
    '新北市': {
      '板橋區': ['板橋門市'], '三重區': ['三重門市'], '中和區': ['中和門市'],
      '永和區': ['永和門市'], '新莊區': ['新莊門市'], '新店區': ['新店門市'],
      '樹林區': ['樹林門市'], '鶯歌區': ['鶯歌門市'], '三峽區': ['三峽門市'],
      '淡水區': ['淡水門市'], '汐止區': ['汐止門市'], '瑞芳區': ['瑞芳門市'],
      '土城區': ['土城門市'], '蘆洲區': ['蘆洲門市'], '五股區': ['五股門市'],
      '泰山區': ['泰山門市'], '林口區': ['林口門市'], '深坑區': ['深坑門市'],
      '石碇區': ['石碇門市'], '坪林區': ['坪林門市'], '三芝區': ['三芝門市'],
      '石門區': ['石門門市'], '八里區': ['八里門市'], '平溪區': ['平溪門市'],
      '雙溪區': ['雙溪門市'], '貢寮區': ['貢寮門市'], '金山區': ['金山門市'],
      '萬里區': ['萬里門市'], '烏來區': ['烏來門市']
    },
    '基隆市': {
      '仁愛區': ['仁愛門市'], '信義區': ['信義門市'], '中正區': ['中正門市'],
      '中山區': ['中山門市'], '安樂區': ['安樂門市'], '暖暖區': ['暖暖門市'],
      '七堵區': ['七堵門市']
    },
    '桃園市': {
      '桃園區': ['桃園門市'], '中壢區': ['中壢門市'], '平鎮區': ['平鎮門市'],
      '八德區': ['八德門市'], '楊梅區': ['楊梅門市'], '蘆竹區': ['蘆竹門市'],
      '大溪區': ['大溪門市'], '龍潭區': ['龍潭門市'], '龜山區': ['龜山門市'],
      '大園區': ['大園門市'], '觀音區': ['觀音門市'], '新屋區': ['新屋門市'],
      '復興區': ['復興門市']
    },
    '新竹市': {
      '東區': ['東區門市'], '北區': ['北區門市'], '香山區': ['香山門市']
    },
    '新竹縣': {
      '竹北市': ['竹北門市'], '竹東鎮': ['竹東門市'], '新埔鎮': ['新埔門市'],
      '關西鎮': ['關西門市'], '湖口鄉': ['湖口門市'], '新豐鄉': ['新豐門市'],
      '芎林鄉': ['芎林門市'], '橫山鄉': ['橫山門市'], '北埔鄉': ['北埔門市'],
      '寶山鄉': ['寶山門市'], '峨眉鄉': ['峨眉門市'], '尖石鄉': ['尖石門市'],
      '五峰鄉': ['五峰門市']
    },
    '苗栗縣': {
      '苗栗市': ['苗栗門市'], '頭份市': ['頭份門市'], '竹南鎮': ['竹南門市'],
      '後龍鎮': ['後龍門市'], '通霄鎮': ['通霄門市'], '苑裡鎮': ['苑裡門市'],
      '卓蘭鎮': ['卓蘭門市'], '造橋鄉': ['造橋門市'], '西湖鄉': ['西湖門市'],
      '頭屋鄉': ['頭屋門市'], '公館鄉': ['公館門市'], '銅鑼鄉': ['銅鑼門市'],
      '三義鄉': ['三義門市'], '大湖鄉': ['大湖門市'], '獅潭鄉': ['獅潭門市'],
      '三灣鄉': ['三灣門市'], '南庄鄉': ['南庄門市'], '泰安鄉': ['泰安門市']
    },
    '台中市': {
      '中區': ['中區門市'], '東區': ['東區門市'], '南區': ['南區門市'],
      '西區': ['西區門市'], '北區': ['北區門市'], '西屯區': ['西屯門市'],
      '南屯區': ['南屯門市'], '北屯區': ['北屯門市'], '豐原區': ['豐原門市'],
      '大里區': ['大里門市'], '太平區': ['太平門市'], '清水區': ['清水門市'],
      '沙鹿區': ['沙鹿門市'], '大甲區': ['大甲門市'], '東勢區': ['東勢門市'],
      '梧棲區': ['梧棲門市'], '烏日區': ['烏日門市'], '神岡區': ['神岡門市'],
      '大肚區': ['大肚門市'], '大雅區': ['大雅門市'], '后里區': ['后里門市'],
      '霧峰區': ['霧峰門市'], '潭子區': ['潭子門市'], '龍井區': ['龍井門市'],
      '外埔區': ['外埔門市'], '和平區': ['和平門市'], '石岡區': ['石岡門市'],
      '大安區': ['大安門市'], '新社區': ['新社門市']
    },
    '彰化縣': {
      '彰化市': ['彰化門市'], '員林市': ['員林門市'], '和美鎮': ['和美門市'],
      '鹿港鎮': ['鹿港門市'], '溪湖鎮': ['溪湖門市'], '二林鎮': ['二林門市'],
      '田中鎮': ['田中門市'], '北斗鎮': ['北斗門市'], '花壇鄉': ['花壇門市'],
      '芬園鄉': ['芬園門市'], '大村鄉': ['大村門市'], '永靖鄉': ['永靖門市'],
      '伸港鄉': ['伸港門市'], '線西鄉': ['線西門市'], '福興鄉': ['福興門市'],
      '秀水鄉': ['秀水門市'], '埔心鄉': ['埔心門市'], '埔鹽鄉': ['埔鹽門市'],
      '大城鄉': ['大城門市'], '芳苑鄉': ['芳苑門市'], '竹塘鄉': ['竹塘門市'],
      '社頭鄉': ['社頭門市'], '二水鄉': ['二水門市'], '田尾鄉': ['田尾門市'],
      '埤頭鄉': ['埤頭門市'], '溪州鄉': ['溪州門市']
    },
    '南投縣': {
      '南投市': ['南投門市'], '埔里鎮': ['埔里門市'], '草屯鎮': ['草屯門市'],
      '竹山鎮': ['竹山門市'], '集集鎮': ['集集門市'], '名間鄉': ['名間門市'],
      '鹿谷鄉': ['鹿谷門市'], '中寮鄉': ['中寮門市'], '魚池鄉': ['魚池門市'],
      '國姓鄉': ['國姓門市'], '水里鄉': ['水里門市'], '信義鄉': ['信義門市'],
      '仁愛鄉': ['仁愛門市']
    },
    '雲林縣': {
      '斗六市': ['斗六門市'], '斗南鎮': ['斗南門市'], '虎尾鎮': ['虎尾門市'],
      '西螺鎮': ['西螺門市'], '土庫鎮': ['土庫門市'], '北港鎮': ['北港門市'],
      '林內鄉': ['林內門市'], '古坑鄉': ['古坑門市'], '大埤鄉': ['大埤門市'],
      '莿桐鄉': ['莿桐門市'], '褒忠鄉': ['褒忠門市'], '二崙鄉': ['二崙門市'],
      '崙背鄉': ['崙背門市'], '麥寮鄉': ['麥寮門市'], '東勢鄉': ['東勢門市'],
      '台西鄉': ['台西門市'], '四湖鄉': ['四湖門市'], '口湖鄉': ['口湖門市'],
      '水林鄉': ['水林門市'], '元長鄉': ['元長門市']
    },
    '嘉義市': {
      '東區': ['東區門市'], '西區': ['西區門市']
    },
    '嘉義縣': {
      '太保市': ['太保門市'], '朴子市': ['朴子門市'], '布袋鎮': ['布袋門市'],
      '大林鎮': ['大林門市'], '民雄鄉': ['民雄門市'], '溪口鄉': ['溪口門市'],
      '新港鄉': ['新港門市'], '六腳鄉': ['六腳門市'], '東石鄉': ['東石門市'],
      '義竹鄉': ['義竹門市'], '鹿草鄉': ['鹿草門市'], '水上鄉': ['水上門市'],
      '中埔鄉': ['中埔門市'], '竹崎鄉': ['竹崎門市'], '梅山鄉': ['梅山門市'],
      '番路鄉': ['番路門市'], '大埔鄉': ['大埔門市'], '阿里山鄉': ['阿里山門市']
    },
    '台南市': {
      '中西區': ['中西門市'], '東區': ['東區門市'], '南區': ['南區門市'],
      '北區': ['北區門市'], '安平區': ['安平門市'], '安南區': ['安南門市'],
      '永康區': ['永康門市'], '歸仁區': ['歸仁門市'], '新化區': ['新化門市'],
      '左鎮區': ['左鎮門市'], '玉井區': ['玉井門市'], '楠西區': ['楠西門市'],
      '南化區': ['南化門市'], '仁德區': ['仁德門市'], '關廟區': ['關廟門市'],
      '龍崎區': ['龍崎門市'], '官田區': ['官田門市'], '麻豆區': ['麻豆門市'],
      '佳里區': ['佳里門市'], '西港區': ['西港門市'], '七股區': ['七股門市'],
      '將軍區': ['將軍門市'], '學甲區': ['學甲門市'], '北門區': ['北門門市'],
      '新營區': ['新營門市'], '後壁區': ['後壁門市'], '白河區': ['白河門市'],
      '東山區': ['東山門市'], '六甲區': ['六甲門市'], '下營區': ['下營門市'],
      '柳營區': ['柳營門市'], '鹽水區': ['鹽水門市'], '善化區': ['善化門市'],
      '大內區': ['大內門市'], '山上區': ['山上門市'], '新市區': ['新市門市'],
      '安定區': ['安定門市']
    },
    '高雄市': {
      '新興區': ['新興門市'], '前金區': ['前金門市'], '苓雅區': ['苓雅門市'],
      '鹽埕區': ['鹽埕門市'], '鼓山區': ['鼓山門市'], '旗津區': ['旗津門市'],
      '前鎮區': ['前鎮門市'], '三民區': ['三民門市'], '左營區': ['左營門市'],
      '楠梓區': ['楠梓門市'], '小港區': ['小港門市'], '鳳山區': ['鳳山門市'],
      '林園區': ['林園門市'], '大寮區': ['大寮門市'], '大樹區': ['大樹門市'],
      '大社區': ['大社門市'], '仁武區': ['仁武門市'], '鳥松區': ['鳥松門市'],
      '岡山區': ['岡山門市'], '橋頭區': ['橋頭門市'], '燕巢區': ['燕巢門市'],
      '田寮區': ['田寮門市'], '阿蓮區': ['阿蓮門市'], '路竹區': ['路竹門市'],
      '湖內區': ['湖內門市'], '茄萣區': ['茄萣門市'], '永安區': ['永安門市'],
      '彌陀區': ['彌陀門市'], '梓官區': ['梓官門市'], '旗山區': ['旗山門市'],
      '美濃區': ['美濃門市'], '六龜區': ['六龜門市'], '甲仙區': ['甲仙門市'],
      '杉林區': ['杉林門市'], '內門區': ['內門門市'], '茂林區': ['茂林門市'],
      '桃源區': ['桃源門市'], '那瑪夏區': ['那瑪夏門市']
    },
    '宜蘭縣': {
      '宜蘭市': ['宜蘭門市'], '羅東鎮': ['羅東門市'], '蘇澳鎮': ['蘇澳門市'],
      '頭城鎮': ['頭城門市'], '礁溪鄉': ['礁溪門市'], '壯圍鄉': ['壯圍門市'],
      '員山鄉': ['員山門市'], '冬山鄉': ['冬山門市'], '五結鄉': ['五結門市'],
      '三星鄉': ['三星門市'], '大同鄉': ['大同門市'], '南澳鄉': ['南澳門市']
    },
    '花蓮縣': {
      '花蓮市': ['花蓮門市'], '鳳林鎮': ['鳳林門市'], '玉里鎮': ['玉里門市'],
      '新城鄉': ['新城門市'], '吉安鄉': ['吉安門市'], '壽豐鄉': ['壽豐門市'],
      '光復鄉': ['光復門市'], '豐濱鄉': ['豐濱門市'], '瑞穗鄉': ['瑞穗門市'],
      '富里鄉': ['富里門市'], '秀林鄉': ['秀林門市'], '萬榮鄉': ['萬榮門市'],
      '卓溪鄉': ['卓溪門市']
    },
    '台東縣': {
      '台東市': ['台東門市'], '成功鎮': ['成功門市'], '關山鎮': ['關山門市'],
      '卑南鄉': ['卑南門市'], '鹿野鄉': ['鹿野門市'], '池上鄉': ['池上門市'],
      '東河鄉': ['東河門市'], '長濱鄉': ['長濱門市'], '太麻里鄉': ['太麻里門市'],
      '大武鄉': ['大武門市'], '綠島鄉': ['綠島門市'], '海端鄉': ['海端門市'],
      '延平鄉': ['延平門市'], '金峰鄉': ['金峰門市'], '達仁鄉': ['達仁門市'],
      '蘭嶼鄉': ['蘭嶼門市']
    },
    '澎湖縣': {
      '馬公市': ['馬公門市'], '湖西鄉': ['湖西門市'], '白沙鄉': ['白沙門市'],
      '西嶼鄉': ['西嶼門市'], '望安鄉': ['望安門市'], '七美鄉': ['七美門市']
    },
    '金門縣': {
      '金城鎮': ['金城門市'], '金湖鎮': ['金湖門市'], '金沙鎮': ['金沙門市'],
      '金寧鄉': ['金寧門市'], '烈嶼鄉': ['烈嶼門市'], '烏坵鄉': ['烏坵門市']
    },
    '連江縣': {
      '南竿鄉': ['南竿門市'], '北竿鄉': ['北竿門市'], 
      '莒光鄉': ['莒光門市'], '東引鄉': ['東引門市']
    },
    '屏東縣': {
      '屏東市': ['屏東門市'], '潮州鎮': ['潮州門市'], '東港鎮': ['東港門市'],
      '恆春鎮': ['恆春門市'], '萬丹鄉': ['萬丹門市'], '長治鄉': ['長治門市'],
      '麟洛鄉': ['麟洛門市'], '九如鄉': ['九如門市'], '里港鄉': ['里港門市'],
      '鹽埔鄉': ['鹽埔門市'], '高樹鄉': ['高樹門市'], '萬巒鄉': ['萬巒門市'],
      '內埔鄉': ['內埔門市'], '竹田鄉': ['竹田門市'], '新埤鄉': ['新埤門市'],
      '枋寮鄉': ['枋寮門市'], '新園鄉': ['新園門市'], '崁頂鄉': ['崁頂門市'],
      '林邊鄉': ['林邊門市'], '南州鄉': ['南州門市'], '佳冬鄉': ['佳冬門市'],
      '琉球鄉': ['琉球門市'], '車城鄉': ['車城門市'], '滿州鄉': ['滿州門市'],
      '枋山鄉': ['枋山門市'], '三地門鄉': ['三地門門市'], '霧台鄉': ['霧台門市'],
      '瑪家鄉': ['瑪家門市'], '泰武鄉': ['泰武門市'], '來義鄉': ['來義門市'],
      '春日鄉': ['春日門市'], '獅子鄉': ['獅子門市'], '牡丹鄉': ['牡丹門市']
    }
  },
  '全家': {
    '台北市': {
      '中正區': ['中正店'], '大同區': ['大同店'], '中山區': ['中山店'], 
      '松山區': ['松山店'], '大安區': ['大安店'], '萬華區': ['萬華店'],
      '信義區': ['信義店'], '士林區': ['士林店'], '北投區': ['北投店'],
      '內湖區': ['內湖店'], '南港區': ['南港店'], '文山區': ['文山店']
    },
    '新北市': {
      '板橋區': ['板橋店'], '三重區': ['三重店'], '中和區': ['中和店'],
      '永和區': ['永和店'], '新莊區': ['新莊店'], '新店區': ['新店店'],
      '樹林區': ['樹林店'], '鶯歌區': ['鶯歌店'], '三峽區': ['三峽店'],
      '淡水區': ['淡水店'], '汐止區': ['汐止店'], '瑞芳區': ['瑞芳店'],
      '土城區': ['土城店'], '蘆洲區': ['蘆洲店'], '五股區': ['五股店'],
      '泰山區': ['泰山店'], '林口區': ['林口店'], '深坑區': ['深坑店'],
      '石碇區': ['石碇店'], '坪林區': ['坪林店'], '三芝區': ['三芝店'],
      '石門區': ['石門店'], '八里區': ['八里店'], '平溪區': ['平溪店'],
      '雙溪區': ['雙溪店'], '貢寮區': ['貢寮店'], '金山區': ['金山店'],
      '萬里區': ['萬里店'], '烏來區': ['烏來店']
    },
    '基隆市': {
      '仁愛區': ['仁愛店'], '信義區': ['信義店'], '中正區': ['中正店'],
      '中山區': ['中山店'], '安樂區': ['安樂店'], '暖暖區': ['暖暖店'],
      '七堵區': ['七堵店']
    },
    '桃園市': {
      '桃園區': ['桃園店'], '中壢區': ['中壢店'], '平鎮區': ['平鎮店'],
      '八德區': ['八德店'], '楊梅區': ['楊梅店'], '蘆竹區': ['蘆竹店'],
      '大溪區': ['大溪店'], '龍潭區': ['龍潭店'], '龜山區': ['龜山店'],
      '大園區': ['大園店'], '觀音區': ['觀音店'], '新屋區': ['新屋店'],
      '復興區': ['復興店']
    },
    '新竹市': {
      '東區': ['東區店'], '北區': ['北區店'], '香山區': ['香山店']
    },
    '新竹縣': {
      '竹北市': ['竹北店'], '竹東鎮': ['竹東店'], '新埔鎮': ['新埔店'],
      '關西鎮': ['關西店'], '湖口鄉': ['湖口店'], '新豐鄉': ['新豐店'],
      '芎林鄉': ['芎林店'], '橫山鄉': ['橫山店'], '北埔鄉': ['北埔店'],
      '寶山鄉': ['寶山店'], '峨眉鄉': ['峨眉店'], '尖石鄉': ['尖石店'],
      '五峰鄉': ['五峰店']
    },
    '苗栗縣': {
      '苗栗市': ['苗栗店'], '頭份市': ['頭份店'], '竹南鎮': ['竹南店'],
      '後龍鎮': ['後龍店'], '通霄鎮': ['通霄店'], '苑裡鎮': ['苑裡店'],
      '卓蘭鎮': ['卓蘭店'], '造橋鄉': ['造橋店'], '西湖鄉': ['西湖店'],
      '頭屋鄉': ['頭屋店'], '公館鄉': ['公館店'], '銅鑼鄉': ['銅鑼店'],
      '三義鄉': ['三義店'], '大湖鄉': ['大湖店'], '獅潭鄉': ['獅潭店'],
      '三灣鄉': ['三灣店'], '南庄鄉': ['南庄店'], '泰安鄉': ['泰安店']
    },
    '台中市': {
      '中區': ['中區店'], '東區': ['東區店'], '南區': ['南區店'],
      '西區': ['西區店'], '北區': ['北區店'], '西屯區': ['西屯店'],
      '南屯區': ['南屯店'], '北屯區': ['北屯店'], '豐原區': ['豐原店'],
      '大里區': ['大里店'], '太平區': ['太平店'], '清水區': ['清水店'],
      '沙鹿區': ['沙鹿店'], '大甲區': ['大甲店'], '東勢區': ['東勢店'],
      '梧棲區': ['梧棲店'], '烏日區': ['烏日店'], '神岡區': ['神岡店'],
      '大肚區': ['大肚店'], '大雅區': ['大雅店'], '后里區': ['后里店'],
      '霧峰區': ['霧峰店'], '潭子區': ['潭子店'], '龍井區': ['龍井店'],
      '外埔區': ['外埔店'], '和平區': ['和平店'], '石岡區': ['石岡店'],
      '大安區': ['大安店'], '新社區': ['新社店']
    },
    '彰化縣': {
      '彰化市': ['彰化店'], '員林市': ['員林店'], '和美鎮': ['和美店'],
      '鹿港鎮': ['鹿港店'], '溪湖鎮': ['溪湖店'], '二林鎮': ['二林店'],
      '田中鎮': ['田中店'], '北斗鎮': ['北斗店'], '花壇鄉': ['花壇店'],
      '芬園鄉': ['芬園店'], '大村鄉': ['大村店'], '永靖鄉': ['永靖店'],
      '伸港鄉': ['伸港店'], '線西鄉': ['線西店'], '福興鄉': ['福興店'],
      '秀水鄉': ['秀水店'], '埔心鄉': ['埔心店'], '埔鹽鄉': ['埔鹽店'],
      '大城鄉': ['大城店'], '芳苑鄉': ['芳苑店'], '竹塘鄉': ['竹塘店'],
      '社頭鄉': ['社頭店'], '二水鄉': ['二水店'], '田尾鄉': ['田尾店'],
      '埤頭鄉': ['埤頭店'], '溪州鄉': ['溪州店']
    },
    '南投縣': {
      '南投市': ['南投店'], '埔里鎮': ['埔里店'], '草屯鎮': ['草屯店'],
      '竹山鎮': ['竹山店'], '集集鎮': ['集集店'], '名間鄉': ['名間店'],
      '鹿谷鄉': ['鹿谷店'], '中寮鄉': ['中寮店'], '魚池鄉': ['魚池店'],
      '國姓鄉': ['國姓店'], '水里鄉': ['水里店'], '信義鄉': ['信義店'],
      '仁愛鄉': ['仁愛店']
    },
    '雲林縣': {
      '斗六市': ['斗六店'], '斗南鎮': ['斗南店'], '虎尾鎮': ['虎尾店'],
      '西螺鎮': ['西螺店'], '土庫鎮': ['土庫店'], '北港鎮': ['北港店'],
      '林內鄉': ['林內店'], '古坑鄉': ['古坑店'], '大埤鄉': ['大埤店'],
      '莿桐鄉': ['莿桐店'], '褒忠鄉': ['褒忠店'], '二崙鄉': ['二崙店'],
      '崙背鄉': ['崙背店'], '麥寮鄉': ['麥寮店'], '東勢鄉': ['東勢店'],
      '台西鄉': ['台西店'], '四湖鄉': ['四湖店'], '口湖鄉': ['口湖店'],
      '水林鄉': ['水林店'], '元長鄉': ['元長店']
    },
    '嘉義市': {
      '東區': ['東區店'], '西區': ['西區店']
    },
    '嘉義縣': {
      '太保市': ['太保店'], '朴子市': ['朴子店'], '布袋鎮': ['布袋店'],
      '大林鎮': ['大林店'], '民雄鄉': ['民雄店'], '溪口鄉': ['溪口店'],
      '新港鄉': ['新港店'], '六腳鄉': ['六腳店'], '東石鄉': ['東石店'],
      '義竹鄉': ['義竹店'], '鹿草鄉': ['鹿草店'], '水上鄉': ['水上店'],
      '中埔鄉': ['中埔店'], '竹崎鄉': ['竹崎店'], '梅山鄉': ['梅山店'],
      '番路鄉': ['番路店'], '大埔鄉': ['大埔店'], '阿里山鄉': ['阿里山店']
    },
    '台南市': {
      '中西區': ['中西店'], '東區': ['東區店'], '南區': ['南區店'],
      '北區': ['北區店'], '安平區': ['安平店'], '安南區': ['安南店'],
      '永康區': ['永康店'], '歸仁區': ['歸仁店'], '新化區': ['新化店'],
      '左鎮區': ['左鎮店'], '玉井區': ['玉井店'], '楠西區': ['楠西店'],
      '南化區': ['南化店'], '仁德區': ['仁德店'], '關廟區': ['關廟店'],
      '龍崎區': ['龍崎店'], '官田區': ['官田店'], '麻豆區': ['麻豆店'],
      '佳里區': ['佳里店'], '西港區': ['西港店'], '七股區': ['七股店'],
      '將軍區': ['將軍店'], '學甲區': ['學甲店'], '北門區': ['北門店'],
      '新營區': ['新營店'], '後壁區': ['後壁店'], '白河區': ['白河店'],
      '東山區': ['東山店'], '六甲區': ['六甲店'], '下營區': ['下營店'],
      '柳營區': ['柳營店'], '鹽水區': ['鹽水店'], '善化區': ['善化店'],
      '大內區': ['大內店'], '山上區': ['山上店'], '新市區': ['新市店'],
      '安定區': ['安定店']
    },
    '高雄市': {
      '新興區': ['新興店'], '前金區': ['前金店'], '苓雅區': ['苓雅店'],
      '鹽埕區': ['鹽埕店'], '鼓山區': ['鼓山店'], '旗津區': ['旗津店'],
      '前鎮區': ['前鎮店'], '三民區': ['三民店'], '左營區': ['左營店'],
      '楠梓區': ['楠梓店'], '小港區': ['小港店'], '鳳山區': ['鳳山店'],
      '林園區': ['林園店'], '大寮區': ['大寮店'], '大樹區': ['大樹店'],
      '大社區': ['大社店'], '仁武區': ['仁武店'], '鳥松區': ['鳥松店'],
      '岡山區': ['岡山店'], '橋頭區': ['橋頭店'], '燕巢區': ['燕巢店'],
      '田寮區': ['田寮店'], '阿蓮區': ['阿蓮店'], '路竹區': ['路竹店'],
      '湖內區': ['湖內店'], '茄萣區': ['茄萣店'], '永安區': ['永安店'],
      '彌陀區': ['彌陀店'], '梓官區': ['梓官店'], '旗山區': ['旗山店'],
      '美濃區': ['美濃店'], '六龜區': ['六龜店'], '甲仙區': ['甲仙店'],
      '杉林區': ['杉林店'], '內門區': ['內門店'], '茂林區': ['茂林店'],
      '桃源區': ['桃源店'], '那瑪夏區': ['那瑪夏店']
    },
    '宜蘭縣': {
      '宜蘭市': ['宜蘭店'], '羅東鎮': ['羅東店'], '蘇澳鎮': ['蘇澳店'],
      '頭城鎮': ['頭城店'], '礁溪鄉': ['礁溪店'], '壯圍鄉': ['壯圍店'],
      '員山鄉': ['員山店'], '冬山鄉': ['冬山店'], '五結鄉': ['五結店'],
      '三星鄉': ['三星店'], '大同鄉': ['大同店'], '南澳鄉': ['南澳店']
    },
    '花蓮縣': {
      '花蓮市': ['花蓮店'], '鳳林鎮': ['鳳林店'], '玉里鎮': ['玉里店'],
      '新城鄉': ['新城店'], '吉安鄉': ['吉安店'], '壽豐鄉': ['壽豐店'],
      '光復鄉': ['光復店'], '豐濱鄉': ['豐濱店'], '瑞穗鄉': ['瑞穗店'],
      '富里鄉': ['富里店'], '秀林鄉': ['秀林店'], '萬榮鄉': ['萬榮店'],
      '卓溪鄉': ['卓溪店']
    },
    '台東縣': {
      '台東市': ['台東店'], '成功鎮': ['成功店'], '關山鎮': ['關山店'],
      '卑南鄉': ['卑南店'], '鹿野鄉': ['鹿野店'], '池上鄉': ['池上店'],
      '東河鄉': ['東河店'], '長濱鄉': ['長濱店'], '太麻里鄉': ['太麻里店'],
      '大武鄉': ['大武店'], '綠島鄉': ['綠島店'], '海端鄉': ['海端店'],
      '延平鄉': ['延平店'], '金峰鄉': ['金峰店'], '達仁鄉': ['達仁店'],
      '蘭嶼鄉': ['蘭嶼店']
    },
    '澎湖縣': {
      '馬公市': ['馬公店'], '湖西鄉': ['湖西店'], '白沙鄉': ['白沙店'],
      '西嶼鄉': ['西嶼店'], '望安鄉': ['望安店'], '七美鄉': ['七美店']
    },
    '金門縣': {
      '金城鎮': ['金城店'], '金湖鎮': ['金湖店'], '金沙鎮': ['金沙店'],
      '金寧鄉': ['金寧店'], '烈嶼鄉': ['烈嶼店'], '烏坵鄉': ['烏坵店']
    },
    '連江縣': {
      '南竿鄉': ['南竿店'], '北竿鄉': ['北竿店'], 
      '莒光鄉': ['莒光店'], '東引鄉': ['東引店']
    },
    '屏東縣': {
      '屏東市': ['屏東店'], '潮州鎮': ['潮州店'], '東港鎮': ['東港店'],
      '恆春鎮': ['恆春店'], '萬丹鄉': ['萬丹店'], '長治鄉': ['長治店'],
      '麟洛鄉': ['麟洛店'], '九如鄉': ['九如店'], '里港鄉': ['里港店'],
      '鹽埔鄉': ['鹽埔店'], '高樹鄉': ['高樹店'], '萬巒鄉': ['萬巒店'],
      '內埔鄉': ['內埔店'], '竹田鄉': ['竹田店'], '新埤鄉': ['新埤店'],
      '枋寮鄉': ['枋寮店'], '新園鄉': ['新園店'], '崁頂鄉': ['崁頂店'],
      '林邊鄉': ['林邊店'], '南州鄉': ['南州店'], '佳冬鄉': ['佳冬店'],
      '琉球鄉': ['琉球店'], '車城鄉': ['車城店'], '滿州鄉': ['滿州店'],
      '枋山鄉': ['枋山店'], '三地門鄉': ['三地門店'], '霧台鄉': ['霧台店'],
      '瑪家鄉': ['瑪家店'], '泰武鄉': ['泰武店'], '來義鄉': ['來義店'],
      '春日鄉': ['春日店'], '獅子鄉': ['獅子店'], '牡丹鄉': ['牡丹店']
    }
  }
};

var qtyInput=document.getElementById('qty');
var btnPlus=document.getElementById('btnPlus');
var btnMinus=document.getElementById('btnMinus');
var subtotalDisplay=document.getElementById('subtotalDisplay');
var shippingDisplay=document.getElementById('shippingDisplay');
var totalDisplay=document.getElementById('totalDisplay');
var freeShipNotice=document.getElementById('freeShipNotice');
var pickupSelect=document.getElementById('pickup');
var storeSelectGroup=document.getElementById('storeSelectGroup');
var addressGroup=document.getElementById('addressGroup');
var storeSection=document.getElementById('storeSection');
var selectedStore = '';
var citySelect, districtSelect, storeSelect;

function generateOrderId(){
    var now=new Date();
    var year=now.getFullYear();
    var month=String(now.getMonth()+1).padStart(2,'0');
    var day=String(now.getDate()).padStart(2,'0');
    var random=Math.floor(Math.random()*10000).toString().padStart(4,'0');
    return 'YW'+year+month+day+random;
}

function updatePrice(){
    var qty=parseInt(qtyInput.value);
    if(isNaN(qty)||qty<1){ qty=1; qtyInput.value=1; }
    var subtotal=PRICE*qty;
    var pickupMethod=pickupSelect.value;
    var shipping=0;
    
    if(pickupMethod === '宅配'){
        shipping = (qty>=FREE_SHIPPING_QTY) ? 0 : SHIPPING_DELIVERY;
    } else if(pickupMethod === '7-11' || pickupMethod === '全家'){
        shipping = (qty>=FREE_SHIPPING_QTY) ? 0 : SHIPPING_STORE;
    } else if(pickupMethod === '面交'){
        shipping = 0;
    } else {
        shipping = (qty>=FREE_SHIPPING_QTY) ? 0 : SHIPPING_STORE;
    }
    
    var total=subtotal+shipping;
    subtotalDisplay.textContent='NT$ '+subtotal;
    
    if(shipping === 0){
        if(pickupMethod === '面交'){
            shippingDisplay.textContent='免運費 (面交) ✓';
        } else {
            shippingDisplay.textContent='免運費 ✓';
        }
    } else {
        shippingDisplay.textContent='NT$ '+shipping;
    }
    
    totalDisplay.textContent='NT$ '+total;

    if(pickupMethod === '面交'){
        freeShipNotice.textContent='🎉 面交免運費!';
        freeShipNotice.style.background='#d3f9d8';
    } else if(qty<FREE_SHIPPING_QTY){
        var left=FREE_SHIPPING_QTY-qty;
        freeShipNotice.textContent='再買 '+left+' 罐即可免運 🎁';
        freeShipNotice.style.background='#fff3bf';
    } else {
        var savedAmount = (pickupMethod === '宅配') ? SHIPPING_DELIVERY : SHIPPING_STORE;
        freeShipNotice.textContent='🎉 已達免運門檻!恭喜省下 NT$ '+savedAmount+' 運費!';
        freeShipNotice.style.background='#d3f9d8';
    }
}

function renderStoreOptions(pickupMethod) {
    storeSection.innerHTML = '';
    selectedStore = '';
    
    if (!storeData[pickupMethod]) return;
    
    var stores = storeData[pickupMethod];
    
    var cityDiv = document.createElement('div');
    cityDiv.className = 'store-region';
    var cityLabel = document.createElement('label');
    cityLabel.textContent = '選擇城市';
    cityDiv.appendChild(cityLabel);
    
    citySelect = document.createElement('select');
    citySelect.className = 'form-group';
    citySelect.style.width = '100%';
    citySelect.style.marginTop = '5px';
    var cityDefault = document.createElement('option');
    cityDefault.value = '';
    cityDefault.textContent = '請選擇城市';
    citySelect.appendChild(cityDefault);
    
    Object.keys(stores).forEach(function(city) {
        var option = document.createElement('option');
        option.value = city;
        option.textContent = city;
        citySelect.appendChild(option);
    });
    cityDiv.appendChild(citySelect);
    storeSection.appendChild(cityDiv);
    
    var districtDiv = document.createElement('div');
    districtDiv.className = 'store-region';
    var districtLabel = document.createElement('label');
    districtLabel.textContent = '選擇區域';
    districtDiv.appendChild(districtLabel);
    
    districtSelect = document.createElement('select');
    districtSelect.className = 'form-group';
    districtSelect.style.width = '100%';
    districtSelect.style.marginTop = '5px';
    districtSelect.disabled = true;
    var districtDefault = document.createElement('option');
    districtDefault.value = '';
    districtDefault.textContent = '請先選擇城市';
    districtSelect.appendChild(districtDefault);
    districtDiv.appendChild(districtSelect);
    storeSection.appendChild(districtDiv);
    
    var storeDiv = document.createElement('div');
    storeDiv.className = 'store-region';
    var storeLabel = document.createElement('label');
    storeLabel.textContent = '選擇門市';
    storeDiv.appendChild(storeLabel);
    
    storeSelect = document.createElement('select');
    storeSelect.className = 'form-group';
    storeSelect.style.width = '100%';
    storeSelect.style.marginTop = '5px';
    storeSelect.disabled = true;
    var storeDefault = document.createElement('option');
    storeDefault.value = '';
    storeDefault.textContent = '請先選擇區域';
    storeSelect.appendChild(storeDefault);
    storeDiv.appendChild(storeSelect);
    storeSection.appendChild(storeDiv);
    
    citySelect.addEventListener('change', function() {
        var selectedCity = this.value;
        districtSelect.innerHTML = '';
        storeSelect.innerHTML = '';
        storeSelect.disabled = true;
        selectedStore = '';
        
        var districtDefault = document.createElement('option');
        districtDefault.value = '';
        districtDefault.textContent = '請選擇區域';
        districtSelect.appendChild(districtDefault);
        
        var storeDefault = document.createElement('option');
        storeDefault.value = '';
        storeDefault.textContent = '請先選擇區域';
        storeSelect.appendChild(storeDefault);
        
        if (selectedCity && stores[selectedCity]) {
            districtSelect.disabled = false;
            Object.keys(stores[selectedCity]).forEach(function(district) {
                var option = document.createElement('option');
                option.value = district;
                option.textContent = district;
                districtSelect.appendChild(option);
            });
        } else {
            districtSelect.disabled = true;
        }
    });
    
    districtSelect.addEventListener('change', function() {
        var selectedCity = citySelect.value;
        var selectedDistrict = this.value;
        storeSelect.innerHTML = '';
        selectedStore = '';
        
        var storeDefault = document.createElement('option');
        storeDefault.value = '';
        storeDefault.textContent = '請選擇門市';
        storeSelect.appendChild(storeDefault);
        
        if (selectedCity && selectedDistrict && stores[selectedCity][selectedDistrict]) {
            storeSelect.disabled = false;
            stores[selectedCity][selectedDistrict].forEach(function(store) {
                var option = document.createElement('option');
                option.value = selectedCity + '-' + selectedDistrict + '-' + store;
                option.textContent = store;
                storeSelect.appendChild(option);
            });
        } else {
            storeSelect.disabled = true;
        }
    });
    
    storeSelect.addEventListener('change', function() {
        selectedStore = this.value;
    });
}

pickupSelect.addEventListener('change', function() {
    var method = this.value;
    var addressInput = document.getElementById('address');
    var addressLabel = document.getElementById('addressLabel');
    
    if (method === '7-11' || method === '全家') {
        storeSelectGroup.style.display = 'block';
        addressGroup.style.display = 'none';
        addressInput.value = '';
        addressInput.readOnly = false;
        addressInput.style.backgroundColor = '';
        renderStoreOptions(method);
    } else if (method === '宅配') {
        storeSelectGroup.style.display = 'none';
        addressGroup.style.display = 'block';
        addressLabel.textContent = '收貨地址 *';
        addressInput.placeholder = '請填寫完整地址';
        addressInput.value = '';
        addressInput.readOnly = false;
        addressInput.style.backgroundColor = '';
    } else if (method === '面交') {
        storeSelectGroup.style.display = 'none';
        addressGroup.style.display = 'block';
        addressLabel.textContent = '面交地點';
        addressInput.value = '802高雄市苓雅區武廟路206號';
        addressInput.readOnly = true;
        addressInput.style.backgroundColor = '#f0f0f0';
        addressInput.placeholder = '';
    } else {
        storeSelectGroup.style.display = 'none';
        addressGroup.style.display = 'none';
        addressInput.value = '';
        addressInput.readOnly = false;
        addressInput.style.backgroundColor = '';
    }
    
    updatePrice();
});

btnPlus.addEventListener('click',function(e){e.preventDefault();qtyInput.value=parseInt(qtyInput.value)+1;updatePrice();});
btnMinus.addEventListener('click',function(e){e.preventDefault();if(parseInt(qtyInput.value)>1){qtyInput.value=parseInt(qtyInput.value)-1;updatePrice();}});

document.getElementById('orderForm').addEventListener('submit',async function(e){
    e.preventDefault();
    var submitBtn=document.getElementById('submitBtn');
    var messageDiv=document.getElementById('message');

    var phone=document.getElementById('phone').value.trim();
    var account=document.getElementById('accountLast5').value.trim();
    var pickupMethod=document.getElementById('pickup').value;
    var addressInput=document.getElementById('address').value.trim();
    
    if(!/^09\d{8}$/.test(phone)){ messageDiv.innerHTML='<div class="error-message">❌ 請輸入正確手機號碼(例:0912345678)</div>'; return; }
    if(!/^\d{5}$/.test(account)){ messageDiv.innerHTML='<div class="error-message">❌ 帳號後5碼必須是5位數字</div>'; return; }
    
    var finalAddress = '';
    if (pickupMethod === '7-11' || pickupMethod === '全家') {
        if (!selectedStore) {
            messageDiv.innerHTML='<div class="error-message">❌ 請選擇門市</div>';
            return;
        }
        finalAddress = selectedStore;
    } else if (pickupMethod === '宅配' || pickupMethod === '面交') {
        if (addressInput.length < 5) {
            messageDiv.innerHTML='<div class="error-message">❌ 請填寫完整地址或地點</div>';
            return;
        }
        finalAddress = addressInput;
    } else {
        messageDiv.innerHTML='<div class="error-message">❌ 請選擇取貨方式</div>';
        return;
    }

    submitBtn.disabled=true; submitBtn.textContent='處理中...'; messageDiv.innerHTML='';

    try{
        var qty=parseInt(qtyInput.value);
        var subtotal=PRICE*qty;
        var shipping=0;
        
        if(pickupMethod === '宅配'){
            shipping = (qty>=FREE_SHIPPING_QTY) ? 0 : SHIPPING_DELIVERY;
        } else if(pickupMethod === '7-11' || pickupMethod === '全家'){
            shipping = (qty>=FREE_SHIPPING_QTY) ? 0 : SHIPPING_STORE;
        } else if(pickupMethod === '面交'){
            shipping = 0;
        }
        
        var total=subtotal+shipping;
        var orderId=generateOrderId();
        var orderTime=new Date().toLocaleString('zh-TW',{year:'numeric',month:'2-digit',day:'2-digit',hour:'2-digit',minute:'2-digit',hour12:false});
        var customerName=document.getElementById('name').value;
        var customerEmail=document.getElementById('email').value;
        var note=document.getElementById('note').value||'無';

        var merchantEmailContent=`╔═══════════════════════════════════╗
🛒 新訂單通知 - 渝味食記
╚═══════════════════════════════════╝
訂單編號:${orderId}
訂單時間:${orderTime}
姓名:${customerName}
電話:${phone}
Email:${customerEmail}
取貨方式:${pickupMethod}
收貨地址/門市:${finalAddress}
匯款帳號後5碼:${account}
商品名稱:【渝味食記】四川濃香型辣椒醬
單價:NT$ ${PRICE}
數量:${qty} 罐
小計:NT$ ${subtotal}
商品小計:NT$ ${subtotal}
運費:${shipping===0?(pickupMethod==='面交'?'免運費 (面交) ✓':'免運費 ✓'):'NT$ '+shipping}
訂單總額:NT$ ${total}
備註:${note}
提醒事項:
${pickupMethod==='面交'?'⚠️ 此訂單選擇面交,請透過 Instagram 與客戶確認時間地點':''}
${shipping===0&&pickupMethod!=='面交'?'✅ 此訂單已達免運門檻':''}
${pickupMethod==='面交'?'✅ 面交免運費':''}`;

        await fetch('https://api.web3forms.com/submit',{
            method:'POST',
            headers:{'Content-Type':'application/json','Accept':'application/json'},
            body:JSON.stringify({access_key:WEB3FORMS_ACCESS_KEY,subject:`🛒 新訂單 ${orderId} - 渝味食記`,from_name:'渝味食記訂購系統',email:MERCHANT_EMAIL,message:merchantEmailContent})
        });

        var customerEmailContent=`親愛的 ${customerName} 您好:
感謝您於 渝味食記 下單!
訂單編號:${orderId}
商品:【渝味食記】四川濃香型辣椒醬 x ${qty} 罐
小計:NT$ ${subtotal}
運費:${shipping===0?(pickupMethod==='面交'?'免運費 (面交) ✓':'免運費 ✓'):'NT$ '+shipping}
總計:NT$ ${total}
取貨方式:${pickupMethod}
收貨地址/門市:${finalAddress}
備註:${note}
請記住您的訂單編號以便查詢
⚠️ 若選擇面交,請透過 Instagram 私訊我們確認時間地點
Instagram: @yuweishiji`;

        await fetch('https://api.web3forms.com/submit',{
            method:'POST',
            headers:{'Content-Type':'application/json','Accept':'application/json'},
            body:JSON.stringify({access_key:WEB3FORMS_ACCESS_KEY,from_name:'渝味食記訂購系統',email:customerEmail,message:customerEmailContent})
        });

        messageDiv.innerHTML=`<div class="success-message">
✅ 訂單已成功送出!<br><br>
<strong>訂單編號:${orderId}</strong><br><br>
我們已收到您的訂單,會盡快與您聯繫。<br>
${pickupMethod==='面交'?'<br>⚠️ 您選擇了面交,請透過 Instagram 私訊我們確認時間地點。<br>':''}
<br>請記住您的訂單編號以便查詢。<br>
📧 確認信已發送至您的 Email<br>
Instagram: @yuweishiji
</div>`;

        document.getElementById('orderForm').reset();
        qtyInput.value=1;
        selectedStore = '';
        storeSelectGroup.style.display = 'none';
        addressGroup.style.display = 'none';
        updatePrice();

    } catch(err){
        console.error(err);
        messageDiv.innerHTML=`<div class="error-message">
❌ 訂單送出失敗<br><br>
請稍後再試,或直接透過 Instagram 聯繫我們:<br><strong>@yuweishiji</strong>
</div>`;
    } finally{
        submitBtn.disabled=false; submitBtn.textContent='確認訂購';
    }
});

updatePrice();
</script>
</body>
</html>

