<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>渝味食記 - 四川濃香型辣椒醬</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: 'Microsoft JhengHei', Arial, sans-serif; background: linear-gradient(135deg, #d32f2f 0%, #f44336 100%); min-height: 100vh; padding: 20px; }
.container { max-width: 800px; margin: 0 auto; background: white; border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); overflow: hidden; }
.header { background: linear-gradient(135deg, #b71c1c 0%, #d32f2f 100%); color: white; padding: 40px 30px; text-align: center; }
.header h1 { font-size: 2.5em; margin-bottom: 10px; text-shadow: 2px 2px 4px rgba(0,0,0,0.2); }
.header p { font-size: 1.1em; opacity: 0.95; }
.ig-link { display: inline-block; margin-top: 10px; padding: 8px 20px; background: rgba(255,255,255,0.2); border-radius: 20px; color: white; text-decoration: none; transition: background 0.3s; }
.ig-link:hover { background: rgba(255,255,255,0.3); }
.product-section { padding: 40px 30px; }
.product-card { background: linear-gradient(135deg, #fff5f5 0%, #ffebee 100%); border-radius: 15px; padding: 30px; border: 3px solid #f44336; }
.product-header { display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; margin-bottom: 20px; }
.product-name { font-size: 1.8em; color: #b71c1c; font-weight: bold; }
.product-price { font-size: 1.6em; color: #d32f2f; font-weight: bold; }
.special-badge { display: inline-block; background: #ff6b6b; color: white; padding: 5px 15px; border-radius: 20px; font-size: 0.9em; margin-left: 10px; }
.highlight { background: #fff3bf; padding: 15px; border-radius: 10px; margin: 15px 0; border-left: 4px solid #f44336; }
.highlight strong { color: #b71c1c; }
.product-intro { background: linear-gradient(135deg, #fff8f0 0%, #ffe8e8 100%); border-radius: 15px; padding: 25px; margin: 20px 0; border: 2px solid #ff6b6b; line-height: 1.8; }
.product-intro h3 { color: #b71c1c; margin-bottom: 15px; font-size: 1.3em; }
.product-intro p { color: #333; margin-bottom: 12px; font-size: 1.05em; }
.product-intro strong { color: #d32f2f; }
.features-box { background: white; border-radius: 10px; padding: 15px; margin: 15px 0; }
.feature-item { color: #d32f2f; margin-bottom: 8px; font-weight: bold; }
.feature-item:last-child { margin-bottom: 0; }
.slogan { color: #b71c1c; font-weight: bold; font-size: 1.15em; margin: 15px 0; }
.specs-box { background: #fff3bf; border-radius: 8px; padding: 12px; margin-top: 15px; border-left: 4px solid #ff6b6b; }
.specs-box div { color: #333; margin-bottom: 5px; }
.specs-box div:last-child { margin-bottom: 0; }
.form-group { margin: 20px 0; }
.form-group label { display: block; margin-bottom: 8px; color: #333; font-weight: bold; }
.form-group input, .form-group select, .form-group textarea { width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 1em; transition: border-color 0.3s; }
.form-group input:focus, .form-group select:focus, .form-group textarea:focus { outline: none; border-color: #f44336; }
.quantity-control { display: flex; align-items: center; gap: 15px; }
.quantity-control button { width: 40px; height: 40px; border: none; background: #f44336; color: white; font-size: 1.5em; border-radius: 8px; cursor: pointer; transition: background 0.3s; user-select: none; }
.quantity-control button:hover { background: #d32f2f; }
.quantity-control button:active { transform: scale(0.95); }
.quantity-control input { width: 80px; text-align: center; font-size: 1.2em; font-weight: bold; }
.total-section { background: #f8f9fa; padding: 20px; border-radius: 10px; margin: 20px 0; }
.total-row { display: flex; justify-content: space-between; margin: 10px 0; font-size: 1.1em; }
.total-row.final { font-size: 1.5em; font-weight: bold; color: #b71c1c; border-top: 2px solid #ddd; padding-top: 10px; margin-top: 15px; }
.notice { background: #fff3bf; padding: 15px; border-radius: 10px; margin: 20px 0; text-align: center; font-weight: bold; color: #b71c1c; border: 2px dashed #ffa94d; }
.submit-btn { width: 100%; padding: 18px; background: linear-gradient(135deg, #b71c1c 0%, #d32f2f 100%); color: white; border: none; border-radius: 12px; font-size: 1.3em; font-weight: bold; cursor: pointer; transition: transform 0.2s, box-shadow 0.2s; margin-bottom: 10px; }
.submit-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(183, 28, 28, 0.4); }
.submit-btn:disabled { background: #ccc; cursor: not-allowed; transform: none; }
.success-message { background: #d3f9d8; padding: 20px; border-radius: 10px; margin: 20px 0; text-align: center; color: #2b8a3e; font-weight: bold; border: 2px solid #51cf66; }
.error-message { background: #ffe3e3; padding: 20px; border-radius: 10px; margin: 20px 0; text-align: center; color: #b71c1c; font-weight: bold; border: 2px solid #f44336; }
.store-section { background: #f8f9fa; padding: 15px; border-radius: 10px; margin-top: 10px; border: 2px solid #e9ecef; }
.store-region { margin-bottom: 15px; }
.store-region:last-child { margin-bottom: 0; }
.store-region label { font-size: 0.95em; color: #495057; margin-bottom: 5px; display: block; }
.store-region select { width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 1em; }
#addressGroup { display: none; }
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <h1>🌶️ 渝味食記 🌶️</h1>
    <p>四川濃香型辣椒醬</p>
    <a href="https://www.instagram.com/yuweishiji" target="_blank" class="ig-link">📷 追蹤我們的 Instagram</a>
  </div>

  <div class="product-section">
    <div class="product-card">
      <div class="product-header">
        <div>
          <span class="product-name">四川濃香型辣椒醬</span>
          <span class="special-badge">🔥 麻辣鮮香</span>
        </div>
        <div class="product-price">NT$ 250 / 罐</div>
      </div>

      <div class="highlight">
        <strong>手工製作、無添加防腐劑,開封後需冷藏保存 ⚠️</strong>
      </div>

      <div class="product-intro">
        <h3>🌶️ 渝味食記-濃香型四川辣椒醬</h3>
        <p><strong>四川的靈魂,不只在麵裡,也在這一瓢辣油裡!</strong></p>
        <p style="color: #555;">
          我們的手工辣椒,是每天親炒現做,從挑椒、炸香料到熬油,每一步都用心。<br>
          辣得過癮卻不嗆喉,麻得香氣層層堆疊——拌麵、炒菜、沾水餃都超搭!
        </p>
        <div class="features-box">
          <div class="feature-item">💥 無添加防腐劑</div>
          <div class="feature-item">💥 純手工熬煮</div>
          <div class="feature-item">💥 香、麻、辣三味俱全</div>
          <div class="feature-item">💥 添加30多種香料</div>
        </div>
        <p class="slogan">一匙下去,整碗都活了🔥</p>
        <div class="specs-box">
          <div><strong>容量:</strong> 150g/瓶</div>
          <div><strong>保存期限:</strong> 冷藏保存半年 / 常溫保存3個月</div>
        </div>
      </div>

      <form id="orderForm">
        <div class="form-group">
          <label>購買數量</label>
          <div class="quantity-control">
            <button type="button" id="btnMinus">−</button>
            <input type="number" id="qty" value="1" min="1" readonly>
            <button type="button" id="btnPlus">+</button>
          </div>
        </div>

        <div class="notice" id="freeShipNotice">🎉 購買10罐(含)以上免運費!</div>

        <div class="form-group"><label>姓名 *</label><input type="text" id="name" required></div>
        <div class="form-group"><label>電話 *</label><input type="tel" id="phone" required placeholder="例:0912345678"></div>
        <div class="form-group"><label>Email *</label><input type="email" id="email" required></div>
        
        <div class="form-group">
          <label>取貨方式 *</label>
          <select id="pickup" required>
            <option value="">請選擇取貨方式</option>
            <option value="7-11">7-11 超商取貨</option>
            <option value="全家">全家超商取貨</option>
            <option value="宅配">宅配</option>
            <option value="面交">面交</option>
          </select>
        </div>

        <div class="form-group" id="storeSelectGroup" style="display:none;">
          <label>選擇門市 *</label>
          <div class="store-section" id="storeSection"></div>
        </div>

        <div class="form-group" id="addressGroup">
          <label id="addressLabel">收貨地址 *</label>
          <textarea id="address" rows="3" placeholder="請填寫完整地址"></textarea>
        </div>

        <div class="form-group">
          <label>匯款帳號後5碼 *</label>
          <input type="text" id="accountLast5" maxlength="5" pattern="[0-9]{5}" required placeholder="請填寫5位數字">
        </div>
        <div class="form-group">
          <label>備註</label>
          <textarea id="note" rows="2" placeholder="其他需求或備註"></textarea>
        </div>

        <div class="total-section">
          <div class="total-row"><span>小計:</span><span id="subtotalDisplay">NT$ 250</span></div>
          <div class="total-row"><span>運費:</span><span id="shippingDisplay">NT$ 130</span></div>
          <div class="total-row final"><span>總計:</span><span id="totalDisplay">NT$ 380</span></div>
        </div>

        <button type="submit" class="submit-btn" id="submitBtn">確認訂購</button>
        <div id="message"></div>
      </form>
    </div>
  </div>
</div>

<script>
(function() {
  'use strict';
  
  const CONFIG = {
    WEB3FORMS_KEY: '63c8b2d8-bddb-46cb-b683-e3c0becf31bf',
    MERCHANT_EMAIL: 'bonnywu992@gmail.com',
    PRICE: 250,
    SHIPPING_DELIVERY: 160,
    SHIPPING_STORE: 130,
    FREE_SHIPPING_QTY: 10
  };

  const STORES = {
    '7-11': {
      '台北市': {
        '中正區':['台北車站門市','西門町門市','南陽門市','重慶門市','公園門市','中正紀念堂門市','永綽門市','古亭門市'],
        '大同區':['大同門市','民權門市','寧夏門市','延平門市','承德門市','大橋門市','迪化門市'],
        '中山區':['中山門市','南京門市','林森門市','雙連門市','長春門市','松江門市','中山北門市','農安門市'],
        '松山區':['松山門市','南京三民門市','八德門市','民生門市','饒河門市','民生社區門市','健康門市'],
        '大安區':['大安門市','忠孝復興門市','東區門市','敦南門市','信義門市','師大門市','仁愛門市','大安森林公園門市','科技大樓門市'],
        '萬華區':['萬華門市','西門門市','龍山寺門市','華西街門市','環河門市','萬華車站門市'],
        '信義區':['信義門市','101門市','市政府門市','永春門市','象山門市','世貿門市','信義威秀門市','松山門市'],
        '士林區':['士林門市','天母門市','劍潭門市','社子門市','芝山門市','士林夜市門市','文林門市','天母棒球場門市'],
        '北投區':['北投門市','石牌門市','關渡門市','新北投門市','奇岩門市','北投溫泉門市','榮總門市'],
        '內湖區':['內湖門市','西湖門市','港墘門市','東湖門市','大湖門市','碧湖門市','內湖科技園區門市','堤頂門市'],
        '南港區':['南港門市','南港車站門市','南港軟體園區門市','南港展覽館門市','玉成門市','南港經貿門市'],
        '文山區':['文山門市','景美門市','木柵門市','政大門市','萬芳門市','景美夜市門市','景興門市','興隆門市']
      },
      '新北市': {
        '板橋區':['板橋門市','板橋車站門市','新埔門市','江子翠門市','府中門市','亞東門市','板橋大遠百門市','板橋新站門市','埔墘門市'],
        '三重區':['三重門市','三和夜市門市','菜寮門市','台北橋門市','徐匯門市','三重商工門市','三重正義門市','三重國小門市'],
        '中和區':['中和門市','景安門市','永安市場門市','中和環球門市','南勢角門市','中和圓通門市','連城門市','中和華新門市'],
        '永和區':['永和門市','頂溪門市','永安門市','永和竹林門市','樂華夜市門市','永和保平門市','永和秀朗門市'],
        '新莊區':['新莊門市','新莊副都心門市','頭前門市','輔大門市','新莊思源門市','丹鳳門市','新莊中正門市','化成門市'],
        '新店區':['新店門市','大坪林門市','七張門市','新店中央門市','碧潭門市','新店寶橋門市','新店北新門市'],
        '樹林區':['樹林門市','樹林火車站門市','山佳門市','樹林保安門市','樹林中正門市'],
        '鶯歌區':['鶯歌門市','鶯歌火車站門市','鶯歌尖山門市'],
        '三峽區':['三峽門市','三峽北大門市','三峽老街門市','三峽復興門市'],
        '淡水區':['淡水門市','淡水捷運門市','淡水老街門市','紅樹林門市','淡水新市門市'],
        '汐止區':['汐止門市','汐科門市','汐止新台五門市','汐止福德門市'],
        '瑞芳區':['瑞芳門市','九份門市','瑞芳車站門市'],
        '土城區':['土城門市','土城捷運門市','海山門市','土城中央門市','土城金城門市'],
        '蘆洲區':['蘆洲門市','三民高中門市','蘆洲中正門市','蘆洲永平門市'],
        '五股區':['五股門市','五股成泰門市','新五泰門市'],
        '泰山區':['泰山門市','泰山貴和門市','泰山明志門市'],
        '林口區':['林口門市','林口三井門市','林口文化門市','林口長庚門市','林口忠孝門市']
      },
      '高雄市': {
        '新興區':['新興門市','中央公園門市','新興六合門市','七賢門市','中山門市','新興中正門市','林森門市'],
        '前金區':['前金門市','前金市中一門市','前金中正門市','前金成功門市','河東門市'],
        '苓雅區':['苓雅門市','三多門市','光華門市','五福門市','苓雅中正門市','武廟門市','四維門市','廣州門市','文化中心門市','中華門市'],
        '鹽埕區':['鹽埕門市','鹽埕駁二門市','鹽埕大勇門市','愛河門市'],
        '鼓山區':['鼓山門市','美術館門市','內惟門市','鼓山哨船頭門市','鼓山裕誠門市','農十六門市','明誠門市','美術東門市'],
        '旗津區':['旗津門市','旗津老街門市','旗津海岸門市'],
        '前鎮區':['前鎮門市','夢時代門市','獅甲門市','前鎮加工區門市','前鎮一心門市','中安門市','凱旋門市','瑞隆門市'],
        '三民區':['三民門市','建國門市','覺民門市','鼎山門市','陽明門市','大昌門市','九如門市','正忠門市','灣子門市','明仁門市'],
        '左營區':['左營門市','高鐵左營門市','巨蛋門市','新莊門市','左營新光門市','博愛門市','自由門市','榮總門市','果貿門市'],
        '楠梓區':['楠梓門市','楠梓後勁門市','藍田門市','楠梓加工區門市','楠梓德民門市','楠梓大學門市','右昌門市'],
        '小港區':['小港門市','小港機場門市','小港鳳林門市','小港漢民門市','小港山明門市','小港沿海門市'],
        '鳳山區':['鳳山門市','鳳山五甲門市','大東門市','文山門市','鳳山青年門市','鳳山建國門市','鳳山中山門市','鳳山光遠門市','國泰門市','過埤門市'],
        '林園區':['林園門市','林園中芸門市','林園王公門市'],
        '大寮區':['大寮門市','大寮鳳屏門市','大寮中庄門市'],
        '大樹區':['大樹門市','大樹佛光山門市','大樹九曲門市'],
        '大社區':['大社門市','大社三民門市'],
        '仁武區':['仁武門市','仁武澄觀門市','仁武中正門市'],
        '鳥松區':['鳥松門市','澄清湖門市','鳥松本館門市'],
        '岡山區':['岡山門市','岡山火車站門市','岡山中山門市','岡山柳橋門市'],
        '橋頭區':['橋頭門市','橋頭糖廠門市','橋頭新市門市'],
        '燕巢區':['燕巢門市','燕巢中民門市'],
        '田寮區':['田寮門市'],
        '阿蓮區':['阿蓮門市','阿蓮中正門市'],
        '路竹區':['路竹門市','路竹中正門市','路竹國昌門市'],
        '湖內區':['湖內門市','湖內中正門市'],
        '茄萣區':['茄萣門市','茄萣濱海門市'],
        '永安區':['永安門市'],
        '彌陀區':['彌陀門市'],
        '梓官區':['梓官門市','梓官中正門市'],
        '旗山區':['旗山門市','旗山老街門市','旗山中正門市'],
        '美濃區':['美濃門市','美濃中正門市','美濃永安門市'],
        '六龜區':['六龜門市'],
        '甲仙區':['甲仙門市'],
        '杉林區':['杉林門市'],
        '內門區':['內門門市'],
        '茂林區':['茂林門市'],
        '桃源區':['桃源門市'],
        '那瑪夏區':['那瑪夏門市']
      },
      '屏東縣': {
        '屏東市':['屏東門市','屏東火車站門市','屏東民族門市','屏東中正門市','屏東自由門市','屏東廣東門市','屏東和平門市','屏東勝利門市'],
        '潮州鎮':['潮州門市','潮州中山門市','潮州光復門市','潮州建基門市'],
        '東港鎮':['東港門市','東港中山門市','東港光復門市','東港新生門市','東港漁港門市'],
        '恆春鎮':['恆春門市','恆春老街門市','墾丁門市','恆春南門門市','墾丁大街門市','南灣門市'],
        '萬丹鄉':['萬丹門市','萬丹和平門市'],
        '長治鄉':['長治門市','長治繁華門市'],
        '麟洛鄉':['麟洛門市'],
        '九如鄉':['九如門市','九如中正門市'],
        '里港鄉':['里港門市','里港中山門市'],
        '鹽埔鄉':['鹽埔門市'],
        '高樹鄉':['高樹門市','高樹興中門市'],
        '萬巒鄉':['萬巒門市','萬巒中山門市'],
        '內埔鄉':['內埔門市','內埔中正門市','內埔廣濟門市'],
        '竹田鄉':['竹田門市','竹田西勢門市'],
        '新埤鄉':['新埤門市'],
        '枋寮鄉':['枋寮門市','枋寮中山門市','枋寮新開門市'],
        '新園鄉':['新園門市','新園仙吉門市'],
        '崁頂鄉':['崁頂門市'],
        '林邊鄉':['林邊門市','林邊中山門市'],
        '南州鄉':['南州門市'],
        '佳冬鄉':['佳冬門市','佳冬六根門市'],
        '琉球鄉':['小琉球門市','琉球本福門市'],
        '車城鄉':['車城門市','四重溪門市','車城福安門市'],
        '滿州鄉':['滿州門市'],
        '枋山鄉':['枋山門市','枋山加祿門市'],
        '三地門鄉':['三地門門市'],
        '霧台鄉':['霧台門市'],
        '瑪家鄉':['瑪家門市'],
        '泰武鄉':['泰武門市'],
        '來義鄉':['來義門市'],
        '春日鄉':['春日門市'],
        '獅子鄉':['獅子門市'],
        '牡丹鄉':['牡丹門市']
      }
    },
    '全家': {
      '台北市': {
        '中正區':['台北車站店','西門町店','南陽店','重慶店','公園店','中正紀念堂店','古亭店'],
        '大同區':['大同店','民權店','寧夏店','延平店','承德店','迪化店'],
        '中山區':['中山店','南京店','林森店','雙連店','長春店','松江店','農安店'],
        '松山區':['松山店','南京三民店','八德店','民生店','饒河店','健康店'],
        '大安區':['大安店','忠孝復興店','東區店','敦南店','信義店','師大店','仁愛店','大安森林公園店','科技大樓店'],
        '萬華區':['萬華店','西門店','龍山寺店','華西街店','環河店'],
        '信義區':['信義店','101店','市政府店','永春店','象山店','世貿店','信義威秀店'],
        '士林區':['士林店','天母店','劍潭店','社子店','芝山店','士林夜市店','文林店'],
        '北投區':['北投店','石牌店','關渡店','新北投店','奇岩店','榮總店'],
        '內湖區':['內湖店','西湖店','港墘店','東湖店','大湖店','碧湖店','內湖科技園區店'],
        '南港區':['南港店','南港車站店','南港軟體園區店','南港展覽館店','玉成店'],
        '文山區':['文山店','景美店','木柵店','政大店','萬芳店','景美夜市店','景興店']
      },
      '新北市': {
        '板橋區':['板橋店','板橋車站店','新埔店','江子翠店','府中店','亞東店','板橋大遠百店','埔墘店'],
        '三重區':['三重店','三和夜市店','菜寮店','台北橋店','徐匯店','三重正義店'],
        '中和區':['中和店','景安店','永安市場店','中和環球店','南勢角店','連城店'],
        '永和區':['永和店','頂溪店','永安店','永和竹林店','樂華夜市店','保平店'],
        '新莊區':['新莊店','新莊副都心店','頭前店','輔大店','丹鳳店','新莊中正店'],
        '新店區':['新店店','大坪林店','七張店','碧潭店','新店北新店'],
        '樹林區':['樹林店','樹林火車站店','山佳店'],
        '鶯歌區':['鶯歌店','鶯歌火車站店'],
        '三峽區':['三峽店','三峽北大店','三峽老街店'],
        '淡水區':['淡水店','淡水捷運店','淡水老街店','紅樹林店'],
        '汐止區':['汐止店','汐科店','汐止新台五店'],
        '瑞芳區':['瑞芳店','九份店'],
        '土城區':['土城店','土城捷運店','海山店'],
        '蘆洲區':['蘆洲店','三民高中店','蘆洲中正店'],
        '五股區':['五股店','五股成泰店'],
        '泰山區':['泰山店','泰山貴和店'],
        '林口區':['林口店','林口三井店','林口文化店']
      },
      '高雄市': {
        '新興區':['新興店','中央公園店','新興六合店','七賢店','中山店','林森店'],
        '前金區':['前金店','前金市中一店','前金中正店','成功店'],
        '苓雅區':['苓雅店','三多店','光華店','五福店','武廟店','四維店','文化中心店','中華店'],
        '鹽埕區':['鹽埕店','鹽埕駁二店','大勇店'],
        '鼓山區':['鼓山店','美術館店','內惟店','裕誠店','明誠店','美術東店'],
        '旗津區':['旗津店','旗津老街店'],
        '前鎮區':['前鎮店','夢時代店','獅甲店','前鎮一心店','凱旋店'],
        '三民區':['三民店','建國店','覺民店','鼎山店','陽明店','大昌店','九如店'],
        '左營區':['左營店','高鐵左營店','巨蛋店','新莊店','博愛店','自由店','榮總店'],
        '楠梓區':['楠梓店','楠梓後勁店','藍田店','楠梓大學店','右昌店'],
        '小港區':['小港店','小港機場店','小港鳳林店','小港漢民店'],
        '鳳山區':['鳳山店','鳳山五甲店','大東店','文山店','鳳山青年店','鳳山建國店','鳳山中山店'],
        '林園區':['林園店','林園中芸店'],
        '大寮區':['大寮店','大寮鳳屏店'],
        '大樹區':['大樹店','大樹佛光山店'],
        '大社區':['大社店'],
        '仁武區':['仁武店','仁武澄觀店'],
        '鳥松區':['鳥松店','澄清湖店'],
        '岡山區':['岡山店','岡山火車站店','岡山中山店'],
        '橋頭區':['橋頭店','橋頭糖廠店'],
        '燕巢區':['燕巢店'],
        '田寮區':['田寮店'],
        '阿蓮區':['阿蓮店'],
        '路竹區':['路竹店','路竹中正店'],
        '湖內區':['湖內店'],
        '茄萣區':['茄萣店'],
        '永安區':['永安店'],
        '彌陀區':['彌陀店'],
        '梓官區':['梓官店'],
        '旗山區':['旗山店','旗山老街店'],
        '美濃區':['美濃店','美濃中正店']
      },
      '屏東縣': {
        '屏東市':['屏東店','屏東火車站店','屏東民族店','屏東中正店','屏東自由店','屏東廣東店','屏東和平店'],
        '潮州鎮':['潮州店','潮州中山店','潮州光復店'],
        '東港鎮':['東港店','東港中山店','東港光復店','東港漁港店'],
        '恆春鎮':['恆春店','恆春老街店','墾丁店','墾丁大街店','南灣店'],
        '萬丹鄉':['萬丹店'],
        '長治鄉':['長治店'],
        '麟洛鄉':['麟洛店'],
        '九如鄉':['九如店'],
        '里港鄉':['里港店'],
        '鹽埔鄉':['鹽埔店'],
        '高樹鄉':['高樹店'],
        '萬巒鄉':['萬巒店'],
        '內埔鄉':['內埔店','內埔中正店'],
        '竹田鄉':['竹田店'],
        '新埤鄉':['新埤店'],
        '枋寮鄉':['枋寮店','枋寮中山店'],
        '新園鄉':['新園店'],
        '崁頂鄉':['崁頂店'],
        '林邊鄉':['林邊店'],
        '南州鄉':['南州店'],
        '佳冬鄉':['佳冬店'],
        '琉球鄉':['小琉球店'],
        '車城鄉':['車城店','四重溪店'],
        '滿州鄉':['滿州店'],
        '枋山鄉':['枋山店'],
        '三地門鄉':['三地門店'],
        '霧台鄉':['霧台店'],
        '瑪家鄉':['瑪家店'],
        '泰武鄉':['泰武店'],
        '來義鄉':['來義店'],
        '春日鄉':['春日店'],
        '獅子鄉':['獅子店'],
        '牡丹鄉':['牡丹店']
      }
    }
  };

  const elements = {
    qty: document.getElementById('qty'),
    btnPlus: document.getElementById('btnPlus'),
    btnMinus: document.getElementById('btnMinus'),
    subtotal: document.getElementById('subtotalDisplay'),
    shipping: document.getElementById('shippingDisplay'),
    total: document.getElementById('totalDisplay'),
    notice: document.getElementById('freeShipNotice'),
    pickup: document.getElementById('pickup'),
    storeGroup: document.getElementById('storeSelectGroup'),
    addressGroup: document.getElementById('addressGroup'),
    storeSection: document.getElementById('storeSection'),
    form: document.getElementById('orderForm'),
    submitBtn: document.getElementById('submitBtn'),
    message: document.getElementById('message')
  };

  let selectedStore = '';
  let citySelect, districtSelect, storeSelect;

  function generateOrderId() {
    const now = new Date();
    const year = now.getFullYear();
    const month = String(now.getMonth() + 1).padStart(2, '0');
    const day = String(now.getDate()).padStart(2, '0');
    const random = Math.floor(Math.random() * 10000).toString().padStart(4, '0');
    return `YW${year}${month}${day}${random}`;
  }

  function updatePrice() {
    const qty = parseInt(elements.qty.value) || 1;
    const subtotal = CONFIG.PRICE * qty;
    const method = elements.pickup.value;
    let shipping = 0;

    if (method === '宅配') {
      shipping = qty >= CONFIG.FREE_SHIPPING_QTY ? 0 : CONFIG.SHIPPING_DELIVERY;
    } else if (method === '7-11' || method === '全家') {
      shipping = qty >= CONFIG.FREE_SHIPPING_QTY ? 0 : CONFIG.SHIPPING_STORE;
    }

    const total = subtotal + shipping;
    elements.subtotal.textContent = `NT$ ${subtotal}`;
    elements.shipping.textContent = shipping === 0 ? (method === '面交' ? '免運費 (面交) ✓' : '免運費 ✓') : `NT$ ${shipping}`;
    elements.total.textContent = `NT$ ${total}`;

    if (method === '面交') {
      elements.notice.textContent = '🎉 面交免運費!';
      elements.notice.style.background = '#d3f9d8';
    } else if (qty < CONFIG.FREE_SHIPPING_QTY) {
      elements.notice.textContent = `再買 ${CONFIG.FREE_SHIPPING_QTY - qty} 罐即可免運 🎁`;
      elements.notice.style.background = '#fff3bf';
    } else {
      const saved = method === '宅配' ? CONFIG.SHIPPING_DELIVERY : CONFIG.SHIPPING_STORE;
      elements.notice.textContent = `🎉 已達免運門檻!恭喜省下 NT$ ${saved} 運費!`;
      elements.notice.style.background = '#d3f9d8';
    }
  }

  function renderStoreOptions(method) {
    elements.storeSection.innerHTML = '';
    selectedStore = '';
    
    if (!STORES[method]) return;
    
    const stores = STORES[method];
    const createSelect = (label, disabled = false) => {
      const div = document.createElement('div');
      div.className = 'store-region';
      const lbl = document.createElement('label');
      lbl.textContent = label;
      div.appendChild(lbl);
      const select = document.createElement('select');
      select.disabled = disabled;
      div.appendChild(select);
      return { div, select };
    };

    const city = createSelect('選擇城市');
    citySelect = city.select;
    citySelect.innerHTML = '<option value="">請選擇城市</option>';
    Object.keys(stores).forEach(c => {
      const opt = document.createElement('option');
      opt.value = c;
      opt.textContent = c;
      citySelect.appendChild(opt);
    });
    elements.storeSection.appendChild(city.div);

    const district = createSelect('選擇區域', true);
    districtSelect = district.select;
    districtSelect.innerHTML = '<option value="">請先選擇城市</option>';
    elements.storeSection.appendChild(district.div);

    const store = createSelect('選擇門市', true);
    storeSelect = store.select;
    storeSelect.innerHTML = '<option value="">請先選擇區域</option>';
    elements.storeSection.appendChild(store.div);

    citySelect.addEventListener('change', function() {
      const selectedCity = this.value;
      districtSelect.innerHTML = '<option value="">請選擇區域</option>';
      storeSelect.innerHTML = '<option value="">請先選擇區域</option>';
      storeSelect.disabled = true;
      selectedStore = '';
      
      if (selectedCity && stores[selectedCity]) {
        districtSelect.disabled = false;
        Object.keys(stores[selectedCity]).forEach(d => {
          const opt = document.createElement('option');
          opt.value = d;
          opt.textContent = d;
          districtSelect.appendChild(opt);
        });
      } else {
        districtSelect.disabled = true;
      }
    });

    districtSelect.addEventListener('change', function() {
      const selectedCity = citySelect.value;
      const selectedDistrict = this.value;
      storeSelect.innerHTML = '<option value="">請選擇門市</option>';
      selectedStore = '';
      
      if (selectedCity && selectedDistrict && stores[selectedCity][selectedDistrict]) {
        storeSelect.disabled = false;
        stores[selectedCity][selectedDistrict].forEach(s => {
          const opt = document.createElement('option');
          opt.value = `${selectedCity}-${selectedDistrict}-${s}`;
          opt.textContent = s;
          storeSelect.appendChild(opt);
        });
      } else {
        storeSelect.disabled = true;
      }
    });

    storeSelect.addEventListener('change', function() {
      selectedStore = this.value;
    });
  }

  elements.pickup.addEventListener('change', function() {
    const method = this.value;
    const addressInput = document.getElementById('address');
    const addressLabel = document.getElementById('addressLabel');
    
    if (method === '7-11' || method === '全家') {
      elements.storeGroup.style.display = 'block';
      elements.addressGroup.style.display = 'none';
      addressInput.value = '';
      renderStoreOptions(method);
    } else if (method === '宅配') {
      elements.storeGroup.style.display = 'none';
      elements.addressGroup.style.display = 'block';
      addressLabel.textContent = '收貨地址 *';
      addressInput.placeholder = '請填寫完整地址';
      addressInput.value = '';
      addressInput.readOnly = false;
      addressInput.style.backgroundColor = '';
    } else if (method === '面交') {
      elements.storeGroup.style.display = 'none';
      elements.addressGroup.style.display = 'block';
      addressLabel.textContent = '面交地點';
      addressInput.value = '802高雄市苓雅區武廟路206號';
      addressInput.readOnly = true;
      addressInput.style.backgroundColor = '#f0f0f0';
    } else {
      elements.storeGroup.style.display = 'none';
      elements.addressGroup.style.display = 'none';
    }
    
    updatePrice();
  });

  elements.btnPlus.addEventListener('click', (e) => {
    e.preventDefault();
    elements.qty.value = parseInt(elements.qty.value) + 1;
    updatePrice();
  });

  elements.btnMinus.addEventListener('click', (e) => {
    e.preventDefault();
    const val = parseInt(elements.qty.value);
    if (val > 1) {
      elements.qty.value = val - 1;
      updatePrice();
    }
  });

  elements.form.addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const phone = document.getElementById('phone').value.trim();
    const account = document.getElementById('accountLast5').value.trim();
    const method = elements.pickup.value;
    const addressInput = document.getElementById('address').value.trim();
    
    if (!/^09\d{8}$/.test(phone)) {
      elements.message.innerHTML = '<div class="error-message">❌ 請輸入正確手機號碼(例:0912345678)</div>';
      return;
    }
    if (!/^\d{5}$/.test(account)) {
      elements.message.innerHTML = '<div class="error-message">❌ 帳號後5碼必須是5位數字</div>';
      return;
    }
    
    let finalAddress = '';
    if (method === '7-11' || method === '全家') {
      if (!selectedStore) {
        elements.message.innerHTML = '<div class="error-message">❌ 請選擇門市</div>';
        return;
      }
      finalAddress = selectedStore;
    } else if (method === '宅配' || method === '面交') {
      if (addressInput.length < 5) {
        elements.message.innerHTML = '<div class="error-message">❌ 請填寫完整地址</div>';
        return;
      }
      finalAddress = addressInput;
    } else {
      elements.message.innerHTML = '<div class="error-message">❌ 請選擇取貨方式</div>';
      return;
    }

    elements.submitBtn.disabled = true;
    elements.submitBtn.textContent = '處理中...';
    elements.message.innerHTML = '';

    try {
      const qty = parseInt(elements.qty.value);
      const subtotal = CONFIG.PRICE * qty;
      let shipping = 0;
      if (method === '宅配') shipping = qty >= CONFIG.FREE_SHIPPING_QTY ? 0 : CONFIG.SHIPPING_DELIVERY;
      else if (method === '7-11' || method === '全家') shipping = qty >= CONFIG.FREE_SHIPPING_QTY ? 0 : CONFIG.SHIPPING_STORE;
      
      const total = subtotal + shipping;
      const orderId = generateOrderId();
      const name = document.getElementById('name').value;
      const email = document.getElementById('email').value;
      const note = document.getElementById('note').value || '無';

      await fetch('https://api.web3forms.com/submit', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          access_key: CONFIG.WEB3FORMS_KEY,
          subject: `🛒 新訂單 ${orderId} - 渝味食記`,
          from_name: '渝味食記訂購系統',
          email: CONFIG.MERCHANT_EMAIL,
          message: `訂單編號:${orderId}\n姓名:${name}\n電話:${phone}\nEmail:${email}\n取貨方式:${method}\n地址/門市:${finalAddress}\n帳號後5碼:${account}\n數量:${qty}罐\n小計:NT$ ${subtotal}\n運費:NT$ ${shipping}\n總計:NT$ ${total}\n備註:${note}`
        })
      });

      await fetch('https://api.web3forms.com/submit', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          access_key: CONFIG.WEB3FORMS_KEY,
          from_name: '渝味食記訂購系統',
          email: email,
          message: `親愛的 ${name} 您好,訂單編號:${orderId}\n商品:四川辣椒醬 x ${qty}罐\n總計:NT$ ${total}\n取貨方式:${method}\n地址/門市:${finalAddress}`
        })
      });

      elements.message.innerHTML = `<div class="success-message">✅ 訂單已成功送出!<br><strong>訂單編號:${orderId}</strong></div>`;
      elements.form.reset();
      elements.qty.value = 1;
      selectedStore = '';
      elements.storeGroup.style.display = 'none';
      elements.addressGroup.style.display = 'none';
      updatePrice();

    } catch (err) {
      console.error(err);
      elements.message.innerHTML = '<div class="error-message">❌ 訂單送出失敗,請稍後再試</div>';
    } finally {
      elements.submitBtn.disabled = false;
      elements.submitBtn.textContent = '確認訂購';
    }
  });

  updatePrice();
})();
</script>
</body>
</html>
