
<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>渝味食記 - 四川濃香型辣椒醬</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: 'Microsoft JhengHei', Arial, sans-serif; background: linear-gradient(135deg, #d32f2f 0%, #f44336 100%); min-height: 100vh; padding: 20px; }
.container { max-width: 800px; margin: 0 auto; background: white; border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); overflow: hidden; }
.header { background: linear-gradient(135deg, #b71c1c 0%, #d32f2f 100%); color: white; padding: 40px 30px; text-align: center; }
.header h1 { font-size: 2.5em; margin-bottom: 10px; text-shadow: 2px 2px 4px rgba(0,0,0,0.2); }
.header p { font-size: 1.1em; opacity: 0.95; }
.ig-link { display: inline-block; margin-top: 10px; padding: 8px 20px; background: rgba(255,255,255,0.2); border-radius: 20px; color: white; text-decoration: none; transition: background 0.3s; }
.ig-link:hover { background: rgba(255,255,255,0.3); }
.product-section { padding: 40px 30px; }
.product-card { background: linear-gradient(135deg, #fff5f5 0%, #ffebee 100%); border-radius: 15px; padding: 30px; border: 3px solid #f44336; }
.product-header { display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; margin-bottom: 20px; }
.product-name { font-size: 1.8em; color: #b71c1c; font-weight: bold; }
.product-price { font-size: 1.6em; color: #d32f2f; font-weight: bold; }
.special-badge { display: inline-block; background: #ff6b6b; color: white; padding: 5px 15px; border-radius: 20px; font-size: 0.9em; margin-left: 10px; }
.highlight { background: #fff3bf; padding: 15px; border-radius: 10px; margin: 15px 0; border-left: 4px solid #f44336; }
.highlight strong { color: #b71c1c; }
.product-intro { background: linear-gradient(135deg, #fff8f0 0%, #ffe8e8 100%); border-radius: 15px; padding: 25px; margin: 20px 0; border: 2px solid #ff6b6b; line-height: 1.8; }
.product-intro h3 { color: #b71c1c; margin-bottom: 15px; font-size: 1.3em; }
.product-intro p { color: #333; margin-bottom: 12px; font-size: 1.05em; }
.product-intro strong { color: #d32f2f; }
.features-box { background: white; border-radius: 10px; padding: 15px; margin: 15px 0; }
.feature-item { color: #d32f2f; margin-bottom: 8px; font-weight: bold; }
.feature-item:last-child { margin-bottom: 0; }
.slogan { color: #b71c1c; font-weight: bold; font-size: 1.15em; margin: 15px 0; }
.specs-box { background: #fff3bf; border-radius: 8px; padding: 12px; margin-top: 15px; border-left: 4px solid #ff6b6b; }
.specs-box div { color: #333; margin-bottom: 5px; }
.specs-box div:last-child { margin-bottom: 0; }
.form-group { margin: 20px 0; }
.form-group label { display: block; margin-bottom: 8px; color: #333; font-weight: bold; }
.form-group input, .form-group select, .form-group textarea { width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 1em; transition: border-color 0.3s; }
.form-group input:focus, .form-group select:focus, .form-group textarea:focus { outline: none; border-color: #f44336; }
.quantity-control { display: flex; align-items: center; gap: 15px; }
.quantity-control button { width: 40px; height: 40px; border: none; background: #f44336; color: white; font-size: 1.5em; border-radius: 8px; cursor: pointer; transition: background 0.3s; user-select: none; }
.quantity-control button:hover { background: #d32f2f; }
.quantity-control button:active { transform: scale(0.95); }
.quantity-control input { width: 80px; text-align: center; font-size: 1.2em; font-weight: bold; pointer-events: none; }
.total-section { background: #f8f9fa; padding: 20px; border-radius: 10px; margin: 20px 0; transition: all 0.3s ease; }
.total-row { display: flex; justify-content: space-between; margin: 10px 0; font-size: 1.1em; }
.total-row.final { font-size: 1.5em; font-weight: bold; color: #b71c1c; border-top: 2px solid #ddd; padding-top: 10px; margin-top: 15px; }
.notice { background: #fff3bf; padding: 15px; border-radius: 10px; margin: 20px 0; text-align: center; font-weight: bold; color: #b71c1c; border: 2px dashed #ffa94d; transition: all 0.3s ease; }
.submit-btn { width: 100%; padding: 18px; background: linear-gradient(135deg, #b71c1c 0%, #d32f2f 100%); color: white; border: none; border-radius: 12px; font-size: 1.3em; font-weight: bold; cursor: pointer; transition: transform 0.2s, box-shadow 0.2s; margin-bottom: 10px; }
.submit-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(183, 28, 28, 0.4); }
.submit-btn:disabled { background: #ccc; cursor: not-allowed; transform: none; }
.success-message { background: #d3f9d8; padding: 20px; border-radius: 10px; margin: 20px 0; text-align: center; color: #2b8a3e; font-weight: bold; border: 2px solid #51cf66; }
.error-message { background: #ffe3e3; padding: 20px; border-radius: 10px; margin: 20px 0; text-align: center; color: #b71c1c; font-weight: bold; border: 2px solid #f44336; }
.store-section { background: #f8f9fa; padding: 15px; border-radius: 10px; margin-top: 10px; border: 2px solid #e9ecef; }
.store-region { margin-bottom: 15px; }
.store-region:last-child { margin-bottom: 0; }
.store-region label { font-size: 0.95em; color: #495057; margin-bottom: 5px; display: block; }
#addressGroup { display: none; }
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <h1>🌶️ 渝味食記 🌶️</h1>
    <p>四川濃香型辣椒醬</p>
    <a href="https://www.instagram.com/yuweishiji" target="_blank" class="ig-link">📷 追蹤我們的 Instagram</a>
  </div>

  <div class="product-section">
    <div class="product-card">
      <div class="product-header">
        <div>
          <span class="product-name">四川濃香型辣椒醬</span>
          <span class="special-badge">🔥 麻辣鮮香</span>
        </div>
        <div class="product-price">NT$ 250 / 罐</div>
      </div>

      <div class="highlight">
        <strong>手工製作、無添加防腐劑,開封後需冷藏保存 ⚠️</strong>
      </div>

      <div class="product-intro">
        <h3>🌶️ 渝味食記-濃香型四川辣椒醬</h3>
        <p><strong>四川的靈魂,不只在麵裡,也在這一瓢辣油裡!</strong></p>
        <p style="color: #555;">
          我們的手工辣椒,是每天親炒現做,從挑椒、炸香料到熬油,每一步都用心。<br>
          辣得過癮卻不嗆喉,麻得香氣層層堆疊——拌麵、炒菜、沾水餃都超搭!
        </p>
        <div class="features-box">
          <div class="feature-item">💥 無添加防腐劑</div>
          <div class="feature-item">💥 純手工熬煮</div>
          <div class="feature-item">💥 香、麻、辣三味俱全</div>
          <div class="feature-item">💥 添加30多種香料</div>
        </div>
        <p class="slogan">一匙下去,整碗都活了🔥</p>
        <div class="specs-box">
          <div><strong>容量:</strong> 150g/瓶</div>
          <div><strong>保存期限:</strong> 冷藏保存半年 / 常溫保存3個月</div>
        </div>
      </div>

      <form id="orderForm">
        <div class="form-group">
          <label>購買數量</label>
          <div class="quantity-control">
            <button type="button" id="btnMinus">−</button>
            <input type="number" id="qty" value="1" min="1" readonly>
            <button type="button" id="btnPlus">+</button>
          </div>
        </div>

        <div class="notice" id="freeShipNotice">🎉 購買10罐(含)以上免運費!</div>

        <div class="form-group"><label>姓名 *</label><input type="text" id="name" required></div>
        <div class="form-group"><label>電話 *</label><input type="tel" id="phone" required placeholder="例:0912345678"></div>
        <div class="form-group"><label>Email *</label><input type="email" id="email" required></div>
        
        <div class="form-group">
          <label>取貨方式 *</label>
          <select id="pickup" required>
            <option value="">請選擇取貨方式</option>
            <option value="7-11">7-11 超商取貨</option>
            <option value="全家">全家超商取貨</option>
            <option value="宅配">宅配</option>
            <option value="面交">面交</option>
          </select>
        </div>

        <div class="form-group" id="storeSelectGroup" style="display:none;">
          <label>選擇門市 *</label>
          <div class="store-section" id="storeSection"></div>
        </div>

        <div class="form-group" id="addressGroup">
          <label id="addressLabel">收貨地址 *</label>
          <textarea id="address" rows="3" placeholder="請填寫完整地址"></textarea>
        </div>

        <div class="form-group">
          <label>匯款帳號後5碼 *</label>
          <input type="text" id="accountLast5" maxlength="5" pattern="[0-9]{5}" required placeholder="請填寫5位數字">
        </div>
        <div class="form-group">
          <label>備註</label>
          <textarea id="note" rows="2" placeholder="其他需求或備註"></textarea>
        </div>

        <div class="total-section">
          <div class="total-row"><span>小計:</span><span id="subtotalDisplay">NT$ 250</span></div>
          <div class="total-row"><span>運費:</span><span id="shippingDisplay">NT$ 130</span></div>
          <div class="total-row final"><span>總計:</span><span id="totalDisplay">NT$ 380</span></div>
        </div>

        <button type="submit" class="submit-btn" id="submitBtn">確認訂購</button>
        <div id="message"></div>
      </form>
    </div>
  </div>
</div>
<script>
const WEB3FORMS_ACCESS_KEY='63c8b2d8-bddb-46cb-b683-e3c0becf31bf';
const MERCHANT_EMAIL='bonnywu992@gmail.com';
var PRICE=250, SHIPPING_DELIVERY=160, SHIPPING_STORE=130, FREE_SHIPPING_QTY=10;

// 台灣便利商店門市完整資料
const storeData = {
  // 北部地區
  taipei: {
    name: "台北市",
    stores: [
      // 7-11門市
      { id: "tp_711_001", name: "統領門市", brand: "7-11", address: "台北市中正區忠孝西路一段38號", phone: "02-2311-5678", lat: 25.0478, lng: 121.5170, hours: "24小時" },
      { id: "tp_711_002", name: "信義門市", brand: "7-11", address: "台北市信義區信義路五段7號", phone: "02-2723-4567", lat: 25.0330, lng: 121.5654, hours: "24小時" },
      { id: "tp_711_003", name: "東門門市", brand: "7-11", address: "台北市大安區信義路二段198號", phone: "02-2321-8901", lat: 25.0338, lng: 121.5288, hours: "24小時" },
      { id: "tp_711_004", name: "西門門市", brand: "7-11", address: "台北市萬華區成都路28號", phone: "02-2311-9876", lat: 25.0424, lng: 121.5067, hours: "24小時" },
      { id: "tp_711_005", name: "南港門市", brand: "7-11", address: "台北市南港區南港路一段128號", phone: "02-2651-3456", lat: 25.0522, lng: 121.6066, hours: "06:00-23:00" },
      { id: "tp_711_006", name: "內湖門市", brand: "7-11", address: "台北市內湖區成功路四段188號", phone: "02-8792-5678", lat: 25.0837, lng: 121.5788, hours: "24小時" },
      { id: "tp_711_007", name: "松山門市", brand: "7-11", address: "台北市松山區南京東路五段123號", phone: "02-2765-4321", lat: 25.0516, lng: 121.5633, hours: "24小時" },
      { id: "tp_711_008", name: "中山門市", brand: "7-11", address: "台北市中山區南京東路二段88號", phone: "02-2541-7890", lat: 25.0520, lng: 121.5325, hours: "24小時" },
      
      // 全家門市
      { id: "tp_fm_001", name: "台北車站店", brand: "全家", address: "台北市中正區北平西路3號", phone: "02-2312-3456", lat: 25.0475, lng: 121.5173, hours: "24小時" },
      { id: "tp_fm_002", name: "信義新天地店", brand: "全家", address: "台北市信義區松壽路18號", phone: "02-2722-5678", lat: 25.0360, lng: 121.5670, hours: "24小時" },
      { id: "tp_fm_003", name: "師大店", brand: "全家", address: "台北市大安區師大路93號", phone: "02-2363-7890", lat: 25.0261, lng: 121.5279, hours: "06:00-23:00" },
      { id: "tp_fm_004", name: "公館店", brand: "全家", address: "台北市中正區羅斯福路四段136號", phone: "02-2369-1234", lat: 25.0155, lng: 121.5345, hours: "24小時" },
      { id: "tp_fm_005", name: "士林店", brand: "全家", address: "台北市士林區中正路288號", phone: "02-2883-4567", lat: 25.0939, lng: 121.5241, hours: "24小時" },
      { id: "tp_fm_006", name: "北投店", brand: "全家", address: "台北市北投區中央南路一段68號", phone: "02-2891-2345", lat: 25.1315, lng: 121.5013, hours: "06:00-23:00" },
      { id: "tp_fm_007", name: "大直店", brand: "全家", address: "台北市中山區北安路458號", phone: "02-8509-6789", lat: 25.0783, lng: 121.5474, hours: "24小時" },
      { id: "tp_fm_008", name: "木柵店", brand: "全家", address: "台北市文山區木柵路一段258號", phone: "02-2939-8765", lat: 24.9888, lng: 121.5712, hours: "06:00-23:00" },
    ]
  },
  
  new_taipei: {
    name: "新北市",
    stores: [
      // 7-11門市
      { id: "nt_711_001", name: "板橋門市", brand: "7-11", address: "新北市板橋區縣民大道二段7號", phone: "02-2964-1234", lat: 25.0126, lng: 121.4627, hours: "24小時" },
      { id: "nt_711_002", name: "新莊門市", brand: "7-11", address: "新北市新莊區中正路188號", phone: "02-2992-5678", lat: 25.0375, lng: 121.4503, hours: "24小時" },
      { id: "nt_711_003", name: "中和門市", brand: "7-11", address: "新北市中和區中和路358號", phone: "02-2248-7890", lat: 24.9994, lng: 121.4978, hours: "24小時" },
      { id: "nt_711_004", name: "永和門市", brand: "7-11", address: "新北市永和區中正路488號", phone: "02-2923-4567", lat: 25.0099, lng: 121.5165, hours: "24小時" },
      { id: "nt_711_005", name: "三重門市", brand: "7-11", address: "新北市三重區重新路三段128號", phone: "02-2976-8901", lat: 25.0625, lng: 121.4881, hours: "06:00-23:00" },
      { id: "nt_711_006", name: "蘆洲門市", brand: "7-11", address: "新北市蘆洲區中正路268號", phone: "02-2281-2345", lat: 25.0847, lng: 121.4642, hours: "24小時" },
      { id: "nt_711_007", name: "新店門市", brand: "7-11", address: "新北市新店區北新路二段188號", phone: "02-8911-6789", lat: 24.9677, lng: 121.5416, hours: "24小時" },
      
      // 全家門市
      { id: "nt_fm_001", name: "板橋府中店", brand: "全家", address: "新北市板橋區府中路38號", phone: "02-2968-7890", lat: 25.0089, lng: 121.4596, hours: "24小時" },
      { id: "nt_fm_002", name: "新莊輔大店", brand: "全家", address: "新北市新莊區中正路510號", phone: "02-2901-2345", lat: 25.0334, lng: 121.4344, hours: "24小時" },
      { id: "nt_fm_003", name: "土城店", brand: "全家", address: "新北市土城區中央路一段168號", phone: "02-2260-5678", lat: 24.9729, lng: 121.4423, hours: "06:00-23:00" },
      { id: "nt_fm_004", name: "淡水店", brand: "全家", address: "新北市淡水區中正路258號", phone: "02-2621-9876", lat: 25.1677, lng: 121.4415, hours: "24小時" },
      { id: "nt_fm_005", name: "汐止店", brand: "全家", address: "新北市汐止區大同路二段388號", phone: "02-8692-3456", lat: 25.0655, lng: 121.6422, hours: "24小時" },
      { id: "nt_fm_006", name: "樹林店", brand: "全家", address: "新北市樹林區中山路一段88號", phone: "02-2681-7890", lat: 24.9909, lng: 121.4205, hours: "06:00-23:00" },
      { id: "nt_fm_007", name: "林口店", brand: "全家", address: "新北市林口區文化二路一段128號", phone: "02-2608-1234", lat: 25.0779, lng: 121.3902, hours: "24小時" },
    ]
  },
  
  taoyuan: {
    name: "桃園市",
    stores: [
      // 7-11門市
      { id: "ty_711_001", name: "桃園門市", brand: "7-11", address: "桃園市桃園區中正路88號", phone: "03-335-6789", lat: 24.9889, lng: 121.3127, hours: "24小時" },
      { id: "ty_711_002", name: "中壢門市", brand: "7-11", address: "桃園市中壢區中央西路二段168號", phone: "03-425-7890", lat: 24.9595, lng: 121.2252, hours: "24小時" },
      { id: "ty_711_003", name: "平鎮門市", brand: "7-11", address: "桃園市平鎮區環南路288號", phone: "03-458-1234", lat: 24.9442, lng: 121.2165, hours: "24小時" },
      { id: "ty_711_004", name: "八德門市", brand: "7-11", address: "桃園市八德區介壽路一段888號", phone: "03-368-5678", lat: 24.9380, lng: 121.2967, hours: "06:00-23:00" },
      { id: "ty_711_005", name: "龜山門市", brand: "7-11", address: "桃園市龜山區文化二路188號", phone: "03-328-9012", lat: 25.0504, lng: 121.3494, hours: "24小時" },
      
      // 全家門市
      { id: "ty_fm_001", name: "桃園站前店", brand: "全家", address: "桃園市桃園區復興路128號", phone: "03-332-4567", lat: 24.9903, lng: 121.3131, hours: "24小時" },
      { id: "ty_fm_002", name: "中壢中正店", brand: "全家", address: "桃園市中壢區中正路268號", phone: "03-422-8901", lat: 24.9653, lng: 121.2266, hours: "24小時" },
      { id: "ty_fm_003", name: "大溪店", brand: "全家", address: "桃園市大溪區慈湖路58號", phone: "03-388-2345", lat: 24.8834, lng: 121.2881, hours: "06:00-22:00" },
      { id: "ty_fm_004", name: "蘆竹店", brand: "全家", address: "桃園市蘆竹區南崁路188號", phone: "03-322-6789", lat: 25.0446, lng: 121.2897, hours: "24小時" },
      { id: "ty_fm_005", name: "楊梅店", brand: "全家", address: "桃園市楊梅區中山路168號", phone: "03-478-1234", lat: 24.9074, lng: 121.1467, hours: "06:00-23:00" },
    ]
  },
  
  // 中部地區
  taichung: {
    name: "台中市",
    stores: [
      // 7-11門市
      { id: "tc_711_001", name: "台中門市", brand: "7-11", address: "台中市中區台灣大道一段188號", phone: "04-2227-5678", lat: 24.1377, lng: 120.6851, hours: "24小時" },
      { id: "tc_711_002", name: "逢甲門市", brand: "7-11", address: "台中市西屯區文華路88號", phone: "04-2451-2345", lat: 24.1791, lng: 120.6447, hours: "24小時" },
      { id: "tc_711_003", name: "一中門市", brand: "7-11", address: "台中市北區一中街128號", phone: "04-2225-6789", lat: 24.1476, lng: 120.6848, hours: "24小時" },
      { id: "tc_711_004", name: "大里門市", brand: "7-11", address: "台中市大里區中興路二段288號", phone: "04-2406-8901", lat: 24.0989, lng: 120.6775, hours: "06:00-23:00" },
      { id: "tc_711_005", name: "豐原門市", brand: "7-11", address: "台中市豐原區中正路168號", phone: "04-2523-4567", lat: 24.2569, lng: 120.7231, hours: "24小時" },
      { id: "tc_711_006", name: "沙鹿門市", brand: "7-11", address: "台中市沙鹿區中山路388號", phone: "04-2662-7890", lat: 24.2362, lng: 120.5688, hours: "24小時" },
      
      // 全家門市
      { id: "tc_fm_001", name: "台中站前店", brand: "全家", address: "台中市中區建國路98號", phone: "04-2223-1234", lat: 24.1369, lng: 120.6852, hours: "24小時" },
      { id: "tc_fm_002", name: "逢甲大學店", brand: "全家", address: "台中市西屯區福星路528號", phone: "04-2452-5678", lat: 24.1797, lng: 120.6445, hours: "24小時" },
      { id: "tc_fm_003", name: "東海店", brand: "全家", address: "台中市西屯區台灣大道四段1688號", phone: "04-2359-9012", lat: 24.1795, lng: 120.5982, hours: "06:00-23:00" },
      { id: "tc_fm_004", name: "太平店", brand: "全家", address: "台中市太平區中山路三段168號", phone: "04-2393-3456", lat: 24.1246, lng: 120.7240, hours: "24小時" },
      { id: "tc_fm_005", name: "清水店", brand: "全家", address: "台中市清水區中山路188號", phone: "04-2622-6789", lat: 24.2642, lng: 120.5687, hours: "06:00-23:00" },
      { id: "tc_fm_006", name: "烏日店", brand: "全家", address: "台中市烏日區光日路288號", phone: "04-2338-8901", lat: 24.1058, lng: 120.6237, hours: "24小時" },
    ]
  },
  
  changhua: {
    name: "彰化縣",
    stores: [
      // 7-11門市
      { id: "ch_711_001", name: "彰化門市", brand: "7-11", address: "彰化縣彰化市中正路一段188號", phone: "04-722-3456", lat: 24.0808, lng: 120.5384, hours: "24小時" },
      { id: "ch_711_002", name: "員林門市", brand: "7-11", address: "彰化縣員林市中山路二段268號", phone: "04-835-7890", lat: 23.9589, lng: 120.5746, hours: "24小時" },
      { id: "ch_711_003", name: "和美門市", brand: "7-11", address: "彰化縣和美鎮彰美路三段128號", phone: "04-735-1234", lat: 24.1105, lng: 120.4977, hours: "06:00-23:00" },
      
      // 全家門市
      { id: "ch_fm_001", name: "彰化站前店", brand: "全家", address: "彰化縣彰化市光復路88號", phone: "04-728-5678", lat: 24.0815, lng: 120.5391, hours: "24小時" },
      { id: "ch_fm_002", name: "員林中正店", brand: "全家", address: "彰化縣員林市中正路168號", phone: "04-832-9012", lat: 23.9597, lng: 120.5739, hours: "24小時" },
      { id: "ch_fm_003", name: "鹿港店", brand: "全家", address: "彰化縣鹿港鎮中山路258號", phone: "04-777-3456", lat: 24.0568, lng: 120.4341, hours: "06:00-22:00" },
    ]
  },
  
  nantou: {
    name: "南投縣",
    stores: [
      // 7-11門市
      { id: "nt_711_001", name: "南投門市", brand: "7-11", address: "南投縣南投市三和三路88號", phone: "049-222-6789", lat: 23.9097, lng: 120.6841, hours: "06:00-23:00" },
      { id: "nt_711_002", name: "草屯門市", brand: "7-11", address: "南投縣草屯鎮中正路168號", phone: "049-232-1234", lat: 23.9744, lng: 120.6803, hours: "24小時" },
      { id: "nt_711_003", name: "埔里門市", brand: "7-11", address: "南投縣埔里鎮中山路三段128號", phone: "049-290-5678", lat: 23.9688, lng: 120.9681, hours: "06:00-23:00" },
      
      // 全家門市
      { id: "nt_fm_001", name: "南投中興店", brand: "全家", address: "南投縣南投市中興路188號", phone: "049-223-9012", lat: 23.9103, lng: 120.6848, hours: "06:00-23:00" },
      { id: "nt_fm_002", name: "埔里中正店", brand: "全家", address: "南投縣埔里鎮中正路268號", phone: "049-299-3456", lat: 23.9695, lng: 120.9688, hours: "06:00-22:00" },
      { id: "nt_fm_003", name: "竹山店", brand: "全家", address: "南投縣竹山鎮集山路二段88號", phone: "049-264-6789", lat: 23.7570, lng: 120.6773, hours: "06:00-23:00" },
    ]
  },
  
  // 南部地區
  tainan: {
    name: "台南市",
    stores: [
      // 7-11門市
      { id: "tn_711_001", name: "台南門市", brand: "7-11", address: "台南市中西區中山路88號", phone: "06-222-5678", lat: 22.9908, lng: 120.2022, hours: "24小時" },
      { id: "tn_711_002", name: "成功門市", brand: "7-11", address: "台南市東區東寧路188號", phone: "06-237-1234", lat: 22.9858, lng: 120.2268, hours: "24小時" },
      { id: "tn_711_003", name: "永康門市", brand: "7-11", address: "台南市永康區中華路268號", phone: "06-302-5678", lat: 23.0260, lng: 120.2571, hours: "24小時" },
      { id: "tn_711_004", name: "安平門市", brand: "7-11", address: "台南市安平區安平路388號", phone: "06-228-9012", lat: 23.0010, lng: 120.1653, hours: "06:00-23:00" },
      { id: "tn_711_005", name: "新營門市", brand: "7-11", address: "台南市新營區中山路128號", phone: "06-632-3456", lat: 23.3104, lng: 120.3165, hours: "24小時" },
      
      // 全家門市
      { id: "tn_fm_001", name: "台南站前店", brand: "全家", address: "台南市中西區北門路一段98號", phone: "06-228-6789", lat: 22.9971, lng: 120.2124, hours: "24小時" },
      { id: "tn_fm_002", name: "成大店", brand: "全家", address: "台南市東區大學路一段168號", phone: "06-275-2345", lat: 22.9976, lng: 120.2186, hours: "24小時" },
      { id: "tn_fm_003", name: "善化店", brand: "全家", address: "台南市善化區中山路258號", phone: "06-581-7890", lat: 23.1326, lng: 120.2973, hours: "06:00-23:00" },
      { id: "tn_fm_004", name: "仁德店", brand: "全家", address: "台南市仁德區中山路388號", phone: "06-270-1234", lat: 22.9717, lng: 120.2475, hours: "24小時" },
      { id: "tn_fm_005", name: "佳里店", brand: "全家", address: "台南市佳里區中山路188號", phone: "06-722-5678", lat: 23.1650, lng: 120.1778, hours: "06:00-23:00" },
    ]
  },
  
  kaohsiung: {
    name: "高雄市",
    stores: [
      // 7-11門市
      { id: "kh_711_001", name: "高雄門市", brand: "7-11", address: "高雄市前金區中正四路88號", phone: "07-215-6789", lat: 22.6273, lng: 120.3014, hours: "24小時" },
      { id: "kh_711_002", name: "三多門市", brand: "7-11", address: "高雄市苓雅區三多三路168號", phone: "07-338-1234", lat: 22.6199, lng: 120.3149, hours: "24小時" },
      { id: "kh_711_003", name: "巨蛋門市", brand: "7-11", address: "高雄市左營區博愛二路288號", phone: "07-556-5678", lat: 22.6730, lng: 120.2967, hours: "24小時" },
      { id: "kh_711_004", name: "鳳山門市", brand: "7-11", address: "高雄市鳳山區中山路188號", phone: "07-742-9012", lat: 22.6268, lng: 120.3565, hours: "24小時" },
      { id: "kh_711_005", name: "岡山門市", brand: "7-11", address: "高雄市岡山區中山南路268號", phone: "07-621-3456", lat: 22.7965, lng: 120.2954, hours: "06:00-23:00" },
      { id: "kh_711_006", name: "楠梓門市", brand: "7-11", address: "高雄市楠梓區德民路388號", phone: "07-364-6789", lat: 22.7333, lng: 120.3279, hours: "24小時" },
      
      // 全家門市
      { id: "kh_fm_001", name: "高雄車站店", brand: "全家", address: "高雄市三民區建國二路198號", phone: "07-235-2345", lat: 22.6391, lng: 120.3023, hours: "24小時" },
      { id: "kh_fm_002", name: "夢時代店", brand: "全家", address: "高雄市前鎮區中華五路789號", phone: "07-973-7890", lat: 22.5936, lng: 120.3080, hours: "24小時" },
      { id: "kh_fm_003", name: "中山大學店", brand: "全家", address: "高雄市鼓山區蓮海路128號", phone: "07-525-1234", lat: 22.6267, lng: 120.2659, hours: "06:00-23:00" },
      { id: "kh_fm_004", name: "小港店", brand: "全家", address: "高雄市小港區漢民路268號", phone: "07-806-5678", lat: 22.5653, lng: 120.3508, hours: "24小時" },
      { id: "kh_fm_005", name: "旗山店", brand: "全家", address: "高雄市旗山區中山路188號", phone: "07-661-9012", lat: 22.8892, lng: 120.4829, hours: "06:00-22:00" },
      { id: "kh_fm_006", name: "美濃店", brand: "全家", address: "高雄市美濃區中正路一段88號", phone: "07-681-3456", lat: 22.8832, lng: 120.5402, hours: "06:00-23:00" },
    ]
  },
  
  pingtung: {
    name: "屏東縣",
    stores: [
      // 7-11門市
      { id: "pt_711_001", name: "屏東門市", brand: "7-11", address: "屏東縣屏東市中正路188號", phone: "08-732-5678", lat: 22.6687, lng: 120.4881, hours: "24小時" },
      { id: "pt_711_002", name: "潮州門市", brand: "7-11", address: "屏東縣潮州鎮新生路268號", phone: "08-788-1234", lat: 22.5507, lng: 120.5422, hours: "06:00-23:00" },
      { id: "pt_711_003", name: "東港門市", brand: "7-11", address: "屏東縣東港鎮中山路128號", phone: "08-832-5678", lat: 22.4653, lng: 120.4544, hours: "24小時" },
      
      // 全家門市
      { id: "pt_fm_001", name: "屏東站前店", brand: "全家", address: "屏東縣屏東市光復路88號", phone: "08-736-9012", lat: 22.6694, lng: 120.4888, hours: "24小時" },
      { id: "pt_fm_002", name: "恆春店", brand: "全家", address: "屏東縣恆春鎮中山路168號", phone: "08-889-3456", lat: 22.0025, lng: 120.7456, hours: "06:00-23:00" },
      { id: "pt_fm_003", name: "萬丹店", brand: "全家", address: "屏東縣萬丹鄉中正路268號", phone: "08-777-6789", lat: 22.5878, lng: 120.4843, hours: "06:00-23:00" },
    ]
  },
  
  // 東部地區
  hualien: {
    name: "花蓮縣",
    stores: [
      // 7-11門市
      { id: "hl_711_001", name: "花蓮門市", brand: "7-11", address: "花蓮縣花蓮市中山路188號", phone: "03-832-5678", lat: 23.9769, lng: 121.6069, hours: "24小時" },
      { id: "hl_711_002", name: "吉安門市", brand: "7-11", address: "花蓮縣吉安鄉中山路三段268號", phone: "03-853-1234", lat: 23.9679, lng: 121.5805, hours: "06:00-23:00" },
      { id: "hl_711_003", name: "新城門市", brand: "7-11", address: "花蓮縣新城鄉新興路88號", phone: "03-861-5678", lat: 24.1286, lng: 121.6431, hours: "06:00-22:00" },
      
      // 全家門市
      { id: "hl_fm_001", name: "花蓮站前店", brand: "全家", address: "花蓮縣花蓮市國聯一路98號", phone: "03-835-9012", lat: 23.9775, lng: 121.6076, hours: "24小時" },
      { id: "hl_fm_002", name: "東華店", brand: "全家", address: "花蓮縣壽豐鄉志學村中正路168號", phone: "03-866-3456", lat: 23.8958, lng: 121.5469, hours: "06:00-23:00" },
      { id: "hl_fm_003", name: "玉里店", brand: "全家", address: "花蓮縣玉里鎮中華路258號", phone: "03-888-6789", lat: 23.3340, lng: 121.3145, hours: "06:00-23:00" },
    ]
  },
  
  taitung: {
    name: "台東縣",
    stores: [
      // 7-11門市
      { id: "tt_711_001", name: "台東門市", brand: "7-11", address: "台東縣台東市中華路一段188號", phone: "089-322-5678", lat: 22.7585, lng: 121.1444, hours: "24小時" },
      { id: "tt_711_002", name: "成功門市", brand: "7-11", address: "台東縣成功鎮中山路128號", phone: "089-851-1234", lat: 23.0995, lng: 121.3690, hours: "06:00-22:00" },
      { id: "tt_711_003", name: "關山門市", brand: "7-11", address: "台東縣關山鎮中正路88號", phone: "089-811-5678", lat: 23.0449, lng: 121.1651, hours: "06:00-23:00" },
      
      // 全家門市
      { id: "tt_fm_001", name: "台東站前店", brand: "全家", address: "台東縣台東市鐵花路268號", phone: "089-326-9012", lat: 22.7592, lng: 121.1451, hours: "24小時" },
      { id: "tt_fm_002", name: "卑南店", brand: "全家", address: "台東縣卑南鄉更生北路168號", phone: "089-229-3456", lat: 22.7866, lng: 121.1230, hours: "06:00-23:00" },
      { id: "tt_fm_003", name: "池上店", brand: "全家", address: "台東縣池上鄉中山路188號", phone: "089-862-6789", lat: 23.1195, lng: 121.2189, hours: "06:00-22:00" },
    ]
  },
  
  yilan: {
    name: "宜蘭縣",
    stores: [
      // 7-11門市
      { id: "yl_711_001", name: "宜蘭門市", brand: "7-11", address: "宜蘭縣宜蘭市中山路二段188號", phone: "03-932-5678", lat: 24.7571, lng: 121.7540, hours: "24小時" },
      { id: "yl_711_002", name: "羅東門市", brand: "7-11", address: "宜蘭縣羅東鎮公正路268號", phone: "03-955-1234", lat: 24.6743, lng: 121.7696, hours: "24小時" },
      { id: "yl_711_003", name: "頭城門市", brand: "7-11", address: "宜蘭縣頭城鎮青雲路一段128號", phone: "03-977-5678", lat: 24.8586, lng: 121.8225, hours: "06:00-23:00" },
      { id: "yl_711_004", name: "礁溪門市", brand: "7-11", address: "宜蘭縣礁溪鄉中山路二段88號", phone: "03-988-9012", lat: 24.8228, lng: 121.7720, hours: "24小時" },
      
      // 全家門市
      { id: "yl_fm_001", name: "宜蘭站前店", brand: "全家", address: "宜蘭縣宜蘭市光復路98號", phone: "03-936-3456", lat: 24.7578, lng: 121.7547, hours: "24小時" },
      { id: "yl_fm_002", name: "羅東夜市店", brand: "全家", address: "宜蘭縣羅東鎮興東路168號", phone: "03-956-6789", lat: 24.6750, lng: 121.7703, hours: "24小時" },
      { id: "yl_fm_003", name: "蘇澳店", brand: "全家", address: "宜蘭縣蘇澳鎮中山路一段258號", phone: "03-996-2345", lat: 24.5959, lng: 121.8457, hours: "06:00-23:00" },
      { id: "yl_fm_004", name: "冬山店", brand: "全家", address: "宜蘭縣冬山鄉中正路188號", phone: "03-959-7890", lat: 24.6334, lng: 121.7932, hours: "06:00-23:00" },
    ]
  },
  
  // 新竹地區
  hsinchu_city: {
    name: "新竹市",
    stores: [
      // 7-11門市
      { id: "hc_711_001", name: "新竹門市", brand: "7-11", address: "新竹市東區中正路88號", phone: "03-522-5678", lat: 24.8047, lng: 120.9714, hours: "24小時" },
      { id: "hc_711_002", name: "清大門市", brand: "7-11", address: "新竹市東區光復路二段188號", phone: "03-571-1234", lat: 24.7954, lng: 120.9939, hours: "24小時" },
      { id: "hc_711_003", name: "交大門市", brand: "7-11", address: "新竹市東區大學路268號", phone: "03-573-5678", lat: 24.7869, lng: 120.9971, hours: "24小時" },
      { id: "hc_711_004", name: "竹科門市", brand: "7-11", address: "新竹市東區科學園區力行路128號", phone: "03-577-9012", lat: 24.7817, lng: 120.9946, hours: "06:00-23:00" },
      
      // 全家門市
      { id: "hc_fm_001", name: "新竹站前店", brand: "全家", address: "新竹市東區中華路二段98號", phone: "03-526-3456", lat: 24.8054, lng: 120.9721, hours: "24小時" },
      { id: "hc_fm_002", name: "城隍廟店", brand: "全家", address: "新竹市北區中山路168號", phone: "03-525-6789", lat: 24.8066, lng: 120.9683, hours: "24小時" },
      { id: "hc_fm_003", name: "巨城店", brand: "全家", address: "新竹市東區中央路288號", phone: "03-535-2345", lat: 24.8138, lng: 120.9752, hours: "24小時" },
      { id: "hc_fm_004", name: "香山店", brand: "全家", address: "新竹市香山區中華路五段388號", phone: "03-538-7890", lat: 24.7681, lng: 120.9143, hours: "06:00-23:00" },
    ]
  },
  
  hsinchu_county: {
    name: "新竹縣",
    stores: [
      // 7-11門市
      { id: "hcc_711_001", name: "竹北門市", brand: "7-11", address: "新竹縣竹北市光明六路188號", phone: "03-555-5678", lat: 24.8387, lng: 121.0082, hours: "24小時" },
      { id: "hcc_711_002", name: "竹東門市", brand: "7-11", address: "新竹縣竹東鎮東林路268號", phone: "03-596-1234", lat: 24.7359, lng: 121.0888, hours: "24小時" },
      { id: "hcc_711_003", name: "湖口門市", brand: "7-11", address: "新竹縣湖口鄉中正路二段128號", phone: "03-569-5678", lat: 24.8993, lng: 121.0408, hours: "06:00-23:00" },
      
      // 全家門市
      { id: "hcc_fm_001", name: "竹北高鐵店", brand: "全家", address: "新竹縣竹北市高鐵七路98號", phone: "03-658-9012", lat: 24.8394, lng: 121.0398, hours: "24小時" },
      { id: "hcc_fm_002", name: "新豐店", brand: "全家", address: "新竹縣新豐鄉建興路一段168號", phone: "03-559-3456", lat: 24.9009, lng: 120.9861, hours: "06:00-23:00" },
      { id: "hcc_fm_003", name: "關西店", brand: "全家", address: "新竹縣關西鎮中正路258號", phone: "03-587-6789", lat: 24.7886, lng: 121.1771, hours: "06:00-23:00" },
    ]
  },
  
  // 苗栗地區
  miaoli: {
    name: "苗栗縣",
    stores: [
      // 7-11門市
      { id: "ml_711_001", name: "苗栗門市", brand: "7-11", address: "苗栗縣苗栗市中正路188號", phone: "037-322-5678", lat: 24.5650, lng: 120.8214, hours: "24小時" },
      { id: "ml_711_002", name: "頭份門市", brand: "7-11", address: "苗栗縣頭份市中央路268號", phone: "037-662-1234", lat: 24.6966, lng: 120.9062, hours: "24小時" },
      { id: "ml_711_003", name: "竹南門市", brand: "7-11", address: "苗栗縣竹南鎮中山路128號", phone: "037-472-5678", lat: 24.6879, lng: 120.8743, hours: "24小時" },
      { id: "ml_711_004", name: "通霄門市", brand: "7-11", address: "苗栗縣通霄鎮中山路88號", phone: "037-752-9012", lat: 24.4893, lng: 120.6776, hours: "06:00-23:00" },
      
      // 全家門市
      { id: "ml_fm_001", name: "苗栗站前店", brand: "全家", address: "苗栗縣苗栗市府前路98號", phone: "037-326-3456", lat: 24.5657, lng: 120.8221, hours: "24小時" },
      { id: "ml_fm_002", name: "頭份中央店", brand: "全家", address: "苗栗縣頭份市和平路168號", phone: "037-666-6789", lat: 24.6973, lng: 120.9069, hours: "24小時" },
      { id: "ml_fm_003", name: "苑裡店", brand: "全家", address: "苗栗縣苑裡鎮中山路258號", phone: "037-862-2345", lat: 24.4432, lng: 120.6502, hours: "06:00-23:00" },
      { id: "ml_fm_004", name: "三義店", brand: "全家", address: "苗栗縣三義鄉中正路188號", phone: "037-872-7890", lat: 24.4132, lng: 120.7586, hours: "06:00-22:00" },
    ]
  },
  
  // 雲林地區
  yunlin: {
    name: "雲林縣",
    stores: [
      // 7-11門市
      { id: "yl_711_001", name: "斗六門市", brand: "7-11", address: "雲林縣斗六市中山路188號", phone: "05-532-5678", lat: 23.7118, lng: 120.5440, hours: "24小時" },
      { id: "yl_711_002", name: "虎尾門市", brand: "7-11", address: "雲林縣虎尾鎮光復路268號", phone: "05-632-1234", lat: 23.7076, lng: 120.4388, hours: "24小時" },
      { id: "yl_711_003", name: "北港門市", brand: "7-11", address: "雲林縣北港鎮中山路128號", phone: "05-783-5678", lat: 23.5745, lng: 120.3005, hours: "06:00-23:00" },
      
      // 全家門市
      { id: "yl_fm_001", name: "斗六站前店", brand: "全家", address: "雲林縣斗六市民生路98號", phone: "05-536-9012", lat: 23.7125, lng: 120.5447, hours: "24小時" },
      { id: "yl_fm_002", name: "西螺店", brand: "全家", address: "雲林縣西螺鎮延平路168號", phone: "05-586-3456", lat: 23.7973, lng: 120.4668, hours: "06:00-23:00" },
      { id: "yl_fm_003", name: "土庫店", brand: "全家", address: "雲林縣土庫鎮中正路258號", phone: "05-662-6789", lat: 23.6800, lng: 120.3932, hours: "06:00-23:00" },
    ]
  },
  
  // 嘉義地區
  chiayi_city: {
    name: "嘉義市",
    stores: [
      // 7-11門市
      { id: "cy_711_001", name: "嘉義門市", brand: "7-11", address: "嘉義市東區中山路188號", phone: "05-222-5678", lat: 23.4800, lng: 120.4491, hours: "24小時" },
      { id: "cy_711_002", name: "嘉大門市", brand: "7-11", address: "嘉義市東區學府路268號", phone: "05-277-1234", lat: 23.4739, lng: 120.4793, hours: "24小時" },
      { id: "cy_711_003", name: "垂楊門市", brand: "7-11", address: "嘉義市西區垂楊路128號", phone: "05-285-5678", lat: 23.4762, lng: 120.4348, hours: "06:00-23:00" },
      
      // 全家門市
      { id: "cy_fm_001", name: "嘉義站前店", brand: "全家", address: "嘉義市西區中山路98號", phone: "05-226-9012", lat: 23.4807, lng: 120.4498, hours: "24小時" },
      { id: "cy_fm_002", name: "文化店", brand: "全家", address: "嘉義市東區文化路168號", phone: "05-276-3456", lat: 23.4821, lng: 120.4654, hours: "24小時" },
      { id: "cy_fm_003", name: "嘉北店", brand: "全家", address: "嘉義市西區北港路258號", phone: "05-233-6789", lat: 23.4894, lng: 120.4372, hours: "06:00-23:00" },
    ]
  },
  
  chiayi_county: {
    name: "嘉義縣",
    stores: [
      // 7-11門市
      { id: "cyc_711_001", name: "太保門市", brand: "7-11", address: "嘉義縣太保市祥和一路188號", phone: "05-362-5678", lat: 23.4591, lng: 120.3329, hours: "24小時" },
      { id: "cyc_711_002", name: "民雄門市", brand: "7-11", address: "嘉義縣民雄鄉中樂路268號", phone: "05-226-1234", lat: 23.5524, lng: 120.4297, hours: "06:00-23:00" },
      { id: "cyc_711_003", name: "朴子門市", brand: "7-11", address: "嘉義縣朴子市山通路128號", phone: "05-379-5678", lat: 23.4648, lng: 120.2474, hours: "06:00-23:00" },
      
      // 全家門市
      { id: "cyc_fm_001", name: "太保高鐵店", brand: "全家", address: "嘉義縣太保市高鐵大道98號", phone: "05-366-9012", lat: 23.4598, lng: 120.3141, hours: "24小時" },
      { id: "cyc_fm_002", name: "水上店", brand: "全家", address: "嘉義縣水上鄉中山路二段168號", phone: "05-268-3456", lat: 23.4276, lng: 120.3979, hours: "06:00-23:00" },
      { id: "cyc_fm_003", name: "竹崎店", brand: "全家", address: "嘉義縣竹崎鄉中正路258號", phone: "05-261-6789", lat: 23.5163, lng: 120.5497, hours: "06:00-22:00" },
    ]
  },
  
  // 離島地區
  penghu: {
    name: "澎湖縣",
    stores: [
      // 7-11門市
      { id: "ph_711_001", name: "馬公門市", brand: "7-11", address: "澎湖縣馬公市中正路88號", phone: "06-927-5678", lat: 23.5668, lng: 119.5790, hours: "06:00-23:00" },
      { id: "ph_711_002", name: "湖西門市", brand: "7-11", address: "澎湖縣湖西鄉中正路128號", phone: "06-992-1234", lat: 23.5857, lng: 119.6523, hours: "06:00-22:00" },
      
      // 全家門市
      { id: "ph_fm_001", name: "馬公中正店", brand: "全家", address: "澎湖縣馬公市中正路168號", phone: "06-926-5678", lat: 23.5675, lng: 119.5797, hours: "06:00-23:00" },
      { id: "ph_fm_002", name: "機場店", brand: "全家", address: "澎湖縣湖西鄉隘門村機場路258號", phone: "06-921-9012", lat: 23.5683, lng: 119.6281, hours: "06:00-22:00" },
    ]
  },
  
  kinmen: {
    name: "金門縣",
    stores: [
      // 7-11門市
      { id: "km_711_001", name: "金城門市", brand: "7-11", address: "金門縣金城鎮民族路88號", phone: "082-325-678", lat: 24.4323, lng: 118.3170, hours: "06:00-23:00" },
      { id: "km_711_002", name: "金湖門市", brand: "7-11", address: "金門縣金湖鎮中正路128號", phone: "082-332-234", lat: 24.4366, lng: 118.4123, hours: "06:00-22:00" },
      
      // 全家門市
      { id: "km_fm_001", name: "金城民生店", brand: "全家", address: "金門縣金城鎮民生路168號", phone: "082-326-901", lat: 24.4330, lng: 118.3177, hours: "06:00-23:00" },
      { id: "km_fm_002", name: "沙美店", brand: "全家", address: "金門縣金沙鎮沙美街258號", phone: "082-352-345", lat: 24.4913, lng: 118.4205, hours: "06:00-22:00" },
    ]
  },
  
  lienchiang: {
    name: "連江縣(馬祖)",
    stores: [
      // 7-11門市
      { id: "lc_711_001", name: "南竿門市", brand: "7-11", address: "連江縣南竿鄉介壽村88號", phone: "0836-25678", lat: 26.1502, lng: 119.9296, hours: "06:00-22:00" },
      
      // 全家門市
      { id: "lc_fm_001", name: "南竿中心店", brand: "全家", address: "連江縣南竿鄉清水村168號", phone: "0836-26901", lat: 26.1509, lng: 119.9303, hours: "06:00-22:00" },
    ]
  }
};

// 輔助函數：依品牌篩選門市
function getStoresByBrand(brand) {
  const result = [];
  for (const region in storeData) {
    const stores = storeData[region].stores.filter(store => store.brand === brand);
    if (stores.length > 0) {
      result.push({
        region: storeData[region].name,
        stores: stores
      });
    }
  }
  return result;
}

// 輔助函數：依區域取得門市
function getStoresByRegion(regionKey) {
  return storeData[regionKey] || null;
}

// 輔助函數：搜尋門市（依名稱或地址）
function searchStores(keyword) {
  const result = [];
  for (const region in storeData) {
    const stores = storeData[region].stores.filter(store => 
      store.name.includes(keyword) || 
      store.address.includes(keyword)
    );
    if (stores.length > 0) {
      result.push({
        region: storeData[region].name,
        stores: stores
      });
    }
  }
  return result;
}

// 輔助函數：計算兩點距離（簡單的經緯度距離計算）
function calculateDistance(lat1, lng1, lat2, lng2) {
  const R = 6371; // 地球半徑（公里）
  const dLat = (lat2 - lat1) * Math.PI / 180;
  const dLng = (lng2 - lng1) * Math.PI / 180;
  const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
            Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
            Math.sin(dLng/2) * Math.sin(dLng/2);
  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
  return R * c;
}

// 輔助函數：尋找最近的門市
function findNearestStores(lat, lng, limit = 5) {
  const allStores = [];
  for (const region in storeData) {
    storeData[region].stores.forEach(store => {
      const distance = calculateDistance(lat, lng, store.lat, store.lng);
      allStores.push({
        ...store,
        region: storeData[region].name,
        distance: distance.toFixed(2)
      });
    });
  }
  return allStores.sort((a, b) => a.distance - b.distance).slice(0, limit);
}

// 統計資訊
function getStatistics() {
  let total = 0;
  let byBrand = { "7-11": 0, "全家": 0 };
  let byRegion = {};
  
  for (const region in storeData) {
    const stores = storeData[region].stores;
    total += stores.length;
    byRegion[storeData[region].name] = stores.length;
    
    stores.forEach(store => {
      byBrand[store.brand]++;
    });
  }
  
  return {
    total,
    byBrand,
    byRegion
  };
}

// 匯出
export { 
  storeData, 
  getStoresByBrand, 
  getStoresByRegion, 
  searchStores, 
  findNearestStores,
  getStatistics 
};

var qtyInput=document.getElementById('qty');
var btnPlus=document.getElementById('btnPlus');
var btnMinus=document.getElementById('btnMinus');
var subtotalDisplay=document.getElementById('subtotalDisplay');
var shippingDisplay=document.getElementById('shippingDisplay');
var totalDisplay=document.getElementById('totalDisplay');
var freeShipNotice=document.getElementById('freeShipNotice');
var pickupSelect=document.getElementById('pickup');
var storeSelectGroup=document.getElementById('storeSelectGroup');
var addressGroup=document.getElementById('addressGroup');
var storeSection=document.getElementById('storeSection');
var selectedStore = '';
var citySelect, districtSelect, storeSelect;

function generateOrderId(){
    var now=new Date();
    var year=now.getFullYear();
    var month=String(now.getMonth()+1).padStart(2,'0');
    var day=String(now.getDate()).padStart(2,'0');
    var random=Math.floor(Math.random()*10000).toString().padStart(4,'0');
    return 'YW'+year+month+day+random;
}

function updatePrice(){
    var qty=parseInt(qtyInput.value);
    if(isNaN(qty)||qty<1){ qty=1; qtyInput.value=1; }
    var subtotal=PRICE*qty;
    var pickupMethod=pickupSelect.value;
    var shipping=0;
    
    if(pickupMethod === '宅配'){
        shipping = (qty>=FREE_SHIPPING_QTY) ? 0 : SHIPPING_DELIVERY;
    } else if(pickupMethod === '7-11' || pickupMethod === '全家'){
        shipping = (qty>=FREE_SHIPPING_QTY) ? 0 : SHIPPING_STORE;
    } else if(pickupMethod === '面交'){
        shipping = 0;
    } else {
        shipping = (qty>=FREE_SHIPPING_QTY) ? 0 : SHIPPING_STORE;
    }
    
    var total=subtotal+shipping;
    subtotalDisplay.textContent='NT$ '+subtotal;
    
    if(shipping === 0){
        if(pickupMethod === '面交'){
            shippingDisplay.textContent='免運費 (面交) ✓';
        } else {
            shippingDisplay.textContent='免運費 ✓';
        }
    } else {
        shippingDisplay.textContent='NT$ '+shipping;
    }
    
    totalDisplay.textContent='NT$ '+total;

    if(pickupMethod === '面交'){
        freeShipNotice.textContent='🎉 面交免運費!';
        freeShipNotice.style.background='#d3f9d8';
    } else if(qty<FREE_SHIPPING_QTY){
        var left=FREE_SHIPPING_QTY-qty;
        freeShipNotice.textContent='再買 '+left+' 罐即可免運 🎁';
        freeShipNotice.style.background='#fff3bf';
    } else {
        var savedAmount = (pickupMethod === '宅配') ? SHIPPING_DELIVERY : SHIPPING_STORE;
        freeShipNotice.textContent='🎉 已達免運門檻!恭喜省下 NT$ '+savedAmount+' 運費!';
        freeShipNotice.style.background='#d3f9d8';
    }
}

function renderStoreOptions(pickupMethod) {
    storeSection.innerHTML = '';
    selectedStore = '';
    
    if (!storeData[pickupMethod]) return;
    
    var stores = storeData[pickupMethod];
    
    var cityDiv = document.createElement('div');
    cityDiv.className = 'store-region';
    var cityLabel = document.createElement('label');
    cityLabel.textContent = '選擇城市';
    cityDiv.appendChild(cityLabel);
    
    citySelect = document.createElement('select');
    citySelect.className = 'form-group';
    citySelect.style.width = '100%';
    citySelect.style.marginTop = '5px';
    var cityDefault = document.createElement('option');
    cityDefault.value = '';
    cityDefault.textContent = '請選擇城市';
    citySelect.appendChild(cityDefault);
    
    Object.keys(stores).forEach(function(city) {
        var option = document.createElement('option');
        option.value = city;
        option.textContent = city;
        citySelect.appendChild(option);
    });
    cityDiv.appendChild(citySelect);
    storeSection.appendChild(cityDiv);
    
    var districtDiv = document.createElement('div');
    districtDiv.className = 'store-region';
    var districtLabel = document.createElement('label');
    districtLabel.textContent = '選擇區域';
    districtDiv.appendChild(districtLabel);
    
    districtSelect = document.createElement('select');
    districtSelect.className = 'form-group';
    districtSelect.style.width = '100%';
    districtSelect.style.marginTop = '5px';
    districtSelect.disabled = true;
    var districtDefault = document.createElement('option');
    districtDefault.value = '';
    districtDefault.textContent = '請先選擇城市';
    districtSelect.appendChild(districtDefault);
    districtDiv.appendChild(districtSelect);
    storeSection.appendChild(districtDiv);
    
    var storeDiv = document.createElement('div');
    storeDiv.className = 'store-region';
    var storeLabel = document.createElement('label');
    storeLabel.textContent = '選擇門市';
    storeDiv.appendChild(storeLabel);
    
    storeSelect = document.createElement('select');
    storeSelect.className = 'form-group';
    storeSelect.style.width = '100%';
    storeSelect.style.marginTop = '5px';
    storeSelect.disabled = true;
    var storeDefault = document.createElement('option');
    storeDefault.value = '';
    storeDefault.textContent = '請先選擇區域';
    storeSelect.appendChild(storeDefault);
    storeDiv.appendChild(storeSelect);
    storeSection.appendChild(storeDiv);
    
    citySelect.addEventListener('change', function() {
        var selectedCity = this.value;
        districtSelect.innerHTML = '';
        storeSelect.innerHTML = '';
        storeSelect.disabled = true;
        selectedStore = '';
        
        var districtDefault = document.createElement('option');
        districtDefault.value = '';
        districtDefault.textContent = '請選擇區域';
        districtSelect.appendChild(districtDefault);
        
        var storeDefault = document.createElement('option');
        storeDefault.value = '';
        storeDefault.textContent = '請先選擇區域';
        storeSelect.appendChild(storeDefault);
        
        if (selectedCity && stores[selectedCity]) {
            districtSelect.disabled = false;
            Object.keys(stores[selectedCity]).forEach(function(district) {
                var option = document.createElement('option');
                option.value = district;
                option.textContent = district;
                districtSelect.appendChild(option);
            });
        } else {
            districtSelect.disabled = true;
        }
    });
    
    districtSelect.addEventListener('change', function() {
        var selectedCity = citySelect.value;
        var selectedDistrict = this.value;
        storeSelect.innerHTML = '';
        selectedStore = '';
        
        var storeDefault = document.createElement('option');
        storeDefault.value = '';
        storeDefault.textContent = '請選擇門市';
        storeSelect.appendChild(storeDefault);
        
        if (selectedCity && selectedDistrict && stores[selectedCity][selectedDistrict]) {
            storeSelect.disabled = false;
            stores[selectedCity][selectedDistrict].forEach(function(store) {
                var option = document.createElement('option');
                option.value = selectedCity + '-' + selectedDistrict + '-' + store;
                option.textContent = store;
                storeSelect.appendChild(option);
            });
        } else {
            storeSelect.disabled = true;
        }
    });
    
    storeSelect.addEventListener('change', function() {
        selectedStore = this.value;
    });
}

pickupSelect.addEventListener('change', function() {
    var method = this.value;
    var addressInput = document.getElementById('address');
    var addressLabel = document.getElementById('addressLabel');
    
    if (method === '7-11' || method === '全家') {
        storeSelectGroup.style.display = 'block';
        addressGroup.style.display = 'none';
        addressInput.value = '';
        addressInput.readOnly = false;
        addressInput.style.backgroundColor = '';
        renderStoreOptions(method);
    } else if (method === '宅配') {
        storeSelectGroup.style.display = 'none';
        addressGroup.style.display = 'block';
        addressLabel.textContent = '收貨地址 *';
        addressInput.placeholder = '請填寫完整地址';
        addressInput.value = '';
        addressInput.readOnly = false;
        addressInput.style.backgroundColor = '';
    } else if (method === '面交') {
        storeSelectGroup.style.display = 'none';
        addressGroup.style.display = 'block';
        addressLabel.textContent = '面交地點';
        addressInput.value = '802高雄市苓雅區武廟路206號';
        addressInput.readOnly = true;
        addressInput.style.backgroundColor = '#f0f0f0';
        addressInput.placeholder = '';
    } else {
        storeSelectGroup.style.display = 'none';
        addressGroup.style.display = 'none';
        addressInput.value = '';
        addressInput.readOnly = false;
        addressInput.style.backgroundColor = '';
    }
    
    updatePrice();
});

btnPlus.addEventListener('click',function(e){e.preventDefault();qtyInput.value=parseInt(qtyInput.value)+1;updatePrice();});
btnMinus.addEventListener('click',function(e){e.preventDefault();if(parseInt(qtyInput.value)>1){qtyInput.value=parseInt(qtyInput.value)-1;updatePrice();}});

document.getElementById('orderForm').addEventListener('submit',async function(e){
    e.preventDefault();
    var submitBtn=document.getElementById('submitBtn');
    var messageDiv=document.getElementById('message');

    var phone=document.getElementById('phone').value.trim();
    var account=document.getElementById('accountLast5').value.trim();
    var pickupMethod=document.getElementById('pickup').value;
    var addressInput=document.getElementById('address').value.trim();
    
    if(!/^09\d{8}$/.test(phone)){ messageDiv.innerHTML='<div class="error-message">❌ 請輸入正確手機號碼(例:0912345678)</div>'; return; }
    if(!/^\d{5}$/.test(account)){ messageDiv.innerHTML='<div class="error-message">❌ 帳號後5碼必須是5位數字</div>'; return; }
    
    var finalAddress = '';
    if (pickupMethod === '7-11' || pickupMethod === '全家') {
        if (!selectedStore) {
            messageDiv.innerHTML='<div class="error-message">❌ 請選擇門市</div>';
            return;
        }
        finalAddress = selectedStore;
    } else if (pickupMethod === '宅配' || pickupMethod === '面交') {
        if (addressInput.length < 5) {
            messageDiv.innerHTML='<div class="error-message">❌ 請填寫完整地址或地點</div>';
            return;
        }
        finalAddress = addressInput;
    } else {
        messageDiv.innerHTML='<div class="error-message">❌ 請選擇取貨方式</div>';
        return;
    }

    submitBtn.disabled=true; submitBtn.textContent='處理中...'; messageDiv.innerHTML='';

    try{
        var qty=parseInt(qtyInput.value);
        var subtotal=PRICE*qty;
        var shipping=0;
        
        if(pickupMethod === '宅配'){
            shipping = (qty>=FREE_SHIPPING_QTY) ? 0 : SHIPPING_DELIVERY;
        } else if(pickupMethod === '7-11' || pickupMethod === '全家'){
            shipping = (qty>=FREE_SHIPPING_QTY) ? 0 : SHIPPING_STORE;
        } else if(pickupMethod === '面交'){
            shipping = 0;
        }
        
        var total=subtotal+shipping;
        var orderId=generateOrderId();
        var orderTime=new Date().toLocaleString('zh-TW',{year:'numeric',month:'2-digit',day:'2-digit',hour:'2-digit',minute:'2-digit',hour12:false});
        var customerName=document.getElementById('name').value;
        var customerEmail=document.getElementById('email').value;
        var note=document.getElementById('note').value||'無';

        var merchantEmailContent=`╔═══════════════════════════════════╗
🛒 新訂單通知 - 渝味食記
╚═══════════════════════════════════╝
訂單編號:${orderId}
訂單時間:${orderTime}
姓名:${customerName}
電話:${phone}
Email:${customerEmail}
取貨方式:${pickupMethod}
收貨地址/門市:${finalAddress}
匯款帳號後5碼:${account}
商品名稱:【渝味食記】四川濃香型辣椒醬
單價:NT$ ${PRICE}
數量:${qty} 罐
小計:NT$ ${subtotal}
商品小計:NT$ ${subtotal}
運費:${shipping===0?(pickupMethod==='面交'?'免運費 (面交) ✓':'免運費 ✓'):'NT$ '+shipping}
訂單總額:NT$ ${total}
備註:${note}
提醒事項:
${pickupMethod==='面交'?'⚠️ 此訂單選擇面交,請透過 Instagram 與客戶確認時間地點':''}
${shipping===0&&pickupMethod!=='面交'?'✅ 此訂單已達免運門檻':''}
${pickupMethod==='面交'?'✅ 面交免運費':''}`;

        await fetch('https://api.web3forms.com/submit',{
            method:'POST',
            headers:{'Content-Type':'application/json','Accept':'application/json'},
            body:JSON.stringify({access_key:WEB3FORMS_ACCESS_KEY,subject:`🛒 新訂單 ${orderId} - 渝味食記`,from_name:'渝味食記訂購系統',email:MERCHANT_EMAIL,message:merchantEmailContent})
        });

        var customerEmailContent=`親愛的 ${customerName} 您好:
感謝您於 渝味食記 下單!
訂單編號:${orderId}
商品:【渝味食記】四川濃香型辣椒醬 x ${qty} 罐
小計:NT$ ${subtotal}
運費:${shipping===0?(pickupMethod==='面交'?'免運費 (面交) ✓':'免運費 ✓'):'NT$ '+shipping}
總計:NT$ ${total}
取貨方式:${pickupMethod}
收貨地址/門市:${finalAddress}
備註:${note}
請記住您的訂單編號以便查詢
⚠️ 若選擇面交,請透過 Instagram 私訊我們確認時間地點
Instagram: @yuweishiji`;

        await fetch('https://api.web3forms.com/submit',{
            method:'POST',
            headers:{'Content-Type':'application/json','Accept':'application/json'},
            body:JSON.stringify({access_key:WEB3FORMS_ACCESS_KEY,from_name:'渝味食記訂購系統',email:customerEmail,message:customerEmailContent})
        });

        messageDiv.innerHTML=`<div class="success-message">
✅ 訂單已成功送出!<br><br>
<strong>訂單編號:${orderId}</strong><br><br>
我們已收到您的訂單,會盡快與您聯繫。<br>
${pickupMethod==='面交'?'<br>⚠️ 您選擇了面交,請透過 Instagram 私訊我們確認時間地點。<br>':''}
<br>請記住您的訂單編號以便查詢。<br>
📧 確認信已發送至您的 Email<br>
Instagram: @yuweishiji
</div>`;

        document.getElementById('orderForm').reset();
        qtyInput.value=1;
        selectedStore = '';
        storeSelectGroup.style.display = 'none';
        addressGroup.style.display = 'none';
        updatePrice();

    } catch(err){
        console.error(err);
        messageDiv.innerHTML=`<div class="error-message">
❌ 訂單送出失敗<br><br>
請稍後再試,或直接透過 Instagram 聯繫我們:<br><strong>@yuweishiji</strong>
</div>`;
    } finally{
        submitBtn.disabled=false; submitBtn.textContent='確認訂購';
    }
});

updatePrice();
</script>
</body>
</html>



