<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ¸å‘³é£Ÿè¨˜ - é‡æ…¶å°éºµæ‰‹å·¥è¾£æ¤’é†¬</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Microsoft JhengHei', Arial, sans-serif;
      background: linear-gradient(135deg, #d32f2f 0%, #f44336 100%);
      min-height: 100vh;
      padding: 20px;
    }
    .container {
      max-width: 800px;
      margin: 0 auto;
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      overflow: hidden;
    }
    .header {
      background: linear-gradient(135deg, #b71c1c 0%, #d32f2f 100%);
      color: white;
      padding: 40px 30px;
      text-align: center;
    }
    .header h1 { font-size: 2.5em; margin-bottom: 10px; text-shadow: 2px 2px 4px rgba(0,0,0,0.2); }
    .header p { font-size: 1.1em; opacity: 0.95; }
    .ig-link {
      display: inline-block;
      margin-top: 10px;
      padding: 8px 20px;
      background: rgba(255,255,255,0.2);
      border-radius: 20px;
      color: white;
      text-decoration: none;
      transition: background 0.3s;
    }
    .ig-link:hover { background: rgba(255,255,255,0.3); }
    .product-section { padding: 40px 30px; }
    .product-card {
      background: linear-gradient(135deg, #fff5f5 0%, #ffebee 100%);
      border-radius: 15px;
      padding: 30px;
      border: 3px solid #f44336;
    }
    .product-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      margin-bottom: 20px;
    }
    .product-name { font-size: 1.8em; color: #b71c1c; font-weight: bold; }
    .product-price { font-size: 1.6em; color: #d32f2f; font-weight: bold; }
    .special-badge {
      display: inline-block;
      background: #ff6b6b;
      color: white;
      padding: 5px 15px;
      border-radius: 20px;
      font-size: 0.9em;
      margin-left: 10px;
    }
    .highlight {
      background: #fff3bf;
      padding: 15px;
      border-radius: 10px;
      margin: 15px 0;
      border-left: 4px solid #f44336;
    }
    .highlight strong { color: #b71c1c; }
    .form-group { margin: 20px 0; }
    .form-group label {
      display: block;
      margin-bottom: 8px;
      color: #333;
      font-weight: bold;
    }
    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: 12px;
      border: 2px solid #ddd;
      border-radius: 8px;
      font-size: 1em;
      transition: border-color 0.3s;
    }
    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: #f44336;
    }
    .quantity-control {
      display: flex;
      align-items: center;
      gap: 15px;
    }
    .quantity-control button {
      width: 40px;
      height: 40px;
      border: none;
      background: #f44336;
      color: white;
      font-size: 1.5em;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.3s;
      user-select: none;
    }
    .quantity-control button:hover { background: #d32f2f; }
    .quantity-control button:active { transform: scale(0.95); }
    .quantity-control input {
      width: 80px;
      text-align: center;
      font-size: 1.2em;
      font-weight: bold;
      pointer-events: none;
    }
    .total-section {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 10px;
      margin: 20px 0;
      transition: all 0.3s ease;
    }
    .total-row {
      display: flex;
      justify-content: space-between;
      margin: 10px 0;
      font-size: 1.1em;
    }
    .total-row.final {
      font-size: 1.5em;
      font-weight: bold;
      color: #b71c1c;
      border-top: 2px solid #ddd;
      padding-top: 10px;
      margin-top: 15px;
    }
    .notice {
      background: #fff3bf;
      padding: 15px;
      border-radius: 10px;
      margin: 20px 0;
      text-align: center;
      font-weight: bold;
      color: #b71c1c;
      border: 2px dashed #ffa94d;
      transition: all 0.3s ease;
    }
    .submit-btn {
      width: 100%;
      padding: 18px;
      background: linear-gradient(135deg, #b71c1c 0%, #d32f2f 100%);
      color: white;
      border: none;
      border-radius: 12px;
      font-size: 1.3em;
      font-weight: bold;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    .submit-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(183, 28, 28, 0.4);
    }
    .submit-btn:disabled { background: #ccc; cursor: not-allowed; transform: none; }
    .success-message {
      background: #d3f9d8;
      padding: 20px;
      border-radius: 10px;
      margin: 20px 0;
      text-align: center;
      color: #2b8a3e;
      font-weight: bold;
      border: 2px solid #51cf66;
    }
    .error-message {
      background: #ffe3e3;
      padding: 20px;
      border-radius: 10px;
      margin: 20px 0;
      text-align: center;
      color: #b71c1c;
      font-weight: bold;
      border: 2px solid #f44336;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ğŸŒ¶ï¸ æ¸å‘³é£Ÿè¨˜ ğŸŒ¶ï¸</h1>
      <p>é‡æ…¶å°éºµ - æ‰‹å·¥è¾£æ¤’é†¬</p>
      <a href="https://www.instagram.com/yuweishiji" target="_blank" class="ig-link">ğŸ“· è¿½è¹¤æˆ‘å€‘çš„ Instagram</a>
    </div>

    <div class="product-section">
      <div class="product-card">
        <div class="product-header">
          <div>
            <span class="product-name">æ‰‹å·¥è¾£æ¤’é†¬</span>
            <span class="special-badge">ğŸ”¥ éº»è¾£å‹çˆ†</span>
          </div>
          <div class="product-price">NT$ 250 / ç½</div>
        </div>

        <div class="highlight">
          <strong>æ‰‹å·¥è£½ä½œã€ç„¡æ·»åŠ é˜²è…åŠ‘ï¼Œé–‹å°å¾Œéœ€å†·è—ä¿å­˜ âš ï¸</strong>
        </div>

        <form id="orderForm">
          <div class="form-group">
            <label>è³¼è²·æ•¸é‡</label>
            <div class="quantity-control">
              <button type="button" id="btnMinus">âˆ’</button>
              <input type="number" id="qty" value="1" min="1" readonly>
              <button type="button" id="btnPlus">+</button>
            </div>
          </div>

          <div class="notice" id="freeShipNotice">ğŸ‰ è³¼è²·10ç½(å«)ä»¥ä¸Šå…é‹è²»ï¼</div>

          <div class="form-group"><label>å§“å *</label><input type="text" id="name" required></div>
          <div class="form-group"><label>é›»è©± *</label><input type="tel" id="phone" required placeholder="ä¾‹ï¼š0912345678"></div>
          <div class="form-group"><label>Email *</label><input type="email" id="email" required></div>
          <div class="form-group">
            <label>å–è²¨æ–¹å¼ *</label>
            <select id="pickup" required>
              <option value="">è«‹é¸æ“‡å–è²¨æ–¹å¼</option>
              <option value="7-11">7-11 è¶…å•†å–è²¨</option>
              <option value="å…¨å®¶">å…¨å®¶è¶…å•†å–è²¨</option>
              <option value="å®…é…">å®…é…</option>
              <option value="é¢äº¤">é¢äº¤ (è«‹å…ˆç§è¨ŠIGç¢ºèª)</option>
            </select>
          </div>
          <div class="form-group">
            <label>æ”¶è²¨åœ°å€ / è¶…å•†åº—å *</label>
            <textarea id="address" rows="3" required placeholder="è«‹å¡«å¯«å®Œæ•´åœ°å€æˆ–è¶…å•†åº—å"></textarea>
          </div>
          <div class="form-group">
            <label>åŒ¯æ¬¾å¸³è™Ÿå¾Œ5ç¢¼ *</label>
            <input type="text" id="accountLast5" maxlength="5" pattern="[0-9]{5}" required placeholder="è«‹å¡«å¯«5ä½æ•¸å­—">
          </div>
          <div class="form-group">
            <label>å‚™è¨»</label>
            <textarea id="note" rows="2" placeholder="å…¶ä»–éœ€æ±‚æˆ–å‚™è¨»"></textarea>
          </div>

          <div class="total-section">
            <div class="total-row"><span>å°è¨ˆï¼š</span><span id="subtotalDisplay">NT$ 250</span></div>
            <div class="total-row"><span>é‹è²»ï¼š</span><span id="shippingDisplay">NT$ 130</span></div>
            <div class="total-row final"><span>ç¸½è¨ˆï¼š</span><span id="totalDisplay">NT$ 380</span></div>
          </div>

          <button type="button" class="submit-btn" id="testBtn" style="background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%); margin-bottom: 15px;">ğŸ”§ æ¸¬è©¦ EmailJS é€£ç·š</button>
          <button type="submit" class="submit-btn" id="submitBtn">ç¢ºèªè¨‚è³¼</button>
          <div id="message"></div>
        </form>
      </div>
    </div>
  </div>

  <script src="https://cdn.emailjs.com/dist/email.min.js"></script>
  <script>
    (function(){
      emailjs.init("GwHiFRfQTUQLLEuqi");
      console.log('EmailJS åˆå§‹åŒ–å®Œæˆ');
    })();

    var PRICE = 250;
    var SHIPPING = 130;
    var FREE_SHIPPING_QTY = 10;

    var qtyInput = document.getElementById('qty');
    var btnPlus = document.getElementById('btnPlus');
    var btnMinus = document.getElementById('btnMinus');
    var subtotalDisplay = document.getElementById('subtotalDisplay');
    var shippingDisplay = document.getElementById('shippingDisplay');
    var totalDisplay = document.getElementById('totalDisplay');
    var freeShipNotice = document.getElementById('freeShipNotice');

    function generateOrderId() {
      var now = new Date();
      var year = now.getFullYear();
      var month = String(now.getMonth() + 1).padStart(2, '0');
      var day = String(now.getDate()).padStart(2, '0');
      var random = Math.floor(Math.random() * 10000).toString().padStart(4, '0');
      return 'YW' + year + month + day + random;
    }

    function updatePrice() {
      var qty = parseInt(qtyInput.value);
      if (isNaN(qty) || qty < 1) {
        qty = 1;
        qtyInput.value = 1;
      }

      var subtotal = PRICE * qty;
      var shipping = (qty >= FREE_SHIPPING_QTY) ? 0 : SHIPPING;
      var total = subtotal + shipping;

      subtotalDisplay.textContent = 'NT$ ' + subtotal;
      shippingDisplay.textContent = (shipping === 0) ? 'å…é‹è²» âœ“' : 'NT$ ' + shipping;
      totalDisplay.textContent = 'NT$ ' + total;

      if (qty < FREE_SHIPPING_QTY) {
        var left = FREE_SHIPPING_QTY - qty;
        freeShipNotice.textContent = 'å†è²· ' + left + ' ç½å³å¯å…é‹ ğŸ';
        freeShipNotice.style.background = '#fff3bf';
      } else {
        freeShipNotice.textContent = 'ğŸ‰ å·²é”å…é‹é–€æª»ï¼æ­å–œçœä¸‹ NT$ ' + SHIPPING + ' é‹è²»ï¼';
        freeShipNotice.style.background = '#d3f9d8';
      }
    }

    btnPlus.addEventListener('click', function(e) {
      e.preventDefault();
      var current = parseInt(qtyInput.value);
      qtyInput.value = current + 1;
      updatePrice();
      console.log('å¢åŠ æ•¸é‡:', qtyInput.value);
    });

    btnMinus.addEventListener('click', function(e) {
      e.preventDefault();
      var current = parseInt(qtyInput.value);
      if (current > 1) {
        qtyInput.value = current - 1;
        updatePrice();
        console.log('æ¸›å°‘æ•¸é‡:', qtyInput.value);
      }
    });

    document.getElementById('testBtn').addEventListener('click', function() {
      var messageDiv = document.getElementById('message');
      var testBtn = document.getElementById('testBtn');
      
      testBtn.disabled = true;
      testBtn.textContent = 'æ¸¬è©¦ä¸­...';
      messageDiv.innerHTML = '<div style="background: #e3f2fd; padding: 15px; border-radius: 10px; margin: 20px 0; text-align: center; color: #1976d2; font-weight: bold; border: 2px solid #2196F3;">ğŸ“¡ æ­£åœ¨æ¸¬è©¦ EmailJS é€£ç·š...</div>';
      
      console.log('=== EmailJS æ¸¬è©¦é–‹å§‹ ===');
      console.log('Public Key:', 'GwHiFRfQTUQLLEuqi');
      console.log('Service ID:', 'service_wu888');
      console.log('Template ID (å•†å®¶):', 'template_76gxwe5');
      console.log('Template ID (å®¢æˆ¶):', 'template_hrlozlc');
      
      var testParams = {
        order_id: 'TEST123',
        product_name: 'æ¸¬è©¦å•†å“',
        quantity: 1,
        unit_price: 250,
        subtotal: 250,
        shipping: 130,
        total: 380,
        customer_name: 'æ¸¬è©¦å®¢æˆ¶',
        customer_phone: '0912345678',
        customer_email: 'test@example.com',
        pickup_method: '7-11',
        address: 'æ¸¬è©¦åœ°å€',
        account_last5: '12345',
        note: 'é€™æ˜¯æ¸¬è©¦è¨‚å–®',
        to_email: 'bonnywu992@gmail.com'
      };
      
      emailjs.send('service_wu888', 'template_76gxwe5', testParams)
        .then(function(response) {
          console.log('âœ… æ¸¬è©¦æˆåŠŸ!', response);
          messageDiv.innerHTML = '<div class="success-message">âœ… EmailJS é€£ç·šæ¸¬è©¦æˆåŠŸï¼<br>ç‹€æ…‹ç¢¼: ' + response.status + '<br>æœå‹™æ­£å¸¸é‹ä½œä¸­ã€‚<br><br>å¦‚æœè¨‚è³¼é‚„æ˜¯å¤±æ•—ï¼Œè«‹æª¢æŸ¥ï¼š<br>1. å®¢æˆ¶æ¨¡æ¿ template_hrlozlc æ˜¯å¦å­˜åœ¨<br>2. æ¨¡æ¿è®Šæ•¸åç¨±æ˜¯å¦æ­£ç¢º</div>';
          testBtn.disabled = false;
          testBtn.textContent = 'ğŸ”§ æ¸¬è©¦ EmailJS é€£ç·š';
        })
        .catch(function(error) {
          console.error('âŒ æ¸¬è©¦å¤±æ•—!', error);
          console.error('éŒ¯èª¤è©³æƒ…:', JSON.stringify(error, null, 2));
          
          var errorMsg = 'âŒ EmailJS é€£ç·šæ¸¬è©¦å¤±æ•—<br><br>';
          
          if (error.status === 418) {
            errorMsg += '<strong>éŒ¯èª¤ 418ï¼š</strong><br>';
            errorMsg += 'â€¢ Public Key å¯èƒ½éŒ¯èª¤<br>';
            errorMsg += 'â€¢ ç¶²åŸŸå¯èƒ½æœªæˆæ¬Š<br>';
            errorMsg += 'â€¢ EmailJS å¸³è™Ÿå¯èƒ½æœ‰å•é¡Œ<br><br>';
          } else if (error.status === 400) {
            errorMsg += '<strong>éŒ¯èª¤ 400ï¼š</strong><br>';
            errorMsg += 'â€¢ Service ID æˆ– Template ID éŒ¯èª¤<br>';
            errorMsg += 'â€¢ æ¨¡æ¿è®Šæ•¸ä¸åŒ¹é…<br><br>';
          } else if (error.status === 403) {
            errorMsg += '<strong>éŒ¯èª¤ 403ï¼š</strong><br>';
            errorMsg += 'â€¢ ç¶²åŸŸæœªæˆæ¬Š<br>';
            errorMsg += 'â€¢ è«‹åˆ° EmailJS Account è¨­å®šå…è¨±çš„ç¶²åŸŸ<br><br>';
          }
          
          errorMsg += 'éŒ¯èª¤ä»£ç¢¼: ' + (error.status || 'æœªçŸ¥') + '<br>';
          errorMsg += 'éŒ¯èª¤è¨Šæ¯: ' + (error.text || 'æœªçŸ¥') + '<br><br>';
          errorMsg += 'è«‹å°‡æ­¤è¨Šæ¯æˆªåœ–ï¼Œä¸¦æª¢æŸ¥ EmailJS è¨­å®šã€‚';
          
          messageDiv.innerHTML = '<div class="error-message">' + errorMsg + '</div>';
          testBtn.disabled = false;
          testBtn.textContent = 'ğŸ”§ æ¸¬è©¦ EmailJS é€£ç·š';
        });
    });

    document.getElementById('orderForm').addEventListener('submit', function(e) {
      e.preventDefault();

      var submitBtn = document.getElementById('submitBtn');
      var messageDiv = document.getElementById('message');

      var phone = document.getElementById('phone').value.trim();
      var account = document.getElementById('accountLast5').value.trim();
      var address = document.getElementById('address').value.trim();

      if (!/^09\d{8}$/.test(phone)) {
        messageDiv.innerHTML = '<div class="error-message">âŒ è«‹è¼¸å…¥æ­£ç¢ºçš„æ‰‹æ©Ÿè™Ÿç¢¼æ ¼å¼ï¼ˆä¾‹ï¼š0912345678ï¼‰</div>';
        return;
      }

      if (!/^\d{5}$/.test(account)) {
        messageDiv.innerHTML = '<div class="error-message">âŒ å¸³è™Ÿå¾Œ5ç¢¼å¿…é ˆæ˜¯5ä½æ•¸å­—</div>';
        return;
      }

      if (address.length < 5) {
        messageDiv.innerHTML = '<div class="error-message">âŒ è«‹å¡«å¯«å®Œæ•´çš„æ”¶è²¨åœ°å€æˆ–è¶…å•†åº—å</div>';
        return;
      }

      submitBtn.disabled = true;
      submitBtn.textContent = 'è™•ç†ä¸­...';
      messageDiv.innerHTML = '';

      var qty = parseInt(qtyInput.value);
      var subtotal = PRICE * qty;
      var shipping = (qty >= FREE_SHIPPING_QTY) ? 0 : SHIPPING;
      var total = subtotal + shipping;
      var orderId = generateOrderId();

      console.log('æº–å‚™ç™¼é€éƒµä»¶ï¼Œè¨‚å–®ç·¨è™Ÿ:', orderId);

      var merchantParams = {
        order_id: orderId,
        product_name: 'ã€æ¸å‘³é£Ÿè¨˜ã€‘é‡æ…¶å°éºµæ‰‹å·¥è¾£æ¤’é†¬',
        quantity: qty,
        unit_price: PRICE,
        subtotal: subtotal,
        shipping: (shipping === 0) ? 'å…é‹è²»' : shipping,
        total: total,
        customer_name: document.getElementById('name').value,
        customer_phone: phone,
        customer_email: document.getElementById('email').value,
        pickup_method: document.getElementById('pickup').value,
        address: address,
        account_last5: account,
        note: document.getElementById('note').value || 'ç„¡',
        to_email: 'bonnywu992@gmail.com'
      };

      var customerParams = {
        order_id: orderId,
        product_name: 'ã€æ¸å‘³é£Ÿè¨˜ã€‘é‡æ…¶å°éºµæ‰‹å·¥è¾£æ¤’é†¬',
        quantity: qty,
        unit_price: PRICE,
        subtotal: subtotal,
        shipping: (shipping === 0) ? 'å…é‹è²»' : 'NT$ ' + shipping,
        total: total,
        customer_name: document.getElementById('name').value,
        pickup_method: document.getElementById('pickup').value,
        address: address,
        to_email: document.getElementById('email').value
      };

      Promise.allSettled([
        emailjs.send('service_wu888', 'template_76gxwe5', merchantParams),
        emailjs.send('service_wu888', 'template_hrlozlc', customerParams)
      ])
      .then(function(results) {
        var merchantSuccess = results[0].status === 'fulfilled';
        var customerSuccess = results[1].status === 'fulfilled';
        
        if (merchantSuccess && customerSuccess) {
          messageDiv.innerHTML = '<div class="success-message">âœ… è¨‚å–®å·²é€å‡ºæˆåŠŸï¼<br>è¨‚å–®ç·¨è™Ÿï¼š' + orderId + '<br>å•†å®¶å’Œæ‚¨éƒ½å·²æ”¶åˆ°è¨‚å–®ç¢ºèªä¿¡ï¼Œè«‹ç•™æ„ä¿¡ç®±ã€‚<br>å¦‚é¸æ“‡é¢äº¤è«‹ç§è¨Š Instagram ç¢ºèªã€‚</div>';
          document.getElementById('orderForm').reset();
          qtyInput.value = 1;
          updatePrice();
        } else if (merchantSuccess) {
          messageDiv.innerHTML = '<div class="success-message">âœ… è¨‚å–®å·²é€å‡ºï¼<br>è¨‚å–®ç·¨è™Ÿï¼š' + orderId + '<br>å•†å®¶å·²æ”¶åˆ°è¨‚å–®ã€‚<br>âš ï¸ å®¢æˆ¶ç¢ºèªä¿¡ç™¼é€å¤±æ•—ï¼Œè«‹è¨˜éŒ„æ‚¨çš„è¨‚å–®ç·¨è™Ÿã€‚</div>';
          document.getElementById('orderForm').reset();
          qtyInput.value = 1;
          updatePrice();
        } else {
          throw new Error('éƒµä»¶ç™¼é€å¤±æ•—');
        }
        
        submitBtn.disabled = false;
        submitBtn.textContent = 'ç¢ºèªè¨‚è³¼';
      })
      .catch(function(error) {
        console.error('ç™¼é€å¤±æ•—è©³ç´°è³‡è¨Š:', error);
        console.error('å®Œæ•´éŒ¯èª¤ç‰©ä»¶:', JSON.stringify(error, null, 2));
        
        var errorMsg = 'âŒ è¨‚å–®é€å‡ºå¤±æ•—<br><br>';
        
        if (error && error.text) {
          errorMsg += 'éŒ¯èª¤è¨Šæ¯: ' + error.text + '<br>';
        }
        if (error && error.status) {
          errorMsg += 'éŒ¯èª¤ä»£ç¢¼: ' + error.status + '<br>';
        }
        
        errorMsg += '<br><strong>å¯èƒ½åŸå› ï¼š</strong><br>';
        errorMsg += '1. EmailJS è¨­å®šéŒ¯èª¤ï¼ˆService ID æˆ– Template IDï¼‰<br>';
        errorMsg += '2. EmailJS éƒµä»¶é¡åº¦å·²ç”¨å®Œ<br>';
        errorMsg += '3. ç¶²è·¯é€£ç·šå•é¡Œ<br><br>';
        errorMsg += 'è«‹æˆªåœ–æ­¤ç•«é¢ï¼ˆåŒ…å«ç€è¦½å™¨ä¸»æ§å°ï¼‰ä¸¦é€é Instagram è¯ç¹«æˆ‘å€‘ã€‚<br>';
        errorMsg += 'Instagram: @yuweishiji';
        
        messageDiv.innerHTML = '<div class="error-message">' + errorMsg + '</div>';
        submitBtn.disabled = false;
        submitBtn.textContent = 'ç¢ºèªè¨‚è³¼';
      });
    });

    updatePrice();
    console.log('è¨‚è³¼ç³»çµ±åˆå§‹åŒ–å®Œæˆ');
    console.log('æŒ‰éˆ•å…ƒç´ :', btnPlus, btnMinus);
  </script>
</body>
</html>
