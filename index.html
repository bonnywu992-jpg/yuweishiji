<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>渝味食記 - 四川濃香型辣椒醬</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
  font-family: 'Microsoft JhengHei', Arial, sans-serif;
  background: linear-gradient(135deg, #d32f2f 0%, #f44336 100%);
  min-height: 100vh;
  padding: 20px;
}
.container {
  max-width: 800px; margin: 0 auto; background: white;
  border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.3);
  overflow: hidden;
}
.header {
  background: linear-gradient(135deg, #b71c1c 0%, #d32f2f 100%);
  color: white; padding: 40px 30px; text-align: center;
}
.header h1 { font-size: 2.5em; margin-bottom: 10px; text-shadow: 2px 2px 4px rgba(0,0,0,0.2); }
.header p { font-size: 1.1em; opacity: 0.95; }
.ig-link {
  display: inline-block; margin-top: 10px; padding: 8px 20px;
  background: rgba(255,255,255,0.2); border-radius: 20px;
  color: white; text-decoration: none; transition: background 0.3s;
}
.ig-link:hover { background: rgba(255,255,255,0.3); }

.product-section { padding: 40px 30px; }
.product-card {
  background: linear-gradient(135deg, #fff5f5 0%, #ffebee 100%);
  border-radius: 15px; padding: 30px; border: 3px solid #f44336;
}
.product-header {
  display: flex; justify-content: space-between; align-items: center;
  flex-wrap: wrap; margin-bottom: 20px;
}
.product-name { font-size: 1.8em; color: #b71c1c; font-weight: bold; }
.product-price { font-size: 1.6em; color: #d32f2f; font-weight: bold; }
.special-badge {
  display: inline-block; background: #ff6b6b; color: white;
  padding: 5px 15px; border-radius: 20px; font-size: 0.9em; margin-left: 10px;
}
.highlight {
  background: #fff3bf; padding: 15px; border-radius: 10px; margin: 15px 0;
  border-left: 4px solid #f44336;
}
.highlight strong { color: #b71c1c; }
.product-intro {
  background: linear-gradient(135deg, #fff8f0 0%, #ffe8e8 100%);
  border-radius: 15px; padding: 25px; margin: 20px 0; border: 2px solid #ff6b6b;
  line-height: 1.8;
}
.product-intro h3 { color: #b71c1c; margin-bottom: 15px; font-size: 1.3em; }
.features-box { background: white; border-radius: 10px; padding: 15px; margin: 15px 0; }
.feature-item { color: #d32f2f; margin-bottom: 8px; font-weight: bold; }
.slogan { color: #b71c1c; font-weight: bold; font-size: 1.15em; margin: 15px 0; }
.specs-box {
  background: #fff3bf; border-radius: 8px; padding: 12px; margin-top: 15px;
  border-left: 4px solid #ff6b6b;
}

.form-group { margin: 20px 0; }
.form-group label { display: block; margin-bottom: 8px; color: #333; font-weight: bold; }
.form-group input, .form-group select, .form-group textarea {
  width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px;
  font-size: 1em; transition: border-color 0.3s;
}
.form-group input:focus, .form-group select:focus, .form-group textarea:focus {
  outline: none; border-color: #f44336;
}

.quantity-control {
  display: flex; align-items: center; gap: 15px;
}
.quantity-control button {
  width: 40px; height: 40px; border: none; background: #f44336;
  color: white; font-size: 1.5em; border-radius: 8px;
  cursor: pointer; transition: background 0.3s;
}
.quantity-control button:hover { background: #d32f2f; }

.total-section {
  background: #f8f9fa; padding: 20px; border-radius: 10px; margin: 20px 0;
}
.total-row { display: flex; justify-content: space-between; margin: 10px 0; font-size: 1.1em; }
.total-row.final { font-size: 1.5em; font-weight: bold; color: #b71c1c; border-top: 2px solid #ddd; padding-top: 10px; margin-top: 15px; }

.notice {
  background: #fff3bf; padding: 15px; border-radius: 10px; margin: 20px 0;
  text-align: center; font-weight: bold; color: #b71c1c;
  border: 2px dashed #ffa94d;
}

.submit-btn {
  width: 100%; padding: 18px;
  background: linear-gradient(135deg, #b71c1c 0%, #d32f2f 100%);
  color: white; border: none; border-radius: 12px; font-size: 1.3em;
  font-weight: bold; cursor: pointer; transition: transform 0.2s, box-shadow 0.2s;
}
.submit-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(183,28,28,0.4); }
.success-message { background: #d3f9d8; padding: 20px; border-radius: 10px; text-align: center; color: #2b8a3e; font-weight: bold; border: 2px solid #51cf66; }
.error-message { background: #ffe3e3; padding: 20px; border-radius: 10px; text-align: center; color: #b71c1c; font-weight: bold; border: 2px solid #f44336; }
.store-section { background: #f8f9fa; padding: 15px; border-radius: 10px; border: 2px solid #e9ecef; }
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <h1>🌶️ 渝味食記 🌶️</h1>
    <p>四川濃香型辣椒醬</p>
    <a href="https://www.instagram.com/yuweishiji" target="_blank" class="ig-link">📷 追蹤我們的 Instagram</a>
  </div>

  <div class="product-section">
    <div class="product-card">
      <div class="product-header">
        <div>
          <span class="product-name">四川濃香型辣椒醬</span>
          <span class="special-badge">🔥 麻辣鮮香</span>
        </div>
        <div class="product-price">NT$ 250 / 罐</div>
      </div>

      <div class="highlight"><strong>手工製作、無添加防腐劑，開封後請冷藏保存 ⚠️</strong></div>

      <form id="orderForm">
        <div class="form-group">
          <label>購買數量</label>
          <div class="quantity-control">
            <button type="button" id="btnMinus">−</button>
            <input type="number" id="qty" value="1" min="1" readonly>
            <button type="button" id="btnPlus">+</button>
          </div>
        </div>

        <div class="notice" id="freeShipNotice">🎉 購買10罐(含)以上免運費!</div>

        <div class="form-group"><label>姓名 *</label><input type="text" id="name" required></div>
        <div class="form-group"><label>電話 *</label><input type="tel" id="phone" required placeholder="例:0912345678"></div>
        <div class="form-group"><label>Email *</label><input type="email" id="email" required></div>

        <div class="form-group">
          <label>取貨方式 *</label>
          <select id="pickup" required>
            <option value="">請選擇取貨方式</option>
            <option value="7-11">7-11 超商取貨</option>
            <option value="全家">全家超商取貨</option>
            <option value="宅配">宅配</option>
            <option value="面交">面交</option>
          </select>
        </div>

        <div class="form-group" id="storeSelectGroup" style="display:none;">
          <label>選擇門市 *</label>
          <div class="store-section" id="storeSection">請選擇取貨方式以載入門市...</div>
        </div>

        <div class="form-group" id="addressGroup" style="display:none;">
          <label id="addressLabel">收貨地址 *</label>
          <textarea id="address" rows="3" placeholder="請填寫完整地址"></textarea>
        </div>

        <div class="form-group"><label>匯款帳號後5碼 *</label><input type="text" id="accountLast5" maxlength="5" pattern="[0-9]{5}" required placeholder="請填寫5位數字"></div>

        <div class="total-section">
          <div class="total-row"><span>小計:</span><span id="subtotalDisplay">NT$ 250</span></div>
          <div class="total-row"><span>運費:</span><span id="shippingDisplay">NT$ 130</span></div>
          <div class="total-row final"><span>總計:</span><span id="totalDisplay">NT$ 380</span></div>
        </div>

        <button type="submit" class="submit-btn" id="submitBtn">確認訂購</button>
        <div id="message"></div>
      </form>
    </div>
  </div>
</div>

<script>
const PRICE = 250, SHIPPING_DELIVERY = 160, SHIPPING_STORE = 130, FREE_SHIPPING_QTY = 10;
const WEB3FORMS_ACCESS_KEY='63c8b2d8-bddb-46cb-b683-e3c0becf31bf';
const MERCHANT_EMAIL='bonnywu992@gmail.com';

const qtyInput=document.getElementById('qty');
const btnPlus=document.getElementById('btnPlus');
const btnMinus=document.getElementById('btnMinus');
const subtotalDisplay=document.getElementById('subtotalDisplay');
const shippingDisplay=document.getElementById('shippingDisplay');
const totalDisplay=document.getElementById('totalDisplay');
const pickupSelect=document.getElementById('pickup');
const storeSelectGroup=document.getElementById('storeSelectGroup');
const addressGroup=document.getElementById('addressGroup');
const storeSection=document.getElementById('storeSection');
let selectedStore='', citySelect, districtSelect, storeSelect, storeData=null;

function updatePrice(){
  const qty=parseInt(qtyInput.value)||1;
  const pickupMethod=pickupSelect.value;
  let shipping=0;
  if(pickupMethod==='宅配') shipping=(qty>=FREE_SHIPPING_QTY)?0:SHIPPING_DELIVERY;
  else if(pickupMethod==='7-11'||pickupMethod==='全家') shipping=(qty>=FREE_SHIPPING_QTY)?0:SHIPPING_STORE;
  const subtotal=PRICE*qty, total=subtotal+shipping;
  subtotalDisplay.textContent='NT$ '+subtotal;
  shippingDisplay.textContent=shipping===0?'免運費 ✓':'NT$ '+shipping;
  totalDisplay.textContent='NT$ '+total;
}
btnPlus.onclick=()=>{qtyInput.value=parseInt(qtyInput.value)+1;updatePrice();};
btnMinus.onclick=()=>{if(qtyInput.value>1)qtyInput.value=parseInt(qtyInput.value)-1;updatePrice();};

async function loadStoreData(type){
  storeSection.innerHTML='⏳ 正在載入門市資料...';
  try{
    const res=await fetch(`data/stores_${type}.json`);
    if(!res.ok) throw new Error();
    storeData=await res.json();
    renderStoreOptions(storeData);
  }catch{
    storeSection.innerHTML='<div class="error-message">⚠️ 門市資料載入失敗，請重新整理</div>';
  }
}

function renderStoreOptions(data){
  storeSection.innerHTML='';
  const citySel=document.createElement('select');
  citySel.innerHTML='<option value="">請選擇縣市</option>';
  Object.keys(data).forEach(c=>citySel.innerHTML+=`<option>${c}</option>`);
  const districtSel=document.createElement('select');districtSel.disabled=true;
  const storeSel=document.createElement('select');storeSel.disabled=true;
  storeSection.append(citySel,districtSel,storeSel);

  citySel.onchange=()=>{
    const c=citySel.value;districtSel.innerHTML='<option>請選擇區域</option>';
    if(!c){districtSel.disabled=true;return;}
    districtSel.disabled=false;
    Object.keys(data[c]).forEach(d=>districtSel.innerHTML+=`<option>${d}</option>`);
  };
  districtSel.onchange=()=>{
    const c=citySel.value,d=districtSel.value;storeSel.innerHTML='<option>請選擇門市</option>';
    if(!d){storeSel.disabled=true;return;}
    storeSel.disabled=false;
    data[c][d].forEach(s=>storeSel.innerHTML+=`<option value="${c}-${d}-${s}">${s}</option>`);
  };
  storeSel.onchange=()=>selectedStore=storeSel.value;
}

pickupSelect.onchange=()=>{
  const val=pickupSelect.value, address=document.getElementById('address'), label=document.getElementById('addressLabel');
  if(val==='7-11'||val==='全家'){storeSelectGroup.style.display='block';addressGroup.style.display='none';loadStoreData(val==='7-11'?'7-11':'family');}
  else if(val==='宅配'){storeSelectGroup.style.display='none';addressGroup.style.display='block';label.textContent='收貨地址 *';address.readOnly=false;address.value='';}
  else if(val==='面交'){storeSelectGroup.style.display='none';addressGroup.style.display='block';label.textContent='面交地點';address.value='802高雄市苓雅區武廟路206號';address.readOnly=true;}
  else {storeSelectGroup.style.display='none';addressGroup.style.display='none';}
  updatePrice();
};

document.getElementById('orderForm').onsubmit=async e=>{
  e.preventDefault();
  const phone=document.getElementById('phone').value.trim();
  const account=document.getElementById('accountLast5').value.trim();
  if(!/^09\d{8}$/.test(phone))return alert('請輸入正確手機號碼');
  if(!/^\d{5}$/.test(account))return alert('帳號後5碼必須為5位數字');

  let addr='';
  const method=pickupSelect.value;
  if(method==='7-11'||method==='全家'){if(!selectedStore)return alert('請選擇門市');addr=selectedStore;}
  else addr=document.getElementById('address').value.trim();

  alert(`✅ 訂單建立成功！\n取貨方式：${method}\n收貨資訊：${addr}`);
};
</script>
</body>
</html>
        var merchantEmailContent=`╔═══════════════════════════════════╗
🛒 新訂單通知 - 渝味食記
╚═══════════════════════════════════╝
訂單編號:${orderId}
訂單時間:${orderTime}
姓名:${customerName}
電話:${phone}
Email:${customerEmail}
取貨方式:${pickupMethod}
收貨地址/門市:${finalAddress}
匯款帳號後5碼:${account}
商品名稱:【渝味食記】四川濃香型辣椒醬
單價:NT$ ${PRICE}
數量:${qty} 罐
小計:NT$ ${subtotal}
商品小計:NT$ ${subtotal}
運費:${shipping===0?(pickupMethod==='面交'?'免運費 (面交) ✓':'免運費 ✓'):'NT$ '+shipping}
訂單總額:NT$ ${total}
備註:${note}
提醒事項:
${pickupMethod==='面交'?'⚠️ 此訂單選擇面交,請透過 Instagram 與客戶確認時間地點':''}
${shipping===0&&pickupMethod!=='面交'?'✅ 此訂單已達免運門檻':''}
${pickupMethod==='面交'?'✅ 面交免運費':''}`;

        await fetch('https://api.web3forms.com/submit',{
            method:'POST',
            headers:{'Content-Type':'application/json','Accept':'application/json'},
            body:JSON.stringify({access_key:WEB3FORMS_ACCESS_KEY,subject:`🛒 新訂單 ${orderId} - 渝味食記`,from_name:'渝味食記訂購系統',email:MERCHANT_EMAIL,message:merchantEmailContent})
        });

        var customerEmailContent=`親愛的 ${customerName} 您好:
感謝您於 渝味食記 下單!
訂單編號:${orderId}
商品:【渝味食記】四川濃香型辣椒醬 x ${qty} 罐
小計:NT$ ${subtotal}
運費:${shipping===0?(pickupMethod==='面交'?'免運費 (面交) ✓':'免運費 ✓'):'NT$ '+shipping}
總計:NT$ ${total}
取貨方式:${pickupMethod}
收貨地址/門市:${finalAddress}
備註:${note}
請記住您的訂單編號以便查詢
⚠️ 若選擇面交,請透過 Instagram 私訊我們確認時間地點
Instagram: @yuweishiji`;

        await fetch('https://api.web3forms.com/submit',{
            method:'POST',
            headers:{'Content-Type':'application/json','Accept':'application/json'},
            body:JSON.stringify({access_key:WEB3FORMS_ACCESS_KEY,from_name:'渝味食記訂購系統',email:customerEmail,message:customerEmailContent})
        });

        messageDiv.innerHTML=`<div class="success-message">
✅ 訂單已成功送出!<br><br>
<strong>訂單編號:${orderId}</strong><br><br>
我們已收到您的訂單,會盡快與您聯繫。<br>
${pickupMethod==='面交'?'<br>⚠️ 您選擇了面交,請透過 Instagram 私訊我們確認時間地點。<br>':''}
<br>請記住您的訂單編號以便查詢。<br>
📧 確認信已發送至您的 Email<br>
Instagram: @yuweishiji
</div>`;

        document.getElementById('orderForm').reset();
        qtyInput.value=1;
        selectedStore = '';
        storeSelectGroup.style.display = 'none';
        addressGroup.style.display = 'none';
        updatePrice();

    } catch(err){
        console.error(err);
        messageDiv.innerHTML=`<div class="error-message">
❌ 訂單送出失敗<br><br>
請稍後再試,或直接透過 Instagram 聯繫我們:<br><strong>@yuweishiji</strong>
</div>`;
    } finally{
        submitBtn.disabled=false; submitBtn.textContent='確認訂購';
    }
});

updatePrice();
</script>
</body>
</html>






